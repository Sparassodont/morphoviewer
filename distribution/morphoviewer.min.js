var morphoviewer=function(t){function e(t,e,r){var a=[];"xy"===r?a.push(e*Math.cos(0),e*Math.sin(0),0):"xz"===r?a.push(e*Math.cos(0),0,e*Math.sin(0)):"yz"===r&&a.push(0,e*Math.sin(0),e*Math.cos(0));for(var i=2*Math.PI/t,o=0;i<2*Math.PI;i+=2*Math.PI/t,o++){var n=e*Math.cos(i),s=e*Math.sin(i);"xy"===r?(a.push(n,s,0),a.push(n,s,0)):"xz"===r?(a.push(n,0,s),a.push(n,0,s)):"yz"===r&&(a.push(0,s,n),a.push(0,s,n))}return a.push(a[0],a[1],a[2]),a}return t.Trackball=function(t){this.gl=t,this.numPoints=0,this.vboxy=null,this.vboxz=null,this.vboyz=null,this.radius=1,this.setRadius(1.4)},t.Trackball.prototype.setRadius=function(t){this.radius=t;var r=e(100,t,"xy"),a=e(100,t,"xz"),i=e(100,t,"yz");this.numPoints=r.length/3,this.vboxy=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboxy),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(r),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.vboxz=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboxz),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(a),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.vboyz=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboyz),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(i),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Trackball.prototype.drawXYCircle=function(e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboxy),t.flatShader.setAttributes(this.gl,e),this.gl.drawArrays(this.gl.LINES,0,this.numPoints),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Trackball.prototype.drawXZCircle=function(e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboxz),t.flatShader.setAttributes(this.gl,e),this.gl.drawArrays(this.gl.LINES,0,this.numPoints),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Trackball.prototype.drawYZCircle=function(e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboyz),t.flatShader.setAttributes(this.gl,e),this.gl.drawArrays(this.gl.LINES,0,this.numPoints),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Trackball.prototype.draw=function(e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboxy),t.flatShader.setAttributes(this.gl,e),this.gl.drawArrays(this.gl.LINES,0,this.numPoints),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboxz),t.flatShader.setAttributes(this.gl,e),this.gl.drawArrays(this.gl.LINES,0,this.numPoints),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboyz),t.flatShader.setAttributes(this.gl,e),this.gl.drawArrays(this.gl.LINES,0,this.numPoints),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Trackball.prototype.getRadius=function(){return this.radius},t}((morphoviewer=function(t){function e(t){var e;e=void 0==t?"glcanvas":t;var a=document.getElementById(e),i=r(a);return i?(i.clearColor(.1,.16,.16,1),i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)):alert("morphoviewer.initialize: Unable to initialize WebGL. Your browser may not support it."),[i,a]}function r(t){var e=null;try{e=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(t){}return e}function a(e){var r=new t.Program(e);r.programFromString(t.wireframe.vertex,t.wireframe.fragment);var a=new t.Program(e);a.programFromString(t.color.vertex,t.color.fragment);var i=new t.Program(e);i.programFromString(t.hemisphere.vertex,t.hemisphere.fragment);var o=new t.Program(e);return o.programFromString(t.flatShader.vertex,t.flatShader.fragment),t.flatShader.enableAttributes(e,o),t.flatShader.setAttributes(e,o),[r,a,i,o]}function i(t,e,r){return r>1&&(r=1),vec3.add(vec3.create(),t,vec3.scale(vec3.create(),vec3.subtract(vec3.create(),e,t),r))}function o(e,r,a){e.bind(),t.wireframe.enableAttributes(r,a),t.wireframe.setAttributes(r,a,e.vertices()),e.unbind()}function n(e){e.mesh.bind(),t.color.enableAttributes(e.gl,e.currentProgram),t.color.setAttributes(e.gl,e.currentProgram,e.mesh.vertices(),e.mesh),e.mesh.unbind(),e.renderFunctor=function(){e.mesh.bind(),t.color.setAttributes(e.gl,e.currentProgram,e.mesh.vertices(),e.mesh),t.color.camera=e.camera.matrix(),t.color.model=e.modelView,t.color.setUniforms(e.currentProgram),e.gl.drawArrays(e.gl.TRIANGLES,0,e.mesh.vertices()),e.mesh.unbind()}}var s={};return s.Viewer=function(r){var o=this,n=e(r);this.gl=n[0],this.canvas=n[1],this.showTrackball=!0,this.timer=null,this.endTime=null,this.fps=40,this.mesh=new t.Mesh(this.gl),this.mesh.build({vertex:[],normal:[],curvature:[],orientation:[]}),this.meshCache={vertex:[],normal:[],curvature:[],orientation:[]},this.cameraCache=mat4.create(),this.modelView=mat4.create(),this.opcAreaLimit=.3,this.totalModelArea=1,this.renderFunctor=function(){},this.position=vec3.fromValues(0,0,0),this.targetPosition=vec3.fromValues(0,0,0);var s=this.canvas.clientWidth/this.canvas.clientHeight;this.camera=new t.Camera(60*Math.PI/180,s,.01,1e3),this.mouse={x:0,y:0,prevX:0,prevY:0,dx:0,dy:0},this.leftMouseButtonDown=!1;var l=function(t){o.mouse.x=t.pageX,o.mouse.y=t.pageY,o.mouse.dx=o.mouse.x-o.mouse.prevX,o.mouse.dy=o.mouse.y-o.mouse.prevY,o.mouse.prevX=o.mouse.x,o.mouse.prevY=o.mouse.y},c=function(t){var e=window.event||t;e.preventDefault(),e.stopImmediatePropagation();var r=e.detail?-120*e.detail:e.wheelDelta;o.camera.dolly(-.0025*r)};this.canvas.onmousedown=function(t){switch(!t.which&&t.button&&(1&t.button?t.which=1:4&t.button?t.which=2:2&t.button&&(t.which=3)),o.mouse.prevX=t.pageX,o.mouse.prevY=t.pageY,t.which){case 1:o.leftMouseButtonDown=!0,o.canvas.onmousemove=function(t){l(t),o.camera.orbit(.004*o.mouse.dx,.004*o.mouse.dy)};break;case 3:o.canvas.onmousemove=function(t){l(t);var e=vec3.scale(vec3.create(),o.camera.up(),-o.mouse.dy*o.camera.distanceFromOrigin()*.001),r=vec3.scale(vec3.create(),o.camera.right(),o.mouse.dx*o.camera.distanceFromOrigin()*.001);vec3.add(o.targetPosition,o.targetPosition,e),vec3.add(o.targetPosition,o.targetPosition,r)}}},this.canvas.onmouseup=function(t){switch(!t.which&&t.button&&(1&t.button?t.which=1:4&t.button?t.which=2:2&t.button&&(t.which=3)),t.which){case 1:o.leftMouseButtonDown=!1}o.canvas.onmousemove=function(t){return!1}},this.canvas.oncontextmenu=function(t){t.preventDefault()},this.canvas.addEventListener?(this.canvas.addEventListener("mousewheel",c,!1),this.canvas.addEventListener("DOMMouseScroll",c,!1)):this.canvas.addEventListener("onmousewheel",c),this.timer=new Date,this.trackball=new t.Trackball(this.gl);var h=[-1,1,0,1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0];this.showPlane=!1,this.planeObject=new t.BufferObject(this.gl,this.gl.ARRAY_BUFFER),this.planeObject.dataStore(new Float32Array(h),this.gl.STATIC_DRAW),this.planeRotationMatrix=mat4.create(),this.planeTranslationMatrix=mat4.create(),this.planeScalingMatrix=mat4.create(),this.plane=new t.Plane(vec3.fromValues(0,0,0),vec3.fromValues(1,0,0),vec3.fromValues(0,1,0));setInterval(function(){o.gl.clear(o.gl.COLOR_BUFFER_BIT|o.gl.DEPTH_BUFFER_BIT),o.endTime=new Date;var e=o.endTime-o.timer;if(e/=1e3,o.position=i(o.position,o.targetPosition,.5*(1-e)),o.modelView=mat4.create(),mat4.translate(o.modelView,o.modelView,o.position),o.camera.update(e),o.renderFunctor(),o.showTrackball&&(o.currentProgram.stopUsing(),o.lineProgram.use(),t.flatShader.camera=o.camera.matrix(),t.flatShader.model=mat4.create(),t.flatShader.surfaceColor=vec3.fromValues(.7,.7,.7),o.leftMouseButtonDown?(t.flatShader.surfaceColor=vec3.fromValues(.38,.38,1),t.flatShader.setUniforms(o.lineProgram),o.trackball.drawXYCircle(o.lineProgram),t.flatShader.surfaceColor=vec3.fromValues(.38,1,.38),t.flatShader.setUniforms(o.lineProgram),o.trackball.drawXZCircle(o.lineProgram),t.flatShader.surfaceColor=vec3.fromValues(1,.38,.38),t.flatShader.setUniforms(o.lineProgram),o.trackball.drawYZCircle(o.lineProgram)):(t.flatShader.setUniforms(o.lineProgram),o.trackball.draw(o.lineProgram)),o.lineProgram.stopUsing(),o.currentProgram.use()),o.showPlane){o.currentProgram.stopUsing(),o.planeProgram.use(),o.planeObject.bind(),t.flatShader.camera=o.camera.matrix();var r=mat4.multiply(mat4.create(),o.planeRotationMatrix,o.planeScalingMatrix);mat4.multiply(r,o.planeTranslationMatrix,r),t.flatShader.model=r,t.flatShader.surfaceColor=vec3.fromValues(.45,.45,.7),t.flatShader.setUniforms(o.planeProgram),t.flatShader.setAttributes(o.gl,o.planeProgram),o.gl.drawArrays(o.gl.TRIANGLES,0,6),o.planeObject.unbind(),o.planeProgram.stopUsing(),o.currentProgram.use()}o.timer=new Date},1e3/this.fps,this.gl,this.renderFunctor,this.lineProgram,this.currentProgram,this.trackball,this.camera,this.timer);var u=a(this.gl);this.wireframeProgram=u[0],this.colorProgram=u[1],this.lineProgram=u[3],this.planeProgram=this.lineProgram,this.hemisphereProgram=u[2],this.currentProgram=this.hemisphereProgram,this.viewHemispherical()},s.Viewer.prototype.loadData=function(e){var r=this,a=t.io.getFileType(e);if("stl"===a){var i=(V=t.parseSTL(e)).v,o=V.vn,n=t.surfaceVariation(i,o),s=t.surfaceOrientation(o);t.centerPointCloud(i,"unwrapped"),r.meshCache={vertex:[],normal:[],index:[],orientation:[],curvature:[],wrappedVertex:[],wrappedNormal:[],adjacencyList:[]},r.meshCache.vertex=i,r.meshCache.normal=o,r.meshCache.orientation=s,r.meshCache.curvature=n,r.mesh=new t.Mesh(r.gl),r.mesh.build({vertex:i,normal:o,curvature:n,orientation:s});C=t.getAabbFromUnwrapped(i);r.planeScalingMatrix=mat4.fromScaling(mat4.create(),vec3.fromValues(.7*C.width,.7*C.height,1)),r.trackball.setRadius(C.length/2.3),r.camera.setBestPositionForModel(C)}else if("ply"===a){for(var i=[],l=(V=t.parsePLY(e)).vertex,c=l.x,h=l.y,u=l.z,m=V.vertex.x.length,f=0;f<m;f++)i.push([c[f],h[f],u[f]]);var p=[],v=V.face.vertex_indices;m=v.length;for(f=0;f<m;f++)p.push(v[f]);var g=t.adjacencyList(i,p),o=[];if(void 0!==l.nx)for(var d=l.nx,b=l.ny,w=l.nz,f=0;f<m;f++)o.push([d[f],b[f],w[f]]);else o=t.vertexNormals(i,p,g);s=[];if(void 0!==l.orientation)for(var y=l.orientation,f=0;f<m;f++)s.push(y[f]);n=[];if(void 0!==V.face.curvature)for(var P=V.face.curvature,f=0;f<P.length;f++)n.push(P[f],P[f],P[f]);t.centerPointCloud(i);var A=t.unwrapVectorArray(i,p),F=t.unwrapVectorArray(o,p);r.meshCache={vertex:[],normal:[],index:[],orientation:[],curvature:[],wrappedVertex:[],wrappedNormal:[],adjacencyList:[]},r.meshCache.vertex=A,r.meshCache.normal=F,r.meshCache.index=p,r.meshCache.wrappedVertex=i,r.meshCache.wrappedNormal=o,r.meshCache.adjacencyList=g,void 0!==l.orientation?r.meshCache.orientation=t.unwrapArray(s,p):r.meshCache.orientation=t.surfaceOrientation(F),void 0!==V.face.curvature?r.meshCache.curvature=n:r.meshCache.curvature=t.surfaceVariation(A,F),r.mesh=new t.Mesh(r.gl),r.mesh.build({vertex:A,normal:F,curvature:r.meshCache.curvature,orientation:r.meshCache.orientation});C=t.getAabb(i);r.planeScalingMatrix=mat4.fromScaling(mat4.create(),vec3.fromValues(.7*C.width,.7*C.height,1)),r.trackball.setRadius(C.length/2.3),r.camera.setBestPositionForModel(C)}else{if("csv"!==a)return void alert("morphoviewer.Viewer.view: unrecognized file format");var V=t.parseCSV(e,","),i=V.points;t.centerPointCloud(i);var p=t.triangulate(i),g=t.adjacencyList(i,p),o=t.vertexNormals(i,p,g),A=t.unwrapVectorArray(i,p),F=t.unwrapVectorArray(o,p),n=t.surfaceVariation(A,F),s=t.surfaceOrientation(F);r.meshCache={vertex:[],normal:[],index:[],orientation:[],curvature:[],wrappedVertex:[],wrappedNormal:[],adjacencyList:[]},r.meshCache.vertex=A,r.meshCache.normal=F,r.meshCache.index=p,r.meshCache.orientation=s,r.meshCache.curvature=n,r.meshCache.wrappedVertex=i,r.meshCache.wrappedNormal=o,r.meshCache.adjacencyList=g,r.mesh=new t.Mesh(r.gl),r.mesh.build({vertex:A,normal:F,curvature:n,orientation:s});var C=t.getAabb(i);r.trackball.setRadius(C.length/2.3),r.camera.setBestPositionForModel(C),r.planeScalingMatrix=mat4.fromScaling(mat4.create(),vec3.fromValues(.7*C.width,.7*C.height,1))}this.cameraCache=this.camera.rotation(),r.totalModelArea=t.modelArea(r.meshCache.wrappedVertex,r.meshCache.index)},s.Viewer.prototype.view=function(e){var r=this;t.io.loadFile(e,function(t){r.loadData(t)})},s.Viewer.prototype.viewWireframe=function(){this.currentProgram=this.wireframeProgram,this.currentProgram.use(),o(this.mesh,this.gl,this.currentProgram),this.renderFunctor=function(){this.mesh.bind(),t.wireframe.setAttributes(this.gl,this.currentProgram,this.mesh.vertices()),t.wireframe.camera=this.camera.matrix(),t.wireframe.model=this.modelView,t.wireframe.setUniforms(this.currentProgram),this.gl.drawArrays(this.gl.TRIANGLES,0,this.mesh.vertices()),this.mesh.unbind()}},s.Viewer.prototype.viewSurfaceOrientation=function(){this.mesh.has("orientation")&&(this.currentProgram.object!=this.colorProgram.object&&(this.currentProgram=this.colorProgram,this.currentProgram.use(),n(this)),t.color.colorMode=2)},s.Viewer.prototype.viewSurfaceCurvature=function(){this.mesh.has("curvature")&&(this.currentProgram.object!=this.colorProgram.object&&(this.currentProgram=this.colorProgram,this.currentProgram.use(),n(this)),t.color.colorMode=1)},s.Viewer.prototype.viewHemispherical=function(){this.currentProgram=this.hemisphereProgram,this.currentProgram.use(),this.mesh.bind(),t.hemisphere.enableAttributes(this.gl,this.currentProgram),t.hemisphere.setAttributes(this.gl,this.currentProgram,this.mesh.vertices()),this.mesh.unbind();var e=this;this.renderFunctor=function(){e.mesh.bind(),t.hemisphere.setAttributes(e.gl,e.currentProgram,e.mesh.vertices()),t.hemisphere.camera=e.camera.matrix(),t.hemisphere.model=e.modelView,t.hemisphere.setUniforms(this.currentProgram),e.gl.drawArrays(e.gl.TRIANGLES,0,e.mesh.vertices()),e.mesh.unbind()}},s.Viewer.prototype.viewOrtho=function(){this.camera.viewAsOrtho()},s.Viewer.prototype.viewPerspective=function(){this.camera.viewAsPerspective()},s.Viewer.prototype.viewLeft=function(){this.targetPosition=vec3.fromValues(0,0,0),this.camera.positionLeft()},s.Viewer.prototype.viewRight=function(){this.targetPosition=vec3.fromValues(0,0,0),this.camera.positionRight()},s.Viewer.prototype.viewTop=function(){this.targetPosition=vec3.fromValues(0,0,0),this.camera.positionTop()},s.Viewer.prototype.viewBottom=function(){this.targetPosition=vec3.fromValues(0,0,0),this.camera.positionBottom()},s.Viewer.prototype.viewFront=function(){this.targetPosition=vec3.fromValues(0,0,0),this.camera.positionFront()},s.Viewer.prototype.viewBack=function(){this.targetPosition=vec3.fromValues(0,0,0),this.camera.positionBack()},s.Viewer.prototype.showTrackingball=function(){this.showTrackball=!0},s.Viewer.prototype.hideTrackingball=function(){this.showTrackball=!1},s.color={black:vec3.fromValues(0,0,0),white:vec3.fromValues(1,1,1),lightgray:vec3.fromValues(.91,.91,.91),lightgrey:vec3.fromValues(.91,.91,.91),darkgray:vec3.fromValues(.41,.41,.41),darkgrey:vec3.fromValues(.41,.41,.41)},s.Viewer.prototype.setBackgroundColor=function(t){this.gl.clearColor(t[0],t[1],t[2],1)},s.Viewer.prototype.setFOV=function(t){this.camera.setFOV(Math.PI*t/180)},s.Viewer.prototype.setLightPolarAngle=function(e){t.hemisphere.polar=e},s.Viewer.prototype.setLightAzimuthalAngle=function(e){t.hemisphere.azimuth=e},s.Viewer.prototype.calculateOrientation=function(){this.meshCache.orientation=t.surfaceOrientationAboutCamera(this.meshCache.normal,this.camera.rotation()),this.mesh=new t.Mesh(this.gl),this.mesh.build(this.meshCache),this.cameraCache=this.camera.rotation()},s.Viewer.prototype.setPatchCutoff=function(t){t>=0&&t<100?this.opcAreaLimit=t:console.log("Viewer.setAreaLimit: invalid percentage "+t)},s.Viewer.prototype.opc=function(){if(0===this.meshCache.wrappedVertex.length)return alert("The file format (STL) does not support orientation patch count calculations. Consider converting the file into something else!"),0;for(var e=this.cameraCache,r=this.meshCache.wrappedNormal,a=[],i=0;i<r.length;i++){var o=e[0]*r[i][0]+e[1]*r[i][1]+e[2]*r[i][2],n=e[3]*r[i][0]+e[4]*r[i][1]+e[3]*r[i][2],s=vec2.normalize(vec2.create(),vec2.fromValues(o,n)),l=t.angleRangeClamp(Math.atan2(s[1],s[0])),c=Math.floor(l/(2*Math.PI/8));c/=7,a.push(c)}return count=t.opc(this.meshCache.wrappedVertex,this.meshCache.adjacencyList,a,this.opcAreaLimit,this.totalModelArea)},s.Viewer.prototype.showOpcSelectionPlane=function(){this.showPlane=!0},s.Viewer.prototype.hideOpcSelectionPlane=function(){this.showPlane=!1},s.Viewer.prototype.setOpcSelectionPlane=function(){this.planeRotationMatrix=mat4.invert(mat4.create(),t.rotationMatrix4(vec3.fromValues(0,0,-1),this.camera.forward())),this.plane=new t.Plane(vec3.transformMat4(vec3.create(),vec3.fromValues(0,0,0),this.planeRotationMatrix),vec3.transformMat4(vec3.create(),vec3.fromValues(1,0,0),this.planeRotationMatrix),vec3.transformMat4(vec3.create(),vec3.fromValues(0,1,0),this.planeRotationMatrix))},s.Viewer.prototype.translateOpcSelectionPlane=function(t){var e=this.plane.getNormal();vec3.normalize(e,e),vec3.scale(e,e,.9*t),mat4.multiply(this.planeTranslationMatrix,this.planeTranslationMatrix,mat4.fromTranslation(mat4.create(),e))},s.Viewer.prototype.flipOpcSelectionPlane=function(){this.plane.flip()},s.Viewer.prototype.modelArea=function(){return this.totalModelArea},s.io={},s.io.loadFile=t.io.loadFile,s.io.getFileType=t.io.getFileType,s.io.loadPLY=t.io.loadPLY,s.io.loadOBJ=t.io.loadOBJ,s.io.loadCSV=t.io.loadCSV,s}(morphoviewer=function(t){function e(t){for(var e=0,r=0,a=0,i=0;i<t.length;i++)e+=t[i][0],r+=t[i][1],a+=t[i][2];return e/=t.length,r/=t.length,a/=t.length,[e,r,a]}function r(t){for(var r=e(t),a=0;a<t.length;a++)t[a][0]-=r[0],t[a][1]-=r[1],t[a][2]-=r[2]}function i(t){for(var e=0,r=0,a=0,i=0;i<t.length;i+=3)e+=t[i],r+=t[i+1],a+=t[i+2];e/=t.length,r/=t.length,a/=t.length;for(i=0;i<t.length;i+=3)t[i]-=e,t[i+1]-=r,t[i+2]-=a}function o(t,e){for(var r=new Array(t.length),a=0;a<e.length;a++){var i=vec3.fromValues(t[e[a][1]][0]-t[e[a][0]][0],t[e[a][1]][1]-t[e[a][0]][1],t[e[a][1]][2]-t[e[a][0]][2]),o=vec3.fromValues(t[e[a][2]][0]-t[e[a][0]][0],t[e[a][2]][1]-t[e[a][0]][1],t[e[a][2]][2]-t[e[a][0]][2]),n=vec3.cross(vec3.create(),i,o);r[e[a][0]]=[n[0],n[1],n[2]],r[e[a][1]]=[n[0],n[1],n[2]],r[e[a][2]]=[n[0],n[1],n[2]]}return r}function n(t){return t>1e3&&(t=1e3),t}return t.centerPointCloud=function(t,e){void 0===e&&(e="wrapped"),"wrapped"===e?r(t):"unwrapped"===e&&i(t)},t.unwrapVectorArray=function(t,e){for(var r=[],a=0;a<e.length;a++)r.push(t[e[a][0]][0],t[e[a][0]][1],t[e[a][0]][2]),r.push(t[e[a][1]][0],t[e[a][1]][1],t[e[a][1]][2]),r.push(t[e[a][2]][0],t[e[a][2]][1],t[e[a][2]][2]);return r},t.unwrapArray=function(t,e){for(var r=[],a=0;a<e.length;a++)r.push(t[e[a][0]],t[e[a][1]],t[e[a][2]]);return r},t.getAabb=function(t){for(var e=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,s=0;s<t.length;s++)t[s][0]<e&&(e=t[s][0]),t[s][0]>r&&(r=t[s][0]),t[s][1]<a&&(a=t[s][1]),t[s][1]>i&&(i=t[s][1]),t[s][2]<o&&(o=t[s][2]),t[s][2]>n&&(n=t[s][2]);var l=(r-e)*(r-e);return l+=(i-a)*(i-a),l+=(n-o)*(n-o),{width:r-e,height:i-a,min:{x:e,y:a,z:o},max:{x:r,y:i,z:n},center:{x:e+r/2,y:a+i/2,z:o+n/2},length:Math.sqrt(l)}},t.getAabbFromUnwrapped=function(t){for(var e=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,s=0;s<t.length;s+=3)t[s]<e&&(e=t[s]),t[s]>r&&(r=t[s]),t[s+1]<a&&(a=t[s+1]),t[s+1]>i&&(i=t[s+1]),t[s+2]<o&&(o=t[s+2]),t[s+2]>n&&(n=t[s+2]);var l=(r-e)*(r-e);return l+=(i-a)*(i-a),l+=(n-o)*(n-o),{min:{x:e,y:a,z:o},max:{x:r,y:i,z:n},center:{x:e+r/2,y:a+i/2,z:o+n/2},length:Math.sqrt(l)}},t.triangulate=function(t){for(var e=Delaunay.triangulate(t),r=[],a=0;a<e.length;a+=3)r.push([e[a],e[a+1],e[a+2]]);return r},t.faceNormals=function(t,e){for(var r=new Array(t.length),a=0;a<e.length;a++){var i=vec3.fromValues(t[e[a][1]][0]-t[e[a][0]][0],t[e[a][1]][1]-t[e[a][0]][1],t[e[a][1]][2]-t[e[a][0]][2]),o=vec3.fromValues(t[e[a][2]][0]-t[e[a][0]][0],t[e[a][2]][1]-t[e[a][0]][1],t[e[a][2]][2]-t[e[a][0]][2]),n=vec3.cross(vec3.create(),i,o);vec3.normalize(n,n),r[e[a][0]]=[n[0],n[1],n[2]],r[e[a][1]]=[n[0],n[1],n[2]],r[e[a][2]]=[n[0],n[1],n[2]]}return r},t.adjacencyList=function(t,e){for(var r=new Array(t.length),a=0;a<t.length;a++)r[a]=[];for(a=0;a<e.length;a++)r[e[a][0]].push(e[a][1],e[a][2]),r[e[a][1]].push(e[a][0],e[a][2]),r[e[a][2]].push(e[a][0],e[a][1]);return r},t.vertexNormals=function(t,e,r){for(var a=o(t,e),i=new Array(t.length),n=0;n<t.length;n++){for(var s=vec3.fromValues(0,0,0),l=0;l<r[n].length;l++)vec3.add(s,s,vec3.fromValues(a[r[n][l]][0],a[r[n][l]][1],a[r[n][l]][2]));vec3.normalize(s,s),i[n]=new Array(3),i[n][0]=s[0],i[n][1]=s[1],i[n][2]=s[2]}return i},t.surfaceVariation=function(t,e){for(var r=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,i=[],o=0;o<t.length;o+=9){var s=vec3.fromValues(t[o+3]-t[o],t[o+4]-t[o+1],t[o+5]-t[o+2]),l=vec3.fromValues(t[o+6]-t[o],t[o+7]-t[o+1],t[o+8]-t[o+2]),c=mat2.create();c[0]=vec3.dot(s,s),c[1]=vec3.dot(s,l),c[2]=vec3.dot(s,l),c[3]=vec3.dot(l,l);var h=vec3.fromValues(e[o+3]-e[o],e[o+4]-e[o+1],e[o+5]-e[o+2]),u=vec3.fromValues(e[o+6]-e[o],e[o+7]-e[o+1],e[o+8]-e[o+2]),m=mat2.create();m[0]=vec3.dot(h,h),m[1]=vec3.dot(h,u),m[2]=vec3.dot(h,u),m[3]=vec3.dot(u,u);var f=mat2.create();mat2.invert(c,c),mat2.multiply(f,c,m);var p=f[0]+f[3];p=n(p),i.push(p),i.push(p),i.push(p),p>r?r=p:p<a&&(a=p)}for(o=0;o<i.length;o++)i[o]/=r;return i},t.surfaceOrientation=function(e){for(var r=[],a=0;a<e.length;a+=3){var i=vec2.normalize(vec2.create(),vec2.fromValues(e[a],e[a+1])),o=t.angleRangeClamp(Math.atan2(i[1],i[0])),n=Math.floor(o/(2*Math.PI/8));n/=7,r.push(n)}return r},t.surfaceOrientationAboutCamera=function(e,r){for(var a=[],i=0;i<e.length;i+=3){var o=r[0]*e[i]+r[1]*e[i+1]+r[2]*e[i+2],n=r[3]*e[i]+r[4]*e[i+1]+r[3]*e[i+2],s=vec2.normalize(vec2.create(),vec2.fromValues(o,n)),l=t.angleRangeClamp(Math.atan2(s[1],s[0])),c=Math.floor(l/(2*Math.PI/8));c/=7,a.push(c)}return a},t.modelArea=function(t,e){for(var r=0,a=0;a<e.length;a++){var i=[t[e[a][0]][0]-t[e[a][1]][0],t[e[a][0]][1]-t[e[a][1]][1],t[e[a][0]][2]-t[e[a][1]][2]],o=[t[e[a][0]][0]-t[e[a][2]][0],t[e[a][0]][1]-t[e[a][2]][1],t[e[a][0]][2]-t[e[a][2]][2]],n=[i[1]*o[2]-i[2]*o[1],i[2]*o[0]-i[0]*o[2],i[0]*o[1]-i[1]*o[0]];r+=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])}return r},t.opc=function(t,e,r,i,o){for(var n=[],s=0;s<t.length;s++)n.push(!1);var l=[],c=0;l.push(0);do{s=l.pop();if(!n[s]){var h=function(t,e,r,i){var o=[],s=0;o.push(i);do{var c=o.pop();a=null,b=null,n[c]=!0;for(var h=0;h<e[c].length;h++){var u=e[c][h];if(!n[u])if(r[u]===r[c]){if(b=a,a=[t[h][0]-t[c][0],t[h][1]-t[c][2],t[h][1]-t[c][2]],a&&b){var m=[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];s+=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2])}o.push(u)}else l.push(u)}}while(0!=o.length);return s}(t,e,r,s);(h/=o)>i&&(c+=1)}}while(0!=l.length);return c},t.angleRangeClamp=function(t){return t>2*Math.PI?t-2*Math.PI:t<0?t+2*Math.PI:t},t}((morphoviewer=function(t){function e(t,e){var a,i,o,n;if(!(a=document.getElementById(e)))return alert("getShaderFromDOM: no such shader: "+e),null;for(i="",o=a.firstChild;o;)o.nodeType==o.TEXT_NODE&&(i+=o.textContent),o=o.nextSibling;if("x-shader/x-fragment"==a.type)n=r(t,i,"fragment");else{if("x-shader/x-vertex"!=a.type)return alert("getShaderFromDOM: unknown shader type, returning null."),null;n=r(t,i,"vertex")}return n}function r(t,e,r){var a;if("fragment"==r)a=t.createShader(t.FRAGMENT_SHADER);else{if("vertex"!=r)return alert("getShaderFromString: unknown shader type, returning null."),null;a=t.createShader(t.VERTEX_SHADER)}return t.shaderSource(a,e),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?a:(alert("getShaderFromString: could not compile "+r+" shader: "+t.getShaderInfoLog(a)),null)}function a(t,e,r){var a=t.createProgram();return t.attachShader(a,e),t.attachShader(a,r),t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||console.log("getProgram: unable to link the shader program "+t.getProgramInfoLog(a)),a}function i(t,e,r){return t<e?t=e:t>r&&(t=r),t}function o(t,e,r){return r>1&&(r=1),t+r*(e-t)}function n(t,e){var r=mat3.create();return r[0]=Math.cos(e)+t[0]*t[0]*(1-Math.cos(e)),r[1]=t[0]*t[1]*(1-Math.cos(e))-t[2]*Math.sin(e),r[2]=t[0]*t[2]*(1-Math.cos(e))+t[1]*Math.sin(e),r[3]=t[1]*t[0]*(1-Math.cos(e))+t[2]*Math.sin(e),r[4]=Math.cos(e)+t[1]*t[1]*(1-Math.cos(e)),r[5]=t[1]*t[2]*(1-Math.cos(e))-t[0]*Math.sin(e),r[6]=t[2]*t[0]*(1-Math.cos(e))-t[1]*Math.sin(e),r[7]=t[2]*t[1]*(1-Math.cos(e))+t[0]*Math.sin(e),r[8]=Math.cos(e)+t[2]*t[2]*(1-Math.cos(e)),r}return t.Program=function(t){this.gl=t,this.object=null},t.Program.prototype.programFromDOM=function(t,r){var i=e(this.gl,r),o=e(this.gl,t);this.object=a(this.gl,o,i)},t.Program.prototype.programFromString=function(t,e){var i=r(this.gl,t,"vertex"),o=r(this.gl,e,"fragment");this.object=a(this.gl,i,o)},t.Program.prototype.use=function(){this.gl.useProgram(this.object)},t.Program.prototype.isInUse=function(){return 0==this.object},t.Program.prototype.stopUsing=function(){this.isInUse()&&this.gl.useProgram(null)},t.Program.prototype.attribute=function(t){var e=this.gl.getAttribLocation(this.object,t);return-1==e?(console.log("Program.attribute: shader attribute "+t+" not found."),null):e},t.Program.prototype.uniform=function(t){var e=this.gl.getUniformLocation(this.object,t);return-1==e?(console.log("Program.uniform: shader uniform "+t+" not found."),null):e},t.Program.prototype.setUniform=function(t,e,r){switch(r.type){case"float":this.gl.uniform1f(this.uniform(t),e);break;case"vec3":this.gl.uniform3fv(this.uniform(t),e);break;case"vec4":this.gl.uniform4fv(this.uniform(t),e);break;case"mat3":this.gl.uniformMatrix3fv(this.uniform(t),e);break;case"mat4":this.gl.uniformMatrix4fv(this.uniform(t),!1,e);break;case"int":this.gl.uniform1i(this.uniform(t),e);break;default:console.log("Program.setUniform: unknown type "+r.type)}},t.BufferObject=function(t,e){this.gl=t,this.target=e,this.object=this.gl.createBuffer()},t.BufferObject.prototype.dataStore=function(t,e){this.bind(),this.gl.bufferData(this.target,t,e),this.unbind()},t.BufferObject.prototype.bind=function(){this.gl.bindBuffer(this.target,this.object)},t.BufferObject.prototype.unbind=function(){this.gl.bindBuffer(this.target,null)},t.Mesh=function(t){this.gl=t,this.vbo=null,this.numVertices=0,this.contains={vertex:!1,barycentric:!1,normal:!1,curvature:!1,orientation:!1}},t.Mesh.prototype.object=function(){return this.vbo},t.Mesh.prototype.build=function(t){t.vertex.length;var e=[];if(void 0!==t.vertex){e=t.vertex.slice(),this.numVertices=e.length/3,this.contains.vertex=!0;for(var r=new Array(e.length),a=0;a<3*this.numVertices;a+=9)r[a]=1,r[a+1]=0,r[a+2]=0,r[a+3]=0,r[a+4]=1,r[a+5]=0,r[a+6]=0,r[a+7]=0,r[a+8]=1;e=e.concat(r),this.contains.barycentric=!0}else alert("morphoviewer.Mesh.build error: no vertices supplied!");void 0!==t.normal&&(e=e.concat(t.normal),this.contains.normal=!0),void 0!==t.curvature&&(e=e.concat(t.curvature),this.contains.curvature=!0),void 0!==t.orientation&&(e=e.concat(t.orientation),this.contains.orientation=!0),this.vbo=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Mesh.prototype.has=function(t){return this.contains[t]},t.Mesh.prototype.vertices=function(){return this.numVertices},t.Mesh.prototype.bind=function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo)},t.Mesh.prototype.unbind=function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Camera=function(t,e,r,a){this.position=vec3.fromValues(0,0,2),this.targetPosition=vec3.fromValues(0,0,2),this.targetRadius=2,this.radius=10,this.polar=Math.PI/2,this.azimuth=0,this.viewTransform=mat4.create(),this.sensitivity=.1*this.radius,this.verticalFOV=t,this.aspectRatio=e,this.nearPlane=r,this.farPlane=a,this.viewPerspective=!1,this.zoomFactor=1,this.targetZoomFactor=1},t.Camera.prototype.setFOV=function(t){this.verticalFOV=t,this.verticalFOV<=0&&(this.verticalFOV=Math.abs(this.verticalFOV))},t.Camera.prototype.matrix=function(){return mat4.multiply(mat4.create(),this.perspective(),this.view())},t.Camera.prototype.viewAsOrtho=function(){this.viewPerspective=!1},t.Camera.prototype.viewAsPerspective=function(){this.viewPerspective=!0},t.Camera.prototype.perspective=function(){return this.viewPerspective?mat4.perspective(mat4.create(),this.verticalFOV,this.aspectRatio,this.nearPlane,this.farPlane):mat4.ortho(mat4.create(),-o(this.nearPlane,this.farPlane,.01*this.aspectRatio*this.zoomFactor),o(this.nearPlane,this.farPlane,.01*this.aspectRatio*this.zoomFactor),-o(this.nearPlane,this.farPlane,.01*this.zoomFactor),o(this.nearPlane,this.farPlane,.01*this.zoomFactor),this.nearPlane,this.farPlane)},t.Camera.prototype.view=function(){return this.viewTransform},t.Camera.prototype.distanceFromOrigin=function(){return this.radius},t.Camera.prototype.setFOV=function(t){if(t<0)throw"Camera.setFOV: negative vertical field of view";this.verticalFOV=t},t.Camera.prototype.setAspectRatio=function(t){if(t<0)throw"Camera.setAspectRatio: negative aspect ratio";this.aspectRatio=t},t.Camera.prototype.setNearPlane=function(t){if(t>this.farPlane)throw"Camera.setNearPlane: near plane is farther than the far plane";this.nearPlane=t},t.Camera.prototype.setFarPlane=function(t){if(t<this.nearPlane)throw"Camera.setFarPlane: far plane is nearer than the near plane";this.farPlane=t},t.Camera.prototype.dolly=function(t){this.targetRadius+=this.sensitivity*t,this.targetRadius<0&&(this.targetRadius=.001)},t.Camera.prototype.orbit=function(t,e){this.polar-=e,this.polar=i(this.polar,.01,Math.PI),this.azimuth-=t},t.Camera.prototype.update=function(t){this.targetZoomFactor=.07*this.targetRadius,this.zoomFactor=o(this.zoomFactor,this.targetZoomFactor,20*t),this.radius=o(this.radius,this.targetRadius,20*t),this.sensitivity=.1*this.radius;var e=vec3.fromValues(Math.sin(this.polar)*Math.sin(this.azimuth),Math.cos(this.polar),Math.sin(this.polar)*Math.cos(this.azimuth));this.targetPosition=vec3.scale(vec3.create(),e,this.radius),vec3.lerp(this.position,this.position,this.targetPosition,20*t),mat4.lookAt(this.viewTransform,this.position,vec3.create(0,0,0),this.up())},t.Camera.prototype.setBestPositionForModel=function(t){var e=Math.max(Math.abs(t.max.y),Math.abs(t.min.y)),r=Math.max(Math.abs(t.max.x),Math.abs(t.min.x)),a=Math.max(e,r);this.targetRadius=1.1*a/Math.tan(.5*this.verticalFOV)},t.Camera.prototype.rotation=function(){return mat3.multiply(mat3.create(),n([0,0,1],this.azimuth),n([1,0,0],.5*Math.PI-this.polar))},t.Camera.prototype.forward=function(){var t=vec3.normalize(vec3.create(),this.position);return vec3.fromValues(-t[0],-t[1],-t[2])},t.Camera.prototype.right=function(){var t=this.radius*Math.sin(this.polar)*Math.cos(this.azimuth),e=-this.radius*Math.sin(this.polar)*Math.sin(this.azimuth);return vec3.normalize(vec3.create(),vec3.fromValues(t,0,e))},t.Camera.prototype.up=function(){return vec3.cross(vec3.create(),this.right(),this.forward())},t.Camera.prototype.positionLeft=function(){this.polar=Math.PI/2,this.azimuth=Math.PI/2},t.Camera.prototype.positionRight=function(){this.polar=Math.PI/2,this.azimuth=3*Math.PI/2},t.Camera.prototype.positionTop=function(){this.polar=.001,this.azimuth=0},t.Camera.prototype.positionBottom=function(){this.polar=Math.PI,this.azimuth=0},t.Camera.prototype.positionFront=function(){this.polar=Math.PI/2,this.azimuth=0},t.Camera.prototype.positionBack=function(){this.polar=Math.PI/2,this.azimuth=Math.PI},t.color={camera:mat4.create(),model:mat4.create(),colorMode:1,enableAttributes:function(t,e){t.enableVertexAttribArray(e.attribute("vert")),t.enableVertexAttribArray(e.attribute("curvature")),t.enableVertexAttribArray(e.attribute("orientation"))},setAttributes:function(t,e,r,a){t.vertexAttribPointer(e.attribute("vert"),3,t.FLOAT,!1,0,0),a.has("curvature")&&a.has("orientation")&&(t.vertexAttribPointer(e.attribute("curvature"),1,t.FLOAT,t.FALSE,0,36*r),t.vertexAttribPointer(e.attribute("orientation"),1,t.FLOAT,t.FALSE,0,40*r))},setUniforms:function(t){t.setUniform("camera",this.camera,{type:"mat4"}),t.setUniform("model",this.model,{type:"mat4"}),t.setUniform("colorMode",this.colorMode,{type:"int"})},vertex:"precision mediump float;\nattribute vec3 vert;\nattribute float curvature;\nattribute float orientation;\nuniform mat4 model;\nuniform mat4 camera;\nuniform int colorMode;\nvarying vec4 fragColor;\nvec4 yellowToRed( float scalar );\nvec4 longRainbow( float scalar );\nvec4 shortRainbow( float scalar );\nvoid main() {\n\tif ( colorMode == 1 ) {\t//dirichlet normal energy\n       float scalar = ( exp(1.3*curvature) - 1.0 ) / ( exp(1.3) - 1.0 );\n       \n       \n\t\tfragColor = yellowToRed( scalar );\n\t} else if ( colorMode == 2 ) {\t//orientation map\n\t\tfragColor = longRainbow( orientation );\n\t}\n\tgl_Position = camera * model * vec4( vert, 1.0 );\n}\nvec4 yellowToRed( float scalar ) {\nvec4 color = vec4( 0.0, 0.0, 0.0, 1.0 );\ncolor.r = 1.0;\ncolor.g = 1.0 - scalar;\nreturn color;\n}\nvec4 longRainbow( float scalar ) {\nscalar = scalar/2; \nvec3 color = vec3( 0.0, 0.0, 0.0 );\nif ( scalar >= 0.0 && scalar < 0.1666 ) {\n\tcolor.g = scalar * 6.0;\n\tcolor.b = 1.0;\n} else if ( scalar >= 0.1666 && scalar < 0.3333 ) {\n\tcolor.g = 1.0;\n\tcolor.b = 1.0 - 6.0 * (scalar - 0.1666);\n} else if ( scalar >= 0.3333 && scalar < 0.5000 ) {\n\tcolor.r = 6.0 * (scalar - 0.3333);\n\tcolor.g = 1.0;\n} else if ( scalar >= 0.5000 && scalar < 0.6666 ) {\n\tcolor.r = 1.0;\n\tcolor.g = 1.0 - 6.0 * (scalar - 0.5000);\n} else if ( scalar >= 0.6666 && scalar < 0.8333 ) {\n   color.b = 6.0*(scalar - 0.6666);\n   color.r = 1.0;\n} else if ( scalar >= 0.8333 && scalar <= 1.0 ) {\n   color.b = 1.0;\n   color.r = 1.0 - 6.0 * (scalar - 0.8333);\n}\nreturn vec4( 0.0, 0.0, 0.0, 1.0 );\n}\nvec4 shortRainbow( float scalar ) {\t//scalar must be normalized!\nvec3 color = vec3( 0.0, 0.0, 0.0 );\nif ( scalar >= 0.0 && scalar < 0.25 ) {\n\tcolor.g = scalar * 4.0;\t//green varies linearly between [0,1]\n\tcolor.b = 1.0;\t\t\t//blue is maxed out\n} else if ( scalar >= 0.25 && scalar < 0.35 ) {\n\tcolor.g = 1.0;\t\t\t//green is maxed out\n\tcolor.b = 1.0 - 10.0 * ( scalar - 0.25 );\t//blue varies between [1,0]\n} else if ( scalar >= 0.35 && scalar < 0.75 ) {\n\tcolor.r = ( scalar - 0.35 ) * 2.5;\t//red varies between [0,1]\n\tcolor.g = 1.0;\t\t\t\t\t//green is maxed out\n} else if ( scalar >= 0.75 && scalar <= 1.0 ) {\n\tcolor.r = 1.0;\t//red is maxed out\n\tcolor.g = 1.0 - 4.0 * ( scalar - 0.75 );\t//green varies between [1,0]\n}\nreturn vec4( color, 1.0 );\n}\n",fragment:"precision mediump float;\nvarying vec4 fragColor;\nvoid main() {\n\tgl_FragColor = fragColor;\n}\n"},t.wireframe={camera:mat4.create(),model:mat4.create(),surfaceColor:vec3.fromValues(.6,.6,.6),enableAttributes:function(t,e){t.enableVertexAttribArray(e.attribute("vert")),t.enableVertexAttribArray(e.attribute("barycentric"))},setAttributes:function(t,e,r){t.vertexAttribPointer(e.attribute("vert"),3,t.FLOAT,!1,0,0),t.vertexAttribPointer(e.attribute("barycentric"),3,t.FLOAT,!1,0,12*r)},setUniforms:function(t){t.setUniform("camera",this.camera,{type:"mat4"}),t.setUniform("model",this.model,{type:"mat4"}),t.setUniform("surfaceColor",this.surfaceColor,{type:"vec3"})},vertex:"attribute vec3 vert;\nattribute vec3 barycentric;\nuniform mat4 camera;\nuniform mat4 model;\nvarying mediump vec3 barycentricPos;\nvoid main( void ) {\n\tbarycentricPos = barycentric;\n\tgl_Position = camera * model * vec4( vert, 1.0 );\n}",fragment:"uniform mediump vec3 surfaceColor;\nvarying mediump vec3 barycentricPos;\nvoid main( void ) {\n\tif ( any( lessThan( barycentricPos, vec3( 0.02 ) ) ) ) {\n\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t} else {\n\t\tgl_FragColor = vec4( surfaceColor, 1.0 );\n\t}\n}"},t.hemisphere={camera:mat4.create(),model:mat4.create(),normalMatrix:mat4.create(),skyColor:vec3.fromValues(.83,.819,.819),groundColor:vec3.fromValues(.181,.161,.095),polar:0,azimuth:0,enableAttributes:function(t,e){t.enableVertexAttribArray(e.attribute("vert")),t.enableVertexAttribArray(e.attribute("norm"))},setAttributes:function(t,e,r){t.vertexAttribPointer(e.attribute("vert"),3,t.FLOAT,!1,0,0),t.vertexAttribPointer(e.attribute("norm"),3,t.FLOAT,!1,0,24*r)},setUniforms:function(t){var e=vec3.fromValues(Math.sin(this.polar)*Math.sin(this.azimuth),Math.cos(this.polar),Math.sin(this.polar)*Math.cos(this.azimuth));t.setUniform("lightPosition",e,{type:"vec3"}),t.setUniform("skyColor",this.skyColor,{type:"vec3"}),t.setUniform("groundColor",this.groundColor,{type:"vec3"});var r=mat4.create();mat4.invert(r,this.model),mat4.transpose(r,r),t.setUniform("normalMatrix",r,{type:"mat4"}),t.setUniform("camera",this.camera,{type:"mat4"}),t.setUniform("model",this.model,{type:"mat4"})},vertex:"precision mediump float;\nattribute vec3 vert;\nattribute vec3 norm;\nuniform mat4 camera;\nuniform mat4 model;\nuniform mat4 normalMatrix;\nuniform vec3 lightPosition;\nuniform vec3 skyColor;\nuniform vec3 groundColor;\nvarying vec3 fragColor;\nvoid main() {\n\tvec3 fragNormal = vec3( normalMatrix * vec4( norm, 0.0 ) );\n\tvec3 position = vec3( model * vec4( vert, 1.0 ) );\n\tvec3 lightVector = normalize( lightPosition - normalize( position ) );\n\tfloat theta = dot( fragNormal, lightVector );\n\tfloat a = theta * 0.5 + 0.5;\n\tfragColor = mix( groundColor, skyColor, a );\n\tgl_Position = camera * model * vec4( vert, 1.0 );\n}",fragment:"precision mediump float;\nvarying vec3 fragColor;\nvoid main() {\n\tgl_FragColor = vec4(fragColor, 1.0 );\n}"},t.flatShader={camera:mat4.create(),model:mat4.create(),surfaceColor:vec3.fromValues(.8,.8,.8),enableAttributes:function(t,e){t.enableVertexAttribArray(e.attribute("vert"))},setAttributes:function(t,e){t.vertexAttribPointer(e.attribute("vert"),3,t.FLOAT,!1,0,0)},setUniforms:function(t){t.setUniform("camera",this.camera,{type:"mat4"}),t.setUniform("model",this.model,{type:"mat4"}),t.setUniform("surfaceColor",this.surfaceColor,{type:"vec3"})},vertex:"attribute vec3 vert;\nuniform mat4 camera;\nuniform mat4 model;\nvoid main( void ) {\n\tgl_Position = camera * model * vec4( vert, 1.0 );\n}",fragment:"uniform mediump vec3 surfaceColor;\nvoid main( void ) {\n\tgl_FragColor = vec4( surfaceColor, 1.0 );\n}"},t}((morphoviewer=function(t){return t.rotationMatrix4=function(t,e){var r=vec3.cross(vec3.create(),t,e),a=r[0],i=r[1],o=r[2],n=vec3.dot(t,e),s=1/(1+n),l=new glMatrix.ARRAY_TYPE(16);return l[0]=n+s*a*a,l[1]=s*a*i-o,l[2]=s*a*o+i,l[3]=0,l[4]=s*a*i+o,l[5]=n+s*i*i,l[6]=s*i*o-a,l[7]=0,l[8]=s*a*o-i,l[9]=s*i*o+a,l[10]=n+s*o*o,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},t.Plane=function(t,e,r){this.point=t,this.planeVec1=vec3.subtract(vec3.create(),e,t),this.planeVec2=vec3.subtract(vec3.create(),r,t),this.normal=vec3.normalize(vec3.create(),vec3.cross(vec3.create(),this.planeVec1,this.planeVec2))},t.Plane.prototype.eval=function(t){mat3.determinant(mat3.fromRows(mat3.create(),t,this.planeVec1,this.planeVec2))},t.Plane.prototype.flip=function(){vec3.subtract(this.planeVec1,vec3.fromValues(0,0,0),this.planeVec1),this.normal=vec3.normalize(vec3.create(),vec3.cross(vec3.create(),this.planeVec1,this.planeVec2))},t.Plane.prototype.getNormal=function(){return vec3.clone(this.normal)},t}((morphoviewer=function(t){function e(t,e){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(t){e(t.target.response)},r.send()}function r(t,e,r){void 0===r&&(r=!1),void 0===e&&(e=0),arguments.callee.bytes=t.length,arguments.callee.buffer=t,arguments.callee.view=jDataView(t,e,t.length-e,r)}function a(t,e){for(var r=0;r<t.length;r++){var a=t[r];if(e.append(a),"end_header"===a)return!0}return!1}function o(){for(var t=new b;;){var e=r.readLine().split(" "),i=e[0];if("ply"!==i&&"comment"!==i&&a(e,t))break}return t}function n(){for(var t=o(),e={},r=[],a="";;){var i=t.get();if("format"===i)a=l(t);else if("element"===i)r.push(c(t,e,a));else if("end_header"===i)break}return[r,e,a]}function s(t){for(var e=0;e<t.length;e++)t[e].parseElement()}function l(t){var e=t.get(),r="";return"ascii"===e?r="ascii":"binary_little_endian"===e?r="little":"binary_big_endian"===e&&(r="big"),t.get(),r}function c(t,e,r){var a=t.get();e[a]={};for(var i=t.get(),o=new P(parseInt(i));"property"===t.peek();)o.append(h(t,e[a],r));return o}function h(t,e,r){t.get();var a;if("list"===t.peek()){t.get();var i=t.get(),o=t.get(),n=t.get();e[n]=[],"ascii"===r?a=new C(e[n],i,o):"little"!==r&&"big"!==r||(a=new V(e[n],i,o))}else{var s=t.get(),l=t.get();e[l]=[],"ascii"===r?a=new F(e[l],s):"little"!==r&&"big"!==r||(a=new A(e[l],s))}return a}function u(){for(var t={v:[],f:[]};r.tell()<r.end();){var e=r.readLine().split(" "),a=t.v,i=t.f;"v"==e[0]&&a.push([parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])]);var o=!1,n=t.vn;if("vn"==e[0]&&(o||(t.vn=[],n=t.vn,o=!0),n.push([parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])])),"f"==e[0]){for(var s=[],l=parseInt(e[1])-1,c=2;c<e.length;c+=2){var h=parseInt(e[c])-1,u=parseInt(e[c+1])-1;s.push(l,h,u)}i.push(s)}}return t}function m(t){f(t)}function f(t){for(r.readLine();"facet"===r.peekToken();)p(t);var e=r.peekToken();"endsolid"!==e&&console.log("parseSTLSolid: expected endsolid but got "+e)}function p(t){var e=r.readLine().trim().split(/\s+/),a=t.vn;a.push(parseFloat(e[2])),a.push(parseFloat(e[3])),a.push(parseFloat(e[4])),a.push(parseFloat(e[2])),a.push(parseFloat(e[3])),a.push(parseFloat(e[4])),a.push(parseFloat(e[2])),a.push(parseFloat(e[3])),a.push(parseFloat(e[4])),v(t),r.readLine()}function v(t){var e=t.v;for(r.readLine(),i=0;i<3;i++){var a=r.readLine().trim().split(/\s+/);e.push(parseFloat(a[1])),e.push(parseFloat(a[2])),e.push(parseFloat(a[3]))}r.readLine()}function g(t){var e=t.v,a=t.vn;r.seek(80);for(var i=r.getUint32(),o=0;o<i;o++){var n=r.getFloat32(),s=r.getFloat32(),l=r.getFloat32();a.push(n,s,l),a.push(n,s,l),a.push(n,s,l);for(var c=0;c<3;c++)e.push(r.getFloat32(),r.getFloat32(),r.getFloat32());r.getUint16()}}function d(t){for(var e={points:[]},a=e.points;r.tell()<r.end();){var i=r.readLine().split(t);a.push([parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])])}return e}t.io={},t.io.loadFile=function(t,e){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(t){e(t.target.response)},r.send()},t.io.getFileType=function(t){r(t);var e=r.readLine().trim().split(/\s+/);if("solid"===e[0])return"stl";r.seek(80),r.isLittleEndian(!0);var a=r.getUint32();if(r.isLittleEndian(!1),r.seek(0),r.size()==84+50*a)return"stl";if("ply"===e[0])return"ply";var i=r.readLine(),o=r.readLine(),n=r.readLine(),s=i.trim().split(","),l=o.trim().split(","),c=n.trim().split(",");return s.length==l.length&&l.length==c.length&&3==c.length?"csv":"unrecognized"},r.size=function(){return r.bytes},r.isLittleEndian=function(t){var e=r.view.tell(),a=r.buffer.length;r.view=jDataView(r.buffer,e,a-e,t)},r.seek=function(t){r.view.seek(t)},r.tell=function(){return r.view.tell()},r.end=function(){return r.buffer.length},r.getChar=function(){return r.view.getChar()},r.getInt8=function(){return r.view.getInt8()},r.getUint8=function(){return r.view.getUint8()},r.getInt16=function(){return r.view.getInt16()},r.getUint16=function(){return r.view.getUint16()},r.getInt32=function(){return r.view.getInt32()},r.getUint32=function(){return r.view.getUint32()},r.getFloat32=function(){return r.view.getFloat32()},r.getFloat64=function(){return r.view.getFloat64()},r.readLine=function(){for(var t="",e=r.getChar();"\n"!=e;)for(t=t.concat(e),e=r.getChar();"\t"==e||""==e;)e=r.getChar();return t},r.peekChar=function(){var t=r.view.tell(),e=r.view.getChar();return r.view.seek(t),e},r.readToken=function(){if(r.view.tell()>=r.buffer.length)throw console.log("BufferView.readToken: position: "+r.view.tell()+", length: "+r.buffer.length),"BufferView.readToken: current position out of file bounds";for(var t,e=[];;){if("\n"!=(t=r.peekChar())&&" "!=t)break;r.getChar()}for(;;){if("\n"==(t=r.peekChar())||" "==t)break;e.push(r.getChar())}return e.join("")},r.peekToken=function(){var t=r.view.tell(),e=r.readToken();return r.view.seek(t),e};var b=function(){this.tokenStream=[],this.index=0,this.end=0};b.prototype.append=function(t){this.tokenStream.push(t),this.end++},b.prototype.get=function(){var t=this.tokenStream[this.index];return++this.index>=this.end&&(this.index=this.end),t},b.prototype.peek=function(t){return void 0===t&&(t=0),this.index+t==this.end?this.tokenStream[this.end]:this.tokenStream[this.index+t]};var w={char:r.getChar,uchar:r.getUint8,short:r.getInt16,ushort:r.getUint16,int:r.getInt32,uint:r.getUint32,float:r.getFloat32,double:r.getFloat64},y={char:parseInt,uchar:parseInt,short:parseInt,ushort:parseInt,int:parseInt,uint:parseInt,float:parseFloat,double:parseFloat},P=function(t){this.count=t,this.propertyParsers=[]};P.prototype.parseElement=function(){for(var t=0;t<this.count;t++)for(var e=0;e<this.propertyParsers.length;e++)this.propertyParsers[e].parse()},P.prototype.append=function(t){this.propertyParsers.push(t)};var A=function(t,e){this.target=t,this.getter=w[e]};A.prototype.parse=function(){this.target.push(this.getter())};var F=function(t,e){this.target=t,this.parser=y[e]};F.prototype.parse=function(){var t=r.readToken();this.target.push(this.parser(t))};var V=function(t,e,r){this.target=t,this.numeratorGetter=w[e],this.listGetter=w[r]};V.prototype.parse=function(){for(var t=this.numeratorGetter(),e=[],r=0;r<t;r++)e.push(this.listGetter());this.target.push(e)};var C=function(t,e,r){this.target=t,this.numeratorParser=y[e],this.listParser=y[r]};return C.prototype.parse=function(){for(var t=r.readToken(),e=this.numeratorParser(t),a=[],i=0;i<e;i++)t=r.readToken(),a.push(this.listParser(t));this.target.push(a)},t.parsePLY=function(t){r(t);var e=n(),a=e[0],i=e[1],o=e[2];if("ascii"!=o){var l=!1;"little"===o&&(l=!0),r.isLittleEndian(l)}return s(a),i},t.io.loadPLY=function(r,a){e(r,function(e){var r=new Uint8Array(e),i=t.parsePLY(r);void 0!==a&&a(i)})},t.parseOBJ=function(t){return r(t),u()},t.io.loadOBJ=function(r,a){e(r,function(e){var r=new Uint8Array(e),i=t.parseOBJ(r);void 0!==a&&a(i)})},t.parseSTL=function(t){r(t,0,!0);var e={v:[],vn:[]};return"solid"===r.peekToken()?m(e):g(e),e},t.io.loadSTL=function(r,a){e(r,function(e){var r=new Uint8Array(e),i=t.parseSTL(r);void 0!==a&&a(i)})},t.parseCSV=function(t,e){return void 0===e&&(e=","),r(t),d(e)},t.io.loadCSV=function(r,a,i){void 0!==i&&(i=",");e(r,function(e){var r=new Uint8Array(e),o=t.parseCSV(r,i);void 0!==a&&a(o)})},t.io.load=function(t,e,r){},t}(morphoviewer||{}))||{}))||{}))||{})))||{});
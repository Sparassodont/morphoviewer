var Delaunay;!function(){"use strict";function r(r){var n,e,t,u,i,l,o=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY;for(n=r.length;n--;)r[n][0]<o&&(o=r[n][0]),r[n][0]>f&&(f=r[n][0]),r[n][1]<a&&(a=r[n][1]),r[n][1]>h&&(h=r[n][1]);return e=f-o,t=h-a,u=Math.max(e,t),i=o+.5*e,l=a+.5*t,[[i-20*u,l-u],[i,l+20*u],[i+20*u,l-u]]}function n(r,n,e,u){var i,l,o,a,f,h,s,I,c,N,p=r[n][0],g=r[n][1],v=r[e][0],E=r[e][1],T=r[u][0],b=r[u][1],k=Math.abs(g-E),m=Math.abs(E-b);if(t>k&&t>m)throw new Error("Eek! Coincident points!");return t>k?(a=-((T-v)/(b-E)),h=(v+T)/2,I=(E+b)/2,i=(v+p)/2,l=a*(i-h)+I):t>m?(o=-((v-p)/(E-g)),f=(p+v)/2,s=(g+E)/2,i=(T+v)/2,l=o*(i-f)+s):(o=-((v-p)/(E-g)),a=-((T-v)/(b-E)),f=(p+v)/2,h=(v+T)/2,s=(g+E)/2,I=(E+b)/2,i=(o*f-a*h+I-s)/(o-a),l=k>m?o*(i-f)+s:a*(i-h)+I),c=v-i,N=E-l,{i:n,j:e,k:u,x:i,y:l,r:c*c+N*N}}function e(r){var n,e,t,u,i,l;for(e=r.length;e;)for(u=r[--e],t=r[--e],n=e;n;)if(l=r[--n],i=r[--n],t===i&&u===l||t===l&&u===i){r.splice(e,2),r.splice(n,2);break}}var t=1/1048576;Delaunay={triangulate:function(u,i){var l,o,a,f,h,s,I,c,N,p,g,v,E=u.length;if(3>E)return[];if(u=u.slice(0),i)for(l=E;l--;)u[l]=u[l][i];for(a=new Array(E),l=E;l--;)a[l]=l;for(a.sort(function(r,n){return u[n][0]-u[r][0]}),f=r(u),u.push(f[0],f[1],f[2]),h=[n(u,E+0,E+1,E+2)],s=[],I=[],l=a.length;l--;I.length=0){for(v=a[l],o=h.length;o--;)c=u[v][0]-h[o].x,c>0&&c*c>h[o].r?(s.push(h[o]),h.splice(o,1)):(N=u[v][1]-h[o].y,c*c+N*N-h[o].r>t||(I.push(h[o].i,h[o].j,h[o].j,h[o].k,h[o].k,h[o].i),h.splice(o,1)));for(e(I),o=I.length;o;)g=I[--o],p=I[--o],h.push(n(u,p,g,v))}for(l=h.length;l--;)s.push(h[l]);for(h.length=0,l=s.length;l--;)s[l].i<E&&s[l].j<E&&s[l].k<E&&h.push(s[l].i,s[l].j,s[l].k);return h},contains:function(r,n){if(n[0]<r[0][0]&&n[0]<r[1][0]&&n[0]<r[2][0]||n[0]>r[0][0]&&n[0]>r[1][0]&&n[0]>r[2][0]||n[1]<r[0][1]&&n[1]<r[1][1]&&n[1]<r[2][1]||n[1]>r[0][1]&&n[1]>r[1][1]&&n[1]>r[2][1])return null;var e=r[1][0]-r[0][0],t=r[2][0]-r[0][0],u=r[1][1]-r[0][1],i=r[2][1]-r[0][1],l=e*i-t*u;if(0===l)return null;var o=(i*(n[0]-r[0][0])-t*(n[1]-r[0][1]))/l,a=(e*(n[1]-r[0][1])-u*(n[0]-r[0][0]))/l;return 0>o||0>a||o+a>1?null:[o,a]}},"undefined"!=typeof module&&(module.exports=Delaunay)}();
var glMatrix={};glMatrix.EPSILON=1e-6,glMatrix.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,glMatrix.RANDOM=Math.random,glMatrix.ENABLE_SIMD=!1,glMatrix.SIMD_AVAILABLE=glMatrix.ARRAY_TYPE===Float32Array&&"SIMD"in this,glMatrix.USE_SIMD=glMatrix.ENABLE_SIMD&&glMatrix.SIMD_AVAILABLE,glMatrix.setMatrixArrayType=function(t){glMatrix.ARRAY_TYPE=t};var degree=Math.PI/180;glMatrix.toRadian=function(t){return t*degree};var vec2={};vec2.create=function(){var t=new glMatrix.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},vec2.clone=function(t){var a=new glMatrix.ARRAY_TYPE(2);return a[0]=t[0],a[1]=t[1],a},vec2.fromValues=function(t,a){var r=new glMatrix.ARRAY_TYPE(2);return r[0]=t,r[1]=a,r},vec2.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t},vec2.set=function(t,a,r){return t[0]=a,t[1]=r,t},vec2.add=function(t,a,r){return t[0]=a[0]+r[0],t[1]=a[1]+r[1],t},vec2.subtract=function(t,a,r){return t[0]=a[0]-r[0],t[1]=a[1]-r[1],t},vec2.sub=vec2.subtract,vec2.multiply=function(t,a,r){return t[0]=a[0]*r[0],t[1]=a[1]*r[1],t},vec2.mul=vec2.multiply,vec2.divide=function(t,a,r){return t[0]=a[0]/r[0],t[1]=a[1]/r[1],t},vec2.div=vec2.divide,vec2.min=function(t,a,r){return t[0]=Math.min(a[0],r[0]),t[1]=Math.min(a[1],r[1]),t},vec2.max=function(t,a,r){return t[0]=Math.max(a[0],r[0]),t[1]=Math.max(a[1],r[1]),t},vec2.scale=function(t,a,r){return t[0]=a[0]*r,t[1]=a[1]*r,t},vec2.scaleAndAdd=function(t,a,r,n){return t[0]=a[0]+r[0]*n,t[1]=a[1]+r[1]*n,t},vec2.distance=function(t,a){var r=a[0]-t[0],n=a[1]-t[1];return Math.sqrt(r*r+n*n)},vec2.dist=vec2.distance,vec2.squaredDistance=function(t,a){var r=a[0]-t[0],n=a[1]-t[1];return r*r+n*n},vec2.sqrDist=vec2.squaredDistance,vec2.length=function(t){var a=t[0],r=t[1];return Math.sqrt(a*a+r*r)},vec2.len=vec2.length,vec2.squaredLength=function(t){var a=t[0],r=t[1];return a*a+r*r},vec2.sqrLen=vec2.squaredLength,vec2.negate=function(t,a){return t[0]=-a[0],t[1]=-a[1],t},vec2.inverse=function(t,a){return t[0]=1/a[0],t[1]=1/a[1],t},vec2.normalize=function(t,a){var r=a[0],n=a[1],e=r*r+n*n;return e>0&&(e=1/Math.sqrt(e),t[0]=a[0]*e,t[1]=a[1]*e),t},vec2.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]},vec2.cross=function(t,a,r){var n=a[0]*r[1]-a[1]*r[0];return t[0]=t[1]=0,t[2]=n,t},vec2.lerp=function(t,a,r,n){var e=a[0],o=a[1];return t[0]=e+n*(r[0]-e),t[1]=o+n*(r[1]-o),t},vec2.random=function(t,a){a=a||1;var r=2*glMatrix.RANDOM()*Math.PI;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t},vec2.transformMat2=function(t,a,r){var n=a[0],e=a[1];return t[0]=r[0]*n+r[2]*e,t[1]=r[1]*n+r[3]*e,t},vec2.transformMat2d=function(t,a,r){var n=a[0],e=a[1];return t[0]=r[0]*n+r[2]*e+r[4],t[1]=r[1]*n+r[3]*e+r[5],t},vec2.transformMat3=function(t,a,r){var n=a[0],e=a[1];return t[0]=r[0]*n+r[3]*e+r[6],t[1]=r[1]*n+r[4]*e+r[7],t},vec2.transformMat4=function(t,a,r){var n=a[0],e=a[1];return t[0]=r[0]*n+r[4]*e+r[12],t[1]=r[1]*n+r[5]*e+r[13],t},vec2.forEach=function(){var t=vec2.create();return function(a,r,n,e,o,l){var u,M;for(r||(r=2),n||(n=0),M=e?Math.min(e*r+n,a.length):a.length,u=n;M>u;u+=r)t[0]=a[u],t[1]=a[u+1],o(t,t,l),a[u]=t[0],a[u+1]=t[1];return a}}(),vec2.str=function(t){return"vec2("+t[0]+", "+t[1]+")"};var vec3={};vec3.create=function(){var t=new glMatrix.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},vec3.clone=function(t){var a=new glMatrix.ARRAY_TYPE(3);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a},vec3.fromValues=function(t,a,r){var n=new glMatrix.ARRAY_TYPE(3);return n[0]=t,n[1]=a,n[2]=r,n},vec3.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t},vec3.set=function(t,a,r,n){return t[0]=a,t[1]=r,t[2]=n,t},vec3.add=function(t,a,r){return t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},vec3.subtract=function(t,a,r){return t[0]=a[0]-r[0],t[1]=a[1]-r[1],t[2]=a[2]-r[2],t},vec3.sub=vec3.subtract,vec3.multiply=function(t,a,r){return t[0]=a[0]*r[0],t[1]=a[1]*r[1],t[2]=a[2]*r[2],t},vec3.mul=vec3.multiply,vec3.divide=function(t,a,r){return t[0]=a[0]/r[0],t[1]=a[1]/r[1],t[2]=a[2]/r[2],t},vec3.div=vec3.divide,vec3.min=function(t,a,r){return t[0]=Math.min(a[0],r[0]),t[1]=Math.min(a[1],r[1]),t[2]=Math.min(a[2],r[2]),t},vec3.max=function(t,a,r){return t[0]=Math.max(a[0],r[0]),t[1]=Math.max(a[1],r[1]),t[2]=Math.max(a[2],r[2]),t},vec3.scale=function(t,a,r){return t[0]=a[0]*r,t[1]=a[1]*r,t[2]=a[2]*r,t},vec3.scaleAndAdd=function(t,a,r,n){return t[0]=a[0]+r[0]*n,t[1]=a[1]+r[1]*n,t[2]=a[2]+r[2]*n,t},vec3.distance=function(t,a){var r=a[0]-t[0],n=a[1]-t[1],e=a[2]-t[2];return Math.sqrt(r*r+n*n+e*e)},vec3.dist=vec3.distance,vec3.squaredDistance=function(t,a){var r=a[0]-t[0],n=a[1]-t[1],e=a[2]-t[2];return r*r+n*n+e*e},vec3.sqrDist=vec3.squaredDistance,vec3.length=function(t){var a=t[0],r=t[1],n=t[2];return Math.sqrt(a*a+r*r+n*n)},vec3.len=vec3.length,vec3.squaredLength=function(t){var a=t[0],r=t[1],n=t[2];return a*a+r*r+n*n},vec3.sqrLen=vec3.squaredLength,vec3.negate=function(t,a){return t[0]=-a[0],t[1]=-a[1],t[2]=-a[2],t},vec3.inverse=function(t,a){return t[0]=1/a[0],t[1]=1/a[1],t[2]=1/a[2],t},vec3.normalize=function(t,a){var r=a[0],n=a[1],e=a[2],o=r*r+n*n+e*e;return o>0&&(o=1/Math.sqrt(o),t[0]=a[0]*o,t[1]=a[1]*o,t[2]=a[2]*o),t},vec3.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]},vec3.cross=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=r[0],u=r[1],M=r[2];return t[0]=e*M-o*u,t[1]=o*l-n*M,t[2]=n*u-e*l,t},vec3.lerp=function(t,a,r,n){var e=a[0],o=a[1],l=a[2];return t[0]=e+n*(r[0]-e),t[1]=o+n*(r[1]-o),t[2]=l+n*(r[2]-l),t},vec3.hermite=function(t,a,r,n,e,o){var l=o*o,u=l*(2*o-3)+1,M=l*(o-2)+o,c=l*(o-1),i=l*(3-2*o);return t[0]=a[0]*u+r[0]*M+n[0]*c+e[0]*i,t[1]=a[1]*u+r[1]*M+n[1]*c+e[1]*i,t[2]=a[2]*u+r[2]*M+n[2]*c+e[2]*i,t},vec3.bezier=function(t,a,r,n,e,o){var l=1-o,u=l*l,M=o*o,c=u*l,i=3*o*u,s=3*M*l,x=M*o;return t[0]=a[0]*c+r[0]*i+n[0]*s+e[0]*x,t[1]=a[1]*c+r[1]*i+n[1]*s+e[1]*x,t[2]=a[2]*c+r[2]*i+n[2]*s+e[2]*x,t},vec3.random=function(t,a){a=a||1;var r=2*glMatrix.RANDOM()*Math.PI,n=2*glMatrix.RANDOM()-1,e=Math.sqrt(1-n*n)*a;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t[2]=n*a,t},vec3.transformMat4=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=r[3]*n+r[7]*e+r[11]*o+r[15];return l=l||1,t[0]=(r[0]*n+r[4]*e+r[8]*o+r[12])/l,t[1]=(r[1]*n+r[5]*e+r[9]*o+r[13])/l,t[2]=(r[2]*n+r[6]*e+r[10]*o+r[14])/l,t},vec3.transformMat3=function(t,a,r){var n=a[0],e=a[1],o=a[2];return t[0]=n*r[0]+e*r[3]+o*r[6],t[1]=n*r[1]+e*r[4]+o*r[7],t[2]=n*r[2]+e*r[5]+o*r[8],t},vec3.transformQuat=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=r[0],u=r[1],M=r[2],c=r[3],i=c*n+u*o-M*e,s=c*e+M*n-l*o,x=c*o+l*e-u*n,m=-l*n-u*e-M*o;return t[0]=i*c+m*-l+s*-M-x*-u,t[1]=s*c+m*-u+x*-l-i*-M,t[2]=x*c+m*-M+i*-u-s*-l,t},vec3.rotateX=function(t,a,r,n){var e=[],o=[];return e[0]=a[0]-r[0],e[1]=a[1]-r[1],e[2]=a[2]-r[2],o[0]=e[0],o[1]=e[1]*Math.cos(n)-e[2]*Math.sin(n),o[2]=e[1]*Math.sin(n)+e[2]*Math.cos(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},vec3.rotateY=function(t,a,r,n){var e=[],o=[];return e[0]=a[0]-r[0],e[1]=a[1]-r[1],e[2]=a[2]-r[2],o[0]=e[2]*Math.sin(n)+e[0]*Math.cos(n),o[1]=e[1],o[2]=e[2]*Math.cos(n)-e[0]*Math.sin(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},vec3.rotateZ=function(t,a,r,n){var e=[],o=[];return e[0]=a[0]-r[0],e[1]=a[1]-r[1],e[2]=a[2]-r[2],o[0]=e[0]*Math.cos(n)-e[1]*Math.sin(n),o[1]=e[0]*Math.sin(n)+e[1]*Math.cos(n),o[2]=e[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},vec3.forEach=function(){var t=vec3.create();return function(a,r,n,e,o,l){var u,M;for(r||(r=3),n||(n=0),M=e?Math.min(e*r+n,a.length):a.length,u=n;M>u;u+=r)t[0]=a[u],t[1]=a[u+1],t[2]=a[u+2],o(t,t,l),a[u]=t[0],a[u+1]=t[1],a[u+2]=t[2];return a}}(),vec3.angle=function(t,a){var r=vec3.fromValues(t[0],t[1],t[2]),n=vec3.fromValues(a[0],a[1],a[2]);vec3.normalize(r,r),vec3.normalize(n,n);var e=vec3.dot(r,n);return e>1?0:Math.acos(e)},vec3.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"};var vec4={};vec4.create=function(){var t=new glMatrix.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},vec4.clone=function(t){var a=new glMatrix.ARRAY_TYPE(4);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a},vec4.fromValues=function(t,a,r,n){var e=new glMatrix.ARRAY_TYPE(4);return e[0]=t,e[1]=a,e[2]=r,e[3]=n,e},vec4.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t},vec4.set=function(t,a,r,n,e){return t[0]=a,t[1]=r,t[2]=n,t[3]=e,t},vec4.add=function(t,a,r){return t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t[3]=a[3]+r[3],t},vec4.subtract=function(t,a,r){return t[0]=a[0]-r[0],t[1]=a[1]-r[1],t[2]=a[2]-r[2],t[3]=a[3]-r[3],t},vec4.sub=vec4.subtract,vec4.multiply=function(t,a,r){return t[0]=a[0]*r[0],t[1]=a[1]*r[1],t[2]=a[2]*r[2],t[3]=a[3]*r[3],t},vec4.mul=vec4.multiply,vec4.divide=function(t,a,r){return t[0]=a[0]/r[0],t[1]=a[1]/r[1],t[2]=a[2]/r[2],t[3]=a[3]/r[3],t},vec4.div=vec4.divide,vec4.min=function(t,a,r){return t[0]=Math.min(a[0],r[0]),t[1]=Math.min(a[1],r[1]),t[2]=Math.min(a[2],r[2]),t[3]=Math.min(a[3],r[3]),t},vec4.max=function(t,a,r){return t[0]=Math.max(a[0],r[0]),t[1]=Math.max(a[1],r[1]),t[2]=Math.max(a[2],r[2]),t[3]=Math.max(a[3],r[3]),t},vec4.scale=function(t,a,r){return t[0]=a[0]*r,t[1]=a[1]*r,t[2]=a[2]*r,t[3]=a[3]*r,t},vec4.scaleAndAdd=function(t,a,r,n){return t[0]=a[0]+r[0]*n,t[1]=a[1]+r[1]*n,t[2]=a[2]+r[2]*n,t[3]=a[3]+r[3]*n,t},vec4.distance=function(t,a){var r=a[0]-t[0],n=a[1]-t[1],e=a[2]-t[2],o=a[3]-t[3];return Math.sqrt(r*r+n*n+e*e+o*o)},vec4.dist=vec4.distance,vec4.squaredDistance=function(t,a){var r=a[0]-t[0],n=a[1]-t[1],e=a[2]-t[2],o=a[3]-t[3];return r*r+n*n+e*e+o*o},vec4.sqrDist=vec4.squaredDistance,vec4.length=function(t){var a=t[0],r=t[1],n=t[2],e=t[3];return Math.sqrt(a*a+r*r+n*n+e*e)},vec4.len=vec4.length,vec4.squaredLength=function(t){var a=t[0],r=t[1],n=t[2],e=t[3];return a*a+r*r+n*n+e*e},vec4.sqrLen=vec4.squaredLength,vec4.negate=function(t,a){return t[0]=-a[0],t[1]=-a[1],t[2]=-a[2],t[3]=-a[3],t},vec4.inverse=function(t,a){return t[0]=1/a[0],t[1]=1/a[1],t[2]=1/a[2],t[3]=1/a[3],t},vec4.normalize=function(t,a){var r=a[0],n=a[1],e=a[2],o=a[3],l=r*r+n*n+e*e+o*o;return l>0&&(l=1/Math.sqrt(l),t[0]=r*l,t[1]=n*l,t[2]=e*l,t[3]=o*l),t},vec4.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]},vec4.lerp=function(t,a,r,n){var e=a[0],o=a[1],l=a[2],u=a[3];return t[0]=e+n*(r[0]-e),t[1]=o+n*(r[1]-o),t[2]=l+n*(r[2]-l),t[3]=u+n*(r[3]-u),t},vec4.random=function(t,a){return a=a||1,t[0]=glMatrix.RANDOM(),t[1]=glMatrix.RANDOM(),t[2]=glMatrix.RANDOM(),t[3]=glMatrix.RANDOM(),vec4.normalize(t,t),vec4.scale(t,t,a),t},vec4.transformMat4=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3];return t[0]=r[0]*n+r[4]*e+r[8]*o+r[12]*l,t[1]=r[1]*n+r[5]*e+r[9]*o+r[13]*l,t[2]=r[2]*n+r[6]*e+r[10]*o+r[14]*l,t[3]=r[3]*n+r[7]*e+r[11]*o+r[15]*l,t},vec4.transformQuat=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=r[0],u=r[1],M=r[2],c=r[3],i=c*n+u*o-M*e,s=c*e+M*n-l*o,x=c*o+l*e-u*n,m=-l*n-u*e-M*o;return t[0]=i*c+m*-l+s*-M-x*-u,t[1]=s*c+m*-u+x*-l-i*-M,t[2]=x*c+m*-M+i*-u-s*-l,t[3]=a[3],t},vec4.forEach=function(){var t=vec4.create();return function(a,r,n,e,o,l){var u,M;for(r||(r=4),n||(n=0),M=e?Math.min(e*r+n,a.length):a.length,u=n;M>u;u+=r)t[0]=a[u],t[1]=a[u+1],t[2]=a[u+2],t[3]=a[u+3],o(t,t,l),a[u]=t[0],a[u+1]=t[1],a[u+2]=t[2],a[u+3]=t[3];return a}}(),vec4.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"};var mat2d={};mat2d.create=function(){var t=new glMatrix.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},mat2d.clone=function(t){var a=new glMatrix.ARRAY_TYPE(6);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a},mat2d.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t},mat2d.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},mat2d.invert=function(t,a){var r=a[0],n=a[1],e=a[2],o=a[3],l=a[4],u=a[5],M=r*o-n*e;return M?(M=1/M,t[0]=o*M,t[1]=-n*M,t[2]=-e*M,t[3]=r*M,t[4]=(e*u-o*l)*M,t[5]=(n*l-r*u)*M,t):null},mat2d.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},mat2d.multiply=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3],u=a[4],M=a[5],c=r[0],i=r[1],s=r[2],x=r[3],m=r[4],v=r[5];return t[0]=n*c+o*i,t[1]=e*c+l*i,t[2]=n*s+o*x,t[3]=e*s+l*x,t[4]=n*m+o*v+u,t[5]=e*m+l*v+M,t},mat2d.mul=mat2d.multiply,mat2d.rotate=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3],u=a[4],M=a[5],c=Math.sin(r),i=Math.cos(r);return t[0]=n*i+o*c,t[1]=e*i+l*c,t[2]=n*-c+o*i,t[3]=e*-c+l*i,t[4]=u,t[5]=M,t},mat2d.scale=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3],u=a[4],M=a[5],c=r[0],i=r[1];return t[0]=n*c,t[1]=e*c,t[2]=o*i,t[3]=l*i,t[4]=u,t[5]=M,t},mat2d.translate=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3],u=a[4],M=a[5],c=r[0],i=r[1];return t[0]=n,t[1]=e,t[2]=o,t[3]=l,t[4]=n*c+o*i+u,t[5]=e*c+l*i+M,t},mat2d.fromRotation=function(t,a){var r=Math.sin(a),n=Math.cos(a);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t},mat2d.fromScaling=function(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=a[1],t[4]=0,t[5]=0,t},mat2d.fromTranslation=function(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=a[0],t[5]=a[1],t},mat2d.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},mat2d.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)};var mat2={};mat2.create=function(){var t=new glMatrix.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},mat2.clone=function(t){var a=new glMatrix.ARRAY_TYPE(4);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a},mat2.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t},mat2.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},mat2.transpose=function(t,a){if(t===a){var r=a[1];t[1]=a[2],t[2]=r}else t[0]=a[0],t[1]=a[2],t[2]=a[1],t[3]=a[3];return t},mat2.invert=function(t,a){var r=a[0],n=a[1],e=a[2],o=a[3],l=r*o-e*n;return l?(l=1/l,t[0]=o*l,t[1]=-n*l,t[2]=-e*l,t[3]=r*l,t):null},mat2.adjoint=function(t,a){var r=a[0];return t[0]=a[3],t[1]=-a[1],t[2]=-a[2],t[3]=r,t},mat2.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},mat2.multiply=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3],u=r[0],M=r[1],c=r[2],i=r[3];return t[0]=n*u+o*M,t[1]=e*u+l*M,t[2]=n*c+o*i,t[3]=e*c+l*i,t},mat2.mul=mat2.multiply,mat2.rotate=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3],u=Math.sin(r),M=Math.cos(r);return t[0]=n*M+o*u,t[1]=e*M+l*u,t[2]=n*-u+o*M,t[3]=e*-u+l*M,t},mat2.scale=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3],u=r[0],M=r[1];return t[0]=n*u,t[1]=e*u,t[2]=o*M,t[3]=l*M,t},mat2.fromRotation=function(t,a){var r=Math.sin(a),n=Math.cos(a);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t},mat2.fromScaling=function(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=a[1],t},mat2.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},mat2.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},mat2.LDU=function(t,a,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,a,r]};var mat4={scalar:{},SIMD:{}};mat4.create=function(){var t=new glMatrix.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.clone=function(t){var a=new glMatrix.ARRAY_TYPE(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},mat4.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.scalar.transpose=function(t,a){if(t===a){var r=a[1],n=a[2],e=a[3],o=a[6],l=a[7],u=a[11];t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=r,t[6]=a[9],t[7]=a[13],t[8]=n,t[9]=o,t[11]=a[14],t[12]=e,t[13]=l,t[14]=u}else t[0]=a[0],t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=a[1],t[5]=a[5],t[6]=a[9],t[7]=a[13],t[8]=a[2],t[9]=a[6],t[10]=a[10],t[11]=a[14],t[12]=a[3],t[13]=a[7],t[14]=a[11],t[15]=a[15];return t},mat4.SIMD.transpose=function(t,a){var r,n,e,o,l,u,M,c,i,s;return r=SIMD.Float32x4.load(a,0),n=SIMD.Float32x4.load(a,4),e=SIMD.Float32x4.load(a,8),o=SIMD.Float32x4.load(a,12),l=SIMD.Float32x4.shuffle(r,n,0,1,4,5),u=SIMD.Float32x4.shuffle(e,o,0,1,4,5),M=SIMD.Float32x4.shuffle(l,u,0,2,4,6),c=SIMD.Float32x4.shuffle(l,u,1,3,5,7),SIMD.Float32x4.store(t,0,M),SIMD.Float32x4.store(t,4,c),l=SIMD.Float32x4.shuffle(r,n,2,3,6,7),u=SIMD.Float32x4.shuffle(e,o,2,3,6,7),i=SIMD.Float32x4.shuffle(l,u,0,2,4,6),s=SIMD.Float32x4.shuffle(l,u,1,3,5,7),SIMD.Float32x4.store(t,8,i),SIMD.Float32x4.store(t,12,s),t},mat4.transpose=glMatrix.USE_SIMD?mat4.SIMD.transpose:mat4.scalar.transpose,mat4.scalar.invert=function(t,a){var r=a[0],n=a[1],e=a[2],o=a[3],l=a[4],u=a[5],M=a[6],c=a[7],i=a[8],s=a[9],x=a[10],m=a[11],v=a[12],D=a[13],S=a[14],I=a[15],f=r*u-n*l,F=r*M-e*l,h=r*c-o*l,d=n*M-e*u,z=n*c-o*u,w=e*c-o*M,g=i*D-s*v,p=i*S-x*v,q=i*I-m*v,A=s*S-x*D,R=s*I-m*D,b=x*I-m*S,Y=f*b-F*R+h*A+d*q-z*p+w*g;return Y?(Y=1/Y,t[0]=(u*b-M*R+c*A)*Y,t[1]=(e*R-n*b-o*A)*Y,t[2]=(D*w-S*z+I*d)*Y,t[3]=(x*z-s*w-m*d)*Y,t[4]=(M*q-l*b-c*p)*Y,t[5]=(r*b-e*q+o*p)*Y,t[6]=(S*h-v*w-I*F)*Y,t[7]=(i*w-x*h+m*F)*Y,t[8]=(l*R-u*q+c*g)*Y,t[9]=(n*q-r*R-o*g)*Y,t[10]=(v*z-D*h+I*f)*Y,t[11]=(s*h-i*z-m*f)*Y,t[12]=(u*p-l*A-M*g)*Y,t[13]=(r*A-n*p+e*g)*Y,t[14]=(D*F-v*d-S*f)*Y,t[15]=(i*d-s*F+x*f)*Y,t):null},mat4.SIMD.invert=function(t,a){var r,n,e,o,l,u,M,c,i,s,x=SIMD.Float32x4.load(a,0),m=SIMD.Float32x4.load(a,4),v=SIMD.Float32x4.load(a,8),D=SIMD.Float32x4.load(a,12);return l=SIMD.Float32x4.shuffle(x,m,0,1,4,5),n=SIMD.Float32x4.shuffle(v,D,0,1,4,5),r=SIMD.Float32x4.shuffle(l,n,0,2,4,6),n=SIMD.Float32x4.shuffle(n,l,1,3,5,7),l=SIMD.Float32x4.shuffle(x,m,2,3,6,7),o=SIMD.Float32x4.shuffle(v,D,2,3,6,7),e=SIMD.Float32x4.shuffle(l,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,l,1,3,5,7),l=SIMD.Float32x4.mul(e,o),l=SIMD.Float32x4.swizzle(l,1,0,3,2),u=SIMD.Float32x4.mul(n,l),M=SIMD.Float32x4.mul(r,l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,l),u),M=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,l),M),M=SIMD.Float32x4.swizzle(M,2,3,0,1),l=SIMD.Float32x4.mul(n,e),l=SIMD.Float32x4.swizzle(l,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,l),u),i=SIMD.Float32x4.mul(r,l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(o,l)),i=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,l),i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,2,3,0,1),o),l=SIMD.Float32x4.swizzle(l,1,0,3,2),e=SIMD.Float32x4.swizzle(e,2,3,0,1),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,l),u),c=SIMD.Float32x4.mul(r,l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(e,l)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,l),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.mul(r,n),l=SIMD.Float32x4.swizzle(l,1,0,3,2),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,l),c),i=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,l),i),l=SIMD.Float32x4.swizzle(l,2,3,0,1),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,l),c),i=SIMD.Float32x4.sub(i,SIMD.Float32x4.mul(e,l)),l=SIMD.Float32x4.mul(r,o),l=SIMD.Float32x4.swizzle(l,1,0,3,2),M=SIMD.Float32x4.sub(M,SIMD.Float32x4.mul(e,l)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,l),c),l=SIMD.Float32x4.swizzle(l,2,3,0,1),M=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,l),M),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(n,l)),l=SIMD.Float32x4.mul(r,e),l=SIMD.Float32x4.swizzle(l,1,0,3,2),M=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,l),M),i=SIMD.Float32x4.sub(i,SIMD.Float32x4.mul(n,l)),l=SIMD.Float32x4.swizzle(l,2,3,0,1),M=SIMD.Float32x4.sub(M,SIMD.Float32x4.mul(o,l)),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,l),i),s=SIMD.Float32x4.mul(r,u),s=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(s,2,3,0,1),s),s=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(s,1,0,3,2),s),l=SIMD.Float32x4.reciprocalApproximation(s),s=SIMD.Float32x4.sub(SIMD.Float32x4.add(l,l),SIMD.Float32x4.mul(s,SIMD.Float32x4.mul(l,l))),(s=SIMD.Float32x4.swizzle(s,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(s,u)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(s,M)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(s,c)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(s,i)),t):null},mat4.invert=glMatrix.USE_SIMD?mat4.SIMD.invert:mat4.scalar.invert,mat4.scalar.adjoint=function(t,a){var r=a[0],n=a[1],e=a[2],o=a[3],l=a[4],u=a[5],M=a[6],c=a[7],i=a[8],s=a[9],x=a[10],m=a[11],v=a[12],D=a[13],S=a[14],I=a[15];return t[0]=u*(x*I-m*S)-s*(M*I-c*S)+D*(M*m-c*x),t[1]=-(n*(x*I-m*S)-s*(e*I-o*S)+D*(e*m-o*x)),t[2]=n*(M*I-c*S)-u*(e*I-o*S)+D*(e*c-o*M),t[3]=-(n*(M*m-c*x)-u*(e*m-o*x)+s*(e*c-o*M)),t[4]=-(l*(x*I-m*S)-i*(M*I-c*S)+v*(M*m-c*x)),t[5]=r*(x*I-m*S)-i*(e*I-o*S)+v*(e*m-o*x),t[6]=-(r*(M*I-c*S)-l*(e*I-o*S)+v*(e*c-o*M)),t[7]=r*(M*m-c*x)-l*(e*m-o*x)+i*(e*c-o*M),t[8]=l*(s*I-m*D)-i*(u*I-c*D)+v*(u*m-c*s),t[9]=-(r*(s*I-m*D)-i*(n*I-o*D)+v*(n*m-o*s)),t[10]=r*(u*I-c*D)-l*(n*I-o*D)+v*(n*c-o*u),t[11]=-(r*(u*m-c*s)-l*(n*m-o*s)+i*(n*c-o*u)),t[12]=-(l*(s*S-x*D)-i*(u*S-M*D)+v*(u*x-M*s)),t[13]=r*(s*S-x*D)-i*(n*S-e*D)+v*(n*x-e*s),t[14]=-(r*(u*S-M*D)-l*(n*S-e*D)+v*(n*M-e*u)),t[15]=r*(u*x-M*s)-l*(n*x-e*s)+i*(n*M-e*u),t},mat4.SIMD.adjoint=function(t,a){var r,n,e,o,l,u,M,c,i,s,x,m,v,r=SIMD.Float32x4.load(a,0),n=SIMD.Float32x4.load(a,4),e=SIMD.Float32x4.load(a,8),o=SIMD.Float32x4.load(a,12);return i=SIMD.Float32x4.shuffle(r,n,0,1,4,5),u=SIMD.Float32x4.shuffle(e,o,0,1,4,5),l=SIMD.Float32x4.shuffle(i,u,0,2,4,6),u=SIMD.Float32x4.shuffle(u,i,1,3,5,7),i=SIMD.Float32x4.shuffle(r,n,2,3,6,7),c=SIMD.Float32x4.shuffle(e,o,2,3,6,7),M=SIMD.Float32x4.shuffle(i,c,0,2,4,6),c=SIMD.Float32x4.shuffle(c,i,1,3,5,7),i=SIMD.Float32x4.mul(M,c),i=SIMD.Float32x4.swizzle(i,1,0,3,2),s=SIMD.Float32x4.mul(u,i),x=SIMD.Float32x4.mul(l,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,i),s),x=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,i),x),x=SIMD.Float32x4.swizzle(x,2,3,0,1),i=SIMD.Float32x4.mul(u,M),i=SIMD.Float32x4.swizzle(i,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,i),s),v=SIMD.Float32x4.mul(l,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(c,i)),v=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,i),v),v=SIMD.Float32x4.swizzle(v,2,3,0,1),i=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,3,0,1),c),i=SIMD.Float32x4.swizzle(i,1,0,3,2),M=SIMD.Float32x4.swizzle(M,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(M,i),s),m=SIMD.Float32x4.mul(l,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(M,i)),m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,i),m),m=SIMD.Float32x4.swizzle(m,2,3,0,1),i=SIMD.Float32x4.mul(l,u),i=SIMD.Float32x4.swizzle(i,1,0,3,2),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,i),m),v=SIMD.Float32x4.sub(SIMD.Float32x4.mul(M,i),v),i=SIMD.Float32x4.swizzle(i,2,3,0,1),m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,i),m),v=SIMD.Float32x4.sub(v,SIMD.Float32x4.mul(M,i)),i=SIMD.Float32x4.mul(l,c),i=SIMD.Float32x4.swizzle(i,1,0,3,2),x=SIMD.Float32x4.sub(x,SIMD.Float32x4.mul(M,i)),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,i),m),i=SIMD.Float32x4.swizzle(i,2,3,0,1),x=SIMD.Float32x4.add(SIMD.Float32x4.mul(M,i),x),m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(u,i)),i=SIMD.Float32x4.mul(l,M),i=SIMD.Float32x4.swizzle(i,1,0,3,2),x=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,i),x),v=SIMD.Float32x4.sub(v,SIMD.Float32x4.mul(u,i)),i=SIMD.Float32x4.swizzle(i,2,3,0,1),x=SIMD.Float32x4.sub(x,SIMD.Float32x4.mul(c,i)),v=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,i),v),SIMD.Float32x4.store(t,0,s),SIMD.Float32x4.store(t,4,x),SIMD.Float32x4.store(t,8,m),SIMD.Float32x4.store(t,12,v),t},mat4.adjoint=glMatrix.USE_SIMD?mat4.SIMD.adjoint:mat4.scalar.adjoint,mat4.determinant=function(t){var a=t[0],r=t[1],n=t[2],e=t[3],o=t[4],l=t[5],u=t[6],M=t[7],c=t[8],i=t[9],s=t[10],x=t[11],m=t[12],v=t[13],D=t[14],S=t[15],I=a*l-r*o,f=a*u-n*o,F=a*M-e*o,h=r*u-n*l,d=r*M-e*l,z=n*M-e*u,w=c*v-i*m,g=c*D-s*m,p=c*S-x*m,q=i*D-s*v,A=i*S-x*v,R=s*S-x*D;return I*R-f*A+F*q+h*p-d*g+z*w},mat4.SIMD.multiply=function(t,a,r){var n=SIMD.Float32x4.load(a,0),e=SIMD.Float32x4.load(a,4),o=SIMD.Float32x4.load(a,8),l=SIMD.Float32x4.load(a,12),u=SIMD.Float32x4.load(r,0),M=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),l))));SIMD.Float32x4.store(t,0,M);var c=SIMD.Float32x4.load(r,4),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,3,3,3,3),l))));SIMD.Float32x4.store(t,4,i);var s=SIMD.Float32x4.load(r,8),x=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),l))));SIMD.Float32x4.store(t,8,x);var m=SIMD.Float32x4.load(r,12),v=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,3,3,3,3),l))));return SIMD.Float32x4.store(t,12,v),t},mat4.scalar.multiply=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3],u=a[4],M=a[5],c=a[6],i=a[7],s=a[8],x=a[9],m=a[10],v=a[11],D=a[12],S=a[13],I=a[14],f=a[15],F=r[0],h=r[1],d=r[2],z=r[3];return t[0]=F*n+h*u+d*s+z*D,t[1]=F*e+h*M+d*x+z*S,t[2]=F*o+h*c+d*m+z*I,t[3]=F*l+h*i+d*v+z*f,F=r[4],h=r[5],d=r[6],z=r[7],t[4]=F*n+h*u+d*s+z*D,t[5]=F*e+h*M+d*x+z*S,t[6]=F*o+h*c+d*m+z*I,t[7]=F*l+h*i+d*v+z*f,F=r[8],h=r[9],d=r[10],z=r[11],t[8]=F*n+h*u+d*s+z*D,t[9]=F*e+h*M+d*x+z*S,t[10]=F*o+h*c+d*m+z*I,t[11]=F*l+h*i+d*v+z*f,F=r[12],h=r[13],d=r[14],z=r[15],t[12]=F*n+h*u+d*s+z*D,t[13]=F*e+h*M+d*x+z*S,t[14]=F*o+h*c+d*m+z*I,t[15]=F*l+h*i+d*v+z*f,t},mat4.multiply=glMatrix.USE_SIMD?mat4.SIMD.multiply:mat4.scalar.multiply,mat4.mul=mat4.multiply,mat4.scalar.translate=function(t,a,r){var n,e,o,l,u,M,c,i,s,x,m,v,D=r[0],S=r[1],I=r[2];return a===t?(t[12]=a[0]*D+a[4]*S+a[8]*I+a[12],t[13]=a[1]*D+a[5]*S+a[9]*I+a[13],t[14]=a[2]*D+a[6]*S+a[10]*I+a[14],t[15]=a[3]*D+a[7]*S+a[11]*I+a[15]):(n=a[0],e=a[1],o=a[2],l=a[3],u=a[4],M=a[5],c=a[6],i=a[7],s=a[8],x=a[9],m=a[10],v=a[11],t[0]=n,t[1]=e,t[2]=o,t[3]=l,t[4]=u,t[5]=M,t[6]=c,t[7]=i,t[8]=s,t[9]=x,t[10]=m,t[11]=v,t[12]=n*D+u*S+s*I+a[12],t[13]=e*D+M*S+x*I+a[13],t[14]=o*D+c*S+m*I+a[14],t[15]=l*D+i*S+v*I+a[15]),t},mat4.SIMD.translate=function(t,a,r){var n=SIMD.Float32x4.load(a,0),e=SIMD.Float32x4.load(a,4),o=SIMD.Float32x4.load(a,8),l=SIMD.Float32x4.load(a,12),u=SIMD.Float32x4(r[0],r[1],r[2],0);a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11]),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(u,0,0,0,0)),e=SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(u,1,1,1,1)),o=SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(u,2,2,2,2));var M=SIMD.Float32x4.add(n,SIMD.Float32x4.add(e,SIMD.Float32x4.add(o,l)));return SIMD.Float32x4.store(t,12,M),t},mat4.translate=glMatrix.USE_SIMD?mat4.SIMD.translate:mat4.scalar.translate,mat4.scalar.scale=function(t,a,r){var n=r[0],e=r[1],o=r[2];return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=a[3]*n,t[4]=a[4]*e,t[5]=a[5]*e,t[6]=a[6]*e,t[7]=a[7]*e,t[8]=a[8]*o,t[9]=a[9]*o,t[10]=a[10]*o,t[11]=a[11]*o,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},mat4.SIMD.scale=function(t,a,r){var n,e,o,l=SIMD.Float32x4(r[0],r[1],r[2],0);return n=SIMD.Float32x4.load(a,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(l,0,0,0,0))),e=SIMD.Float32x4.load(a,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(l,1,1,1,1))),o=SIMD.Float32x4.load(a,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(l,2,2,2,2))),t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},mat4.scale=glMatrix.USE_SIMD?mat4.SIMD.scale:mat4.scalar.scale,mat4.rotate=function(t,a,r,n){var e,o,l,u,M,c,i,s,x,m,v,D,S,I,f,F,h,d,z,w,g,p,q,A,R=n[0],b=n[1],Y=n[2],E=Math.sqrt(R*R+b*b+Y*Y);return Math.abs(E)<glMatrix.EPSILON?null:(E=1/E,R*=E,b*=E,Y*=E,e=Math.sin(r),o=Math.cos(r),l=1-o,u=a[0],M=a[1],c=a[2],i=a[3],s=a[4],x=a[5],m=a[6],v=a[7],D=a[8],S=a[9],I=a[10],f=a[11],F=R*R*l+o,h=b*R*l+Y*e,d=Y*R*l-b*e,z=R*b*l-Y*e,w=b*b*l+o,g=Y*b*l+R*e,p=R*Y*l+b*e,q=b*Y*l-R*e,A=Y*Y*l+o,t[0]=u*F+s*h+D*d,t[1]=M*F+x*h+S*d,t[2]=c*F+m*h+I*d,t[3]=i*F+v*h+f*d,t[4]=u*z+s*w+D*g,t[5]=M*z+x*w+S*g,t[6]=c*z+m*w+I*g,t[7]=i*z+v*w+f*g,t[8]=u*p+s*q+D*A,t[9]=M*p+x*q+S*A,t[10]=c*p+m*q+I*A,t[11]=i*p+v*q+f*A,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)},mat4.rotateX=function(t,a,r){var n=Math.sin(r),e=Math.cos(r),o=a[4],l=a[5],u=a[6],M=a[7],c=a[8],i=a[9],s=a[10],x=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=o*e+c*n,t[5]=l*e+i*n,t[6]=u*e+s*n,t[7]=M*e+x*n,t[8]=c*e-o*n,t[9]=i*e-l*n,t[10]=s*e-u*n,t[11]=x*e-M*n,t},mat4.rotateY=function(t,a,r){var n=Math.sin(r),e=Math.cos(r),o=a[0],l=a[1],u=a[2],M=a[3],c=a[8],i=a[9],s=a[10],x=a[11];return a!==t&&(t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=o*e-c*n,t[1]=l*e-i*n,t[2]=u*e-s*n,t[3]=M*e-x*n,t[8]=o*n+c*e,t[9]=l*n+i*e,t[10]=u*n+s*e,t[11]=M*n+x*e,t},mat4.rotateZ=function(t,a,r){var n=Math.sin(r),e=Math.cos(r),o=a[0],l=a[1],u=a[2],M=a[3],c=a[4],i=a[5],s=a[6],x=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=o*e+c*n,t[1]=l*e+i*n,t[2]=u*e+s*n,t[3]=M*e+x*n,t[4]=c*e-o*n,t[5]=i*e-l*n,t[6]=s*e-u*n,t[7]=x*e-M*n,t},mat4.fromTranslation=function(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t},mat4.fromScaling=function(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=a[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.fromRotation=function(t,a,r){var n,e,o,l=r[0],u=r[1],M=r[2],c=Math.sqrt(l*l+u*u+M*M);return Math.abs(c)<glMatrix.EPSILON?null:(c=1/c,l*=c,u*=c,M*=c,n=Math.sin(a),e=Math.cos(a),o=1-e,t[0]=l*l*o+e,t[1]=u*l*o+M*n,t[2]=M*l*o-u*n,t[3]=0,t[4]=l*u*o-M*n,t[5]=u*u*o+e,t[6]=M*u*o+l*n,t[7]=0,t[8]=l*M*o+u*n,t[9]=u*M*o-l*n,t[10]=M*M*o+e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},mat4.fromXRotation=function(t,a){var r=Math.sin(a),n=Math.cos(a);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.fromYRotation=function(t,a){var r=Math.sin(a),n=Math.cos(a);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.fromZRotation=function(t,a){var r=Math.sin(a),n=Math.cos(a);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.fromRotationTranslation=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3],u=n+n,M=e+e,c=o+o,i=n*u,s=n*M,x=n*c,m=e*M,v=e*c,D=o*c,S=l*u,I=l*M,f=l*c;return t[0]=1-(m+D),t[1]=s+f,t[2]=x-I,t[3]=0,t[4]=s-f,t[5]=1-(i+D),t[6]=v+S,t[7]=0,t[8]=x+I,t[9]=v-S,t[10]=1-(i+m),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},mat4.fromRotationTranslationScale=function(t,a,r,n){var e=a[0],o=a[1],l=a[2],u=a[3],M=e+e,c=o+o,i=l+l,s=e*M,x=e*c,m=e*i,v=o*c,D=o*i,S=l*i,I=u*M,f=u*c,F=u*i,h=n[0],d=n[1],z=n[2];return t[0]=(1-(v+S))*h,t[1]=(x+F)*h,t[2]=(m-f)*h,t[3]=0,t[4]=(x-F)*d,t[5]=(1-(s+S))*d,t[6]=(D+I)*d,t[7]=0,t[8]=(m+f)*z,t[9]=(D-I)*z,t[10]=(1-(s+v))*z,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},mat4.fromRotationTranslationScaleOrigin=function(t,a,r,n,e){var o=a[0],l=a[1],u=a[2],M=a[3],c=o+o,i=l+l,s=u+u,x=o*c,m=o*i,v=o*s,D=l*i,S=l*s,I=u*s,f=M*c,F=M*i,h=M*s,d=n[0],z=n[1],w=n[2],g=e[0],p=e[1],q=e[2];return t[0]=(1-(D+I))*d,t[1]=(m+h)*d,t[2]=(v-F)*d,t[3]=0,t[4]=(m-h)*z,t[5]=(1-(x+I))*z,t[6]=(S+f)*z,
t[7]=0,t[8]=(v+F)*w,t[9]=(S-f)*w,t[10]=(1-(x+D))*w,t[11]=0,t[12]=r[0]+g-(t[0]*g+t[4]*p+t[8]*q),t[13]=r[1]+p-(t[1]*g+t[5]*p+t[9]*q),t[14]=r[2]+q-(t[2]*g+t[6]*p+t[10]*q),t[15]=1,t},mat4.fromQuat=function(t,a){var r=a[0],n=a[1],e=a[2],o=a[3],l=r+r,u=n+n,M=e+e,c=r*l,i=n*l,s=n*u,x=e*l,m=e*u,v=e*M,D=o*l,S=o*u,I=o*M;return t[0]=1-s-v,t[1]=i+I,t[2]=x-S,t[3]=0,t[4]=i-I,t[5]=1-c-v,t[6]=m+D,t[7]=0,t[8]=x+S,t[9]=m-D,t[10]=1-c-s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.frustum=function(t,a,r,n,e,o,l){var u=1/(r-a),M=1/(e-n),c=1/(o-l);return t[0]=2*o*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*M,t[6]=0,t[7]=0,t[8]=(r+a)*u,t[9]=(e+n)*M,t[10]=(l+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=l*o*2*c,t[15]=0,t},mat4.perspective=function(t,a,r,n,e){var o=1/Math.tan(a/2),l=1/(n-e);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(e+n)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*e*n*l,t[15]=0,t},mat4.perspectiveFromFieldOfView=function(t,a,r,n){var e=Math.tan(a.upDegrees*Math.PI/180),o=Math.tan(a.downDegrees*Math.PI/180),l=Math.tan(a.leftDegrees*Math.PI/180),u=Math.tan(a.rightDegrees*Math.PI/180),M=2/(l+u),c=2/(e+o);return t[0]=M,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-((l-u)*M*.5),t[9]=(e-o)*c*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t},mat4.ortho=function(t,a,r,n,e,o,l){var u=1/(a-r),M=1/(n-e),c=1/(o-l);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*M,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(a+r)*u,t[13]=(e+n)*M,t[14]=(l+o)*c,t[15]=1,t},mat4.lookAt=function(t,a,r,n){var e,o,l,u,M,c,i,s,x,m,v=a[0],D=a[1],S=a[2],I=n[0],f=n[1],F=n[2],h=r[0],d=r[1],z=r[2];return Math.abs(v-h)<glMatrix.EPSILON&&Math.abs(D-d)<glMatrix.EPSILON&&Math.abs(S-z)<glMatrix.EPSILON?mat4.identity(t):(i=v-h,s=D-d,x=S-z,m=1/Math.sqrt(i*i+s*s+x*x),i*=m,s*=m,x*=m,e=f*x-F*s,o=F*i-I*x,l=I*s-f*i,m=Math.sqrt(e*e+o*o+l*l),m?(m=1/m,e*=m,o*=m,l*=m):(e=0,o=0,l=0),u=s*l-x*o,M=x*e-i*l,c=i*o-s*e,m=Math.sqrt(u*u+M*M+c*c),m?(m=1/m,u*=m,M*=m,c*=m):(u=0,M=0,c=0),t[0]=e,t[1]=u,t[2]=i,t[3]=0,t[4]=o,t[5]=M,t[6]=s,t[7]=0,t[8]=l,t[9]=c,t[10]=x,t[11]=0,t[12]=-(e*v+o*D+l*S),t[13]=-(u*v+M*D+c*S),t[14]=-(i*v+s*D+x*S),t[15]=1,t)},mat4.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},mat4.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))};var mat3={};mat3.create=function(){var t=new glMatrix.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.fromMat4=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[4],t[4]=a[5],t[5]=a[6],t[6]=a[8],t[7]=a[9],t[8]=a[10],t},mat3.clone=function(t){var a=new glMatrix.ARRAY_TYPE(9);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a},mat3.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t},mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,a){if(t===a){var r=a[1],n=a[2],e=a[5];t[1]=a[3],t[2]=a[6],t[3]=r,t[5]=a[7],t[6]=n,t[7]=e}else t[0]=a[0],t[1]=a[3],t[2]=a[6],t[3]=a[1],t[4]=a[4],t[5]=a[7],t[6]=a[2],t[7]=a[5],t[8]=a[8];return t},mat3.invert=function(t,a){var r=a[0],n=a[1],e=a[2],o=a[3],l=a[4],u=a[5],M=a[6],c=a[7],i=a[8],s=i*l-u*c,x=-i*o+u*M,m=c*o-l*M,v=r*s+n*x+e*m;return v?(v=1/v,t[0]=s*v,t[1]=(-i*n+e*c)*v,t[2]=(u*n-e*l)*v,t[3]=x*v,t[4]=(i*r-e*M)*v,t[5]=(-u*r+e*o)*v,t[6]=m*v,t[7]=(-c*r+n*M)*v,t[8]=(l*r-n*o)*v,t):null},mat3.adjoint=function(t,a){var r=a[0],n=a[1],e=a[2],o=a[3],l=a[4],u=a[5],M=a[6],c=a[7],i=a[8];return t[0]=l*i-u*c,t[1]=e*c-n*i,t[2]=n*u-e*l,t[3]=u*M-o*i,t[4]=r*i-e*M,t[5]=e*o-r*u,t[6]=o*c-l*M,t[7]=n*M-r*c,t[8]=r*l-n*o,t},mat3.determinant=function(t){var a=t[0],r=t[1],n=t[2],e=t[3],o=t[4],l=t[5],u=t[6],M=t[7],c=t[8];return a*(c*o-l*M)+r*(-c*e+l*u)+n*(M*e-o*u)},mat3.multiply=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3],u=a[4],M=a[5],c=a[6],i=a[7],s=a[8],x=r[0],m=r[1],v=r[2],D=r[3],S=r[4],I=r[5],f=r[6],F=r[7],h=r[8];return t[0]=x*n+m*l+v*c,t[1]=x*e+m*u+v*i,t[2]=x*o+m*M+v*s,t[3]=D*n+S*l+I*c,t[4]=D*e+S*u+I*i,t[5]=D*o+S*M+I*s,t[6]=f*n+F*l+h*c,t[7]=f*e+F*u+h*i,t[8]=f*o+F*M+h*s,t},mat3.mul=mat3.multiply,mat3.translate=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3],u=a[4],M=a[5],c=a[6],i=a[7],s=a[8],x=r[0],m=r[1];return t[0]=n,t[1]=e,t[2]=o,t[3]=l,t[4]=u,t[5]=M,t[6]=x*n+m*l+c,t[7]=x*e+m*u+i,t[8]=x*o+m*M+s,t},mat3.rotate=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3],u=a[4],M=a[5],c=a[6],i=a[7],s=a[8],x=Math.sin(r),m=Math.cos(r);return t[0]=m*n+x*l,t[1]=m*e+x*u,t[2]=m*o+x*M,t[3]=m*l-x*n,t[4]=m*u-x*e,t[5]=m*M-x*o,t[6]=c,t[7]=i,t[8]=s,t},mat3.scale=function(t,a,r){var n=r[0],e=r[1];return t[0]=n*a[0],t[1]=n*a[1],t[2]=n*a[2],t[3]=e*a[3],t[4]=e*a[4],t[5]=e*a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t},mat3.fromTranslation=function(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=a[0],t[7]=a[1],t[8]=1,t},mat3.fromRotation=function(t,a){var r=Math.sin(a),n=Math.cos(a);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.fromScaling=function(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=0,t[4]=a[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.fromMat2d=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=0,t[3]=a[2],t[4]=a[3],t[5]=0,t[6]=a[4],t[7]=a[5],t[8]=1,t},mat3.fromRows=function(t,a,r,n){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=r[0],t[4]=r[1],t[5]=r[2],t[6]=n[0],t[7]=n[1],t[8]=n[2],t},mat3.fromQuat=function(t,a){var r=a[0],n=a[1],e=a[2],o=a[3],l=r+r,u=n+n,M=e+e,c=r*l,i=n*l,s=n*u,x=e*l,m=e*u,v=e*M,D=o*l,S=o*u,I=o*M;return t[0]=1-s-v,t[3]=i-I,t[6]=x+S,t[1]=i+I,t[4]=1-c-v,t[7]=m-D,t[2]=x-S,t[5]=m+D,t[8]=1-c-s,t},mat3.normalFromMat4=function(t,a){var r=a[0],n=a[1],e=a[2],o=a[3],l=a[4],u=a[5],M=a[6],c=a[7],i=a[8],s=a[9],x=a[10],m=a[11],v=a[12],D=a[13],S=a[14],I=a[15],f=r*u-n*l,F=r*M-e*l,h=r*c-o*l,d=n*M-e*u,z=n*c-o*u,w=e*c-o*M,g=i*D-s*v,p=i*S-x*v,q=i*I-m*v,A=s*S-x*D,R=s*I-m*D,b=x*I-m*S,Y=f*b-F*R+h*A+d*q-z*p+w*g;return Y?(Y=1/Y,t[0]=(u*b-M*R+c*A)*Y,t[1]=(M*q-l*b-c*p)*Y,t[2]=(l*R-u*q+c*g)*Y,t[3]=(e*R-n*b-o*A)*Y,t[4]=(r*b-e*q+o*p)*Y,t[5]=(n*q-r*R-o*g)*Y,t[6]=(D*w-S*z+I*d)*Y,t[7]=(S*h-v*w-I*F)*Y,t[8]=(v*z-D*h+I*f)*Y,t):null},mat3.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},mat3.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))};var quat={};quat.create=function(){var t=new glMatrix.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},quat.rotationTo=function(){var t=vec3.create(),a=vec3.fromValues(1,0,0),r=vec3.fromValues(0,1,0);return function(n,e,o){var l=vec3.dot(e,o);return-.999999>l?(vec3.cross(t,a,e),vec3.length(t)<1e-6&&vec3.cross(t,r,e),vec3.normalize(t,t),quat.setAxisAngle(n,t,Math.PI),n):l>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(vec3.cross(t,e,o),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+l,quat.normalize(n,n))}}(),quat.setAxes=function(){var t=mat3.create();return function(a,r,n,e){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=e[0],t[4]=e[1],t[7]=e[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],quat.normalize(a,quat.fromMat3(a,t))}}(),quat.clone=vec4.clone,quat.fromValues=vec4.fromValues,quat.copy=vec4.copy,quat.set=vec4.set,quat.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},quat.setAxisAngle=function(t,a,r){r=.5*r;var n=Math.sin(r);return t[0]=n*a[0],t[1]=n*a[1],t[2]=n*a[2],t[3]=Math.cos(r),t},quat.add=vec4.add,quat.multiply=function(t,a,r){var n=a[0],e=a[1],o=a[2],l=a[3],u=r[0],M=r[1],c=r[2],i=r[3];return t[0]=n*i+l*u+e*c-o*M,t[1]=e*i+l*M+o*u-n*c,t[2]=o*i+l*c+n*M-e*u,t[3]=l*i-n*u-e*M-o*c,t},quat.mul=quat.multiply,quat.scale=vec4.scale,quat.rotateX=function(t,a,r){r*=.5;var n=a[0],e=a[1],o=a[2],l=a[3],u=Math.sin(r),M=Math.cos(r);return t[0]=n*M+l*u,t[1]=e*M+o*u,t[2]=o*M-e*u,t[3]=l*M-n*u,t},quat.rotateY=function(t,a,r){r*=.5;var n=a[0],e=a[1],o=a[2],l=a[3],u=Math.sin(r),M=Math.cos(r);return t[0]=n*M-o*u,t[1]=e*M+l*u,t[2]=o*M+n*u,t[3]=l*M-e*u,t},quat.rotateZ=function(t,a,r){r*=.5;var n=a[0],e=a[1],o=a[2],l=a[3],u=Math.sin(r),M=Math.cos(r);return t[0]=n*M+e*u,t[1]=e*M-n*u,t[2]=o*M+l*u,t[3]=l*M-o*u,t},quat.calculateW=function(t,a){var r=a[0],n=a[1],e=a[2];return t[0]=r,t[1]=n,t[2]=e,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-e*e)),t},quat.dot=vec4.dot,quat.lerp=vec4.lerp,quat.slerp=function(t,a,r,n){var e,o,l,u,M,c=a[0],i=a[1],s=a[2],x=a[3],m=r[0],v=r[1],D=r[2],S=r[3];return o=c*m+i*v+s*D+x*S,0>o&&(o=-o,m=-m,v=-v,D=-D,S=-S),1-o>1e-6?(e=Math.acos(o),l=Math.sin(e),u=Math.sin((1-n)*e)/l,M=Math.sin(n*e)/l):(u=1-n,M=n),t[0]=u*c+M*m,t[1]=u*i+M*v,t[2]=u*s+M*D,t[3]=u*x+M*S,t},quat.sqlerp=function(){var t=quat.create(),a=quat.create();return function(r,n,e,o,l,u){return quat.slerp(t,n,l,u),quat.slerp(a,e,o,u),quat.slerp(r,t,a,2*u*(1-u)),r}}(),quat.invert=function(t,a){var r=a[0],n=a[1],e=a[2],o=a[3],l=r*r+n*n+e*e+o*o,u=l?1/l:0;return t[0]=-r*u,t[1]=-n*u,t[2]=-e*u,t[3]=o*u,t},quat.conjugate=function(t,a){return t[0]=-a[0],t[1]=-a[1],t[2]=-a[2],t[3]=a[3],t},quat.length=vec4.length,quat.len=quat.length,quat.squaredLength=vec4.squaredLength,quat.sqrLen=quat.squaredLength,quat.normalize=vec4.normalize,quat.fromMat3=function(t,a){var r,n=a[0]+a[4]+a[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(a[5]-a[7])*r,t[1]=(a[6]-a[2])*r,t[2]=(a[1]-a[3])*r;else{var e=0;a[4]>a[0]&&(e=1),a[8]>a[3*e+e]&&(e=2);var o=(e+1)%3,l=(e+2)%3;r=Math.sqrt(a[3*e+e]-a[3*o+o]-a[3*l+l]+1),t[e]=.5*r,r=.5/r,t[3]=(a[3*o+l]-a[3*l+o])*r,t[o]=(a[3*o+e]+a[3*e+o])*r,t[l]=(a[3*l+e]+a[3*e+l])*r}return t},quat.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"};
!function(t){var e=this;"object"==typeof exports?module.exports=t(e):"function"==typeof define&&define.amd?define([],function(){return t(e)}):e.jDataView=t(e)}(function(t){"use strict";function e(t,e){return!e&&t instanceof Array?t:Array.prototype.slice.call(t)}function i(t,e){return void 0!==t?t:e}function n(t,e,r,s){if(t instanceof n){var f=t.slice(e,e+r);return f._littleEndian=i(s,f._littleEndian),f}if(!(this instanceof n))return new n(t,e,r,s);if(this.buffer=t=n.wrapBuffer(t),this._isArrayBuffer=o.ArrayBuffer&&t instanceof ArrayBuffer,this._isPixelData=o.PixelData&&t instanceof CanvasPixelArray,this._isDataView=o.DataView&&this._isArrayBuffer,this._isNodeBuffer=!1,!(this._isArrayBuffer||this._isPixelData||t instanceof Array))throw new TypeError("jDataView buffer has an incompatible type");this._littleEndian=!!s;var a="byteLength"in t?t.byteLength:t.length;this.byteOffset=e=i(e,0),this.byteLength=r=i(r,a-e),this._offset=this._bitOffset=0,this._isDataView?this._view=new DataView(t,e,r):this._checkBounds(e,r,a),this._engineAction=this._isDataView?this._dataViewAction:this._isArrayBuffer?this._arrayBufferAction:this._arrayAction}function r(t){for(var e=o.ArrayBuffer?Uint8Array:Array,i=new e(t.length),n=0,r=t.length;r>n;n++)i[n]=255&t.charCodeAt(n);return i}function s(t){return t>=0&&31>t?1<<t:s[t]||(s[t]=Math.pow(2,t))}function f(t,e){this.lo=t,this.hi=e}function a(){f.apply(this,arguments)}var o={NodeBuffer:!1,DataView:"DataView"in t,ArrayBuffer:"ArrayBuffer"in t,PixelData:"CanvasPixelArray"in t&&"ImageData"in t&&"document"in t},u=t.TextEncoder,h=t.TextDecoder;if(o.PixelData){var c=function(t,e){var i=c.context2d.createImageData((t+3)/4,1).data;if(i.byteLength=t,void 0!==e)for(var n=0;t>n;n++)i[n]=e[n];return i};c.context2d=document.createElement("canvas").getContext("2d")}var _={Int8:1,Int16:2,Int32:4,Uint8:1,Uint16:2,Uint32:4,Float32:4,Float64:8};n.wrapBuffer=function(t){switch(typeof t){case"number":if(o.ArrayBuffer)t=new Uint8Array(t).buffer;else if(o.PixelData)t=c(t);else{t=new Array(t);for(var i=0;i<t.length;i++)t[i]=0}return t;case"string":t=r(t);default:return"length"in t&&!(o.ArrayBuffer&&t instanceof ArrayBuffer||o.PixelData&&t instanceof CanvasPixelArray)&&(o.ArrayBuffer?t instanceof ArrayBuffer||(t=new Uint8Array(t).buffer,t instanceof ArrayBuffer||(t=new Uint8Array(e(t,!0)).buffer)):t=o.PixelData?c(t.length,t):e(t)),t}},n.createBuffer=function(){return n.wrapBuffer(arguments)},n.Uint64=f,f.prototype={valueOf:function(){return this.lo+s(32)*this.hi},toString:function(){return Number.prototype.toString.apply(this.valueOf(),arguments)}},f.fromNumber=function(t){var e=Math.floor(t/s(32)),i=t-e*s(32);return new f(i,e)},n.Int64=a,a.prototype="create"in Object?Object.create(f.prototype):new f,a.prototype.valueOf=function(){return this.hi<s(31)?f.prototype.valueOf.apply(this,arguments):-(s(32)-this.lo+s(32)*(s(32)-1-this.hi))},a.fromNumber=function(t){var e,i;if(t>=0){var n=f.fromNumber(t);e=n.lo,i=n.hi}else i=Math.floor(t/s(32)),e=t-i*s(32),i+=s(32);return new a(e,i)};var y=n.prototype={compatibility:o,_checkBounds:function(t,e,n){if("number"!=typeof t)throw new TypeError("Offset is not a number.");if("number"!=typeof e)throw new TypeError("Size is not a number.");if(0>e)throw new RangeError("Length is negative.");if(0>t||t+e>i(n,this.byteLength))throw new RangeError("Offsets are out of bounds.")},_action:function(t,e,n,r,s){return this._engineAction(t,e,i(n,this._offset),i(r,this._littleEndian),s)},_dataViewAction:function(t,e,i,n,r){return this._offset=i+_[t],e?this._view["get"+t](i,n):this._view["set"+t](i,r,n)},_arrayBufferAction:function(e,n,r,s,f){var a,o=_[e],u=t[e+"Array"];if(s=i(s,this._littleEndian),1===o||(this.byteOffset+r)%o===0&&s)return a=new u(this.buffer,this.byteOffset+r,1),this._offset=r+o,n?a[0]:a[0]=f;var h=new Uint8Array(n?this.getBytes(o,r,s,!0):o);return a=new u(h.buffer,0,1),n?a[0]:(a[0]=f,void this._setBytes(r,h,s))},_arrayAction:function(t,e,i,n,r){return e?this["_get"+t](i,n):this["_set"+t](i,r,n)},_getBytes:function(t,n,r){r=i(r,this._littleEndian),n=i(n,this._offset),t=i(t,this.byteLength-n),this._checkBounds(n,t),n+=this.byteOffset,this._offset=n-this.byteOffset+t;var s=this._isArrayBuffer?new Uint8Array(this.buffer,n,t):(this.buffer.slice||Array.prototype.slice).call(this.buffer,n,n+t);return r||1>=t?s:e(s).reverse()},getBytes:function(t,n,r,s){var f=this._getBytes(t,n,i(r,!0));return s?e(f):f},_setBytes:function(t,n,r){var s=n.length;if(0!==s){if(r=i(r,this._littleEndian),t=i(t,this._offset),this._checkBounds(t,s),!r&&s>1&&(n=e(n,!0).reverse()),t+=this.byteOffset,this._isArrayBuffer)new Uint8Array(this.buffer,t,s).set(n);else for(var f=0;s>f;f++)this.buffer[t+f]=n[f];this._offset=t-this.byteOffset+s}},setBytes:function(t,e,n){this._setBytes(t,e,i(n,!0))},getString:function(t,e,i){var n=this._getBytes(t,e,!0);if(i="utf8"===i?"utf-8":i||"binary",h&&"binary"!==i)return new h(i).decode(this._isArrayBuffer?n:new Uint8Array(n));var r="";t=n.length;for(var s=0;t>s;s++)r+=String.fromCharCode(n[s]);return"utf-8"===i&&(r=decodeURIComponent(escape(r))),r},setString:function(t,e,i){i="utf8"===i?"utf-8":i||"binary";var n;u&&"binary"!==i?n=new u(i).encode(e):("utf-8"===i&&(e=unescape(encodeURIComponent(e))),n=r(e)),this._setBytes(t,n,!0)},getChar:function(t){return this.getString(1,t)},setChar:function(t,e){this.setString(t,e)},tell:function(){return this._offset},seek:function(t){return this._checkBounds(t,0),this._offset=t},skip:function(t){return this.seek(this._offset+t)},slice:function(t,e,r){function s(t,e){return 0>t?t+e:t}return t=s(t,this.byteLength),e=s(i(e,this.byteLength),this.byteLength),r?new n(this.getBytes(e-t,t,!0,!0),void 0,void 0,this._littleEndian):new n(this.buffer,this.byteOffset+t,e-t,this._littleEndian)},alignBy:function(t){return this._bitOffset=0,1!==i(t,1)?this.skip(t-(this._offset%t||t)):this._offset},_getFloat64:function(t,e){var i=this._getBytes(8,t,e),n=1-2*(i[7]>>7),r=((i[7]<<1&255)<<3|i[6]>>4)-1023,f=(15&i[6])*s(48)+i[5]*s(40)+i[4]*s(32)+i[3]*s(24)+i[2]*s(16)+i[1]*s(8)+i[0];return 1024===r?0!==f?NaN:1/0*n:-1023===r?n*f*s(-1074):n*(1+f*s(-52))*s(r)},_getFloat32:function(t,e){var i=this._getBytes(4,t,e),n=1-2*(i[3]>>7),r=(i[3]<<1&255|i[2]>>7)-127,f=(127&i[2])<<16|i[1]<<8|i[0];return 128===r?0!==f?NaN:1/0*n:-127===r?n*f*s(-149):n*(1+f*s(-23))*s(r)},_get64:function(t,e,n){n=i(n,this._littleEndian),e=i(e,this._offset);for(var r=n?[0,4]:[4,0],s=0;2>s;s++)r[s]=this.getUint32(e+r[s],n);return this._offset=e+8,new t(r[0],r[1])},getInt64:function(t,e){return this._get64(a,t,e)},getUint64:function(t,e){return this._get64(f,t,e)},_getInt32:function(t,e){var i=this._getBytes(4,t,e);return i[3]<<24|i[2]<<16|i[1]<<8|i[0]},_getUint32:function(t,e){return this._getInt32(t,e)>>>0},_getInt16:function(t,e){return this._getUint16(t,e)<<16>>16},_getUint16:function(t,e){var i=this._getBytes(2,t,e);return i[1]<<8|i[0]},_getInt8:function(t){return this._getUint8(t)<<24>>24},_getUint8:function(t){return this._getBytes(1,t)[0]},_getBitRangeData:function(t,e){var n=(i(e,this._offset)<<3)+this._bitOffset,r=n+t,s=n>>>3,f=r+7>>>3,a=this._getBytes(f-s,s,!0),o=0;(this._bitOffset=7&r)&&(this._bitOffset-=8);for(var u=0,h=a.length;h>u;u++)o=o<<8|a[u];return{start:s,bytes:a,wideValue:o}},getSigned:function(t,e){var i=32-t;return this.getUnsigned(t,e)<<i>>i},getUnsigned:function(t,e){var i=this._getBitRangeData(t,e).wideValue>>>-this._bitOffset;return 32>t?i&~(-1<<t):i},_setBinaryFloat:function(t,e,i,n,r){var f,a,o=0>e?1:0,u=~(-1<<n-1),h=1-u;0>e&&(e=-e),0===e?(f=0,a=0):isNaN(e)?(f=2*u+1,a=1):1/0===e?(f=2*u+1,a=0):(f=Math.floor(Math.log(e)/Math.LN2),f>=h&&u>=f?(a=Math.floor((e*s(-f)-1)*s(i)),f+=u):(a=Math.floor(e/s(h-i)),f=0));for(var c=[];i>=8;)c.push(a%256),a=Math.floor(a/256),i-=8;for(f=f<<i|a,n+=i;n>=8;)c.push(255&f),f>>>=8,n-=8;c.push(o<<n|f),this._setBytes(t,c,r)},_setFloat32:function(t,e,i){this._setBinaryFloat(t,e,23,8,i)},_setFloat64:function(t,e,i){this._setBinaryFloat(t,e,52,11,i)},_set64:function(t,e,n,r){n instanceof t||(n=t.fromNumber(n)),r=i(r,this._littleEndian),e=i(e,this._offset);var s=r?{lo:0,hi:4}:{lo:4,hi:0};for(var f in s)this.setUint32(e+s[f],n[f],r);this._offset=e+8},setInt64:function(t,e,i){this._set64(a,t,e,i)},setUint64:function(t,e,i){this._set64(f,t,e,i)},_setUint32:function(t,e,i){this._setBytes(t,[255&e,e>>>8&255,e>>>16&255,e>>>24],i)},_setUint16:function(t,e,i){this._setBytes(t,[255&e,e>>>8&255],i)},_setUint8:function(t,e){this._setBytes(t,[255&e])},setUnsigned:function(t,e,i){var n=this._getBitRangeData(i,t),r=n.wideValue,s=n.bytes;r&=~(~(-1<<i)<<-this._bitOffset),r|=(32>i?e&~(-1<<i):e)<<-this._bitOffset;for(var f=s.length-1;f>=0;f--)s[f]=255&r,r>>>=8;this._setBytes(n.start,s,!0)}};for(var l in _)!function(t){y["get"+t]=function(e,i){return this._action(t,!0,e,i)},y["set"+t]=function(e,i,n){this._action(t,!1,e,n,i)}}(l);y._setInt32=y._setUint32,y._setInt16=y._setUint16,y._setInt8=y._setUint8,y.setSigned=y.setUnsigned;for(var g in y)"set"===g.slice(0,3)&&!function(t){y["write"+t]=function(){Array.prototype.unshift.call(arguments,void 0),this["set"+t].apply(this,arguments)}}(g.slice(3));return n});
var morphoviewer=function(t){function e(t,e){var a,o,i,n;if(a=document.getElementById(e),!a)return alert("getShaderFromDOM: no such shader: "+e),null;for(o="",i=a.firstChild;i;)i.nodeType==i.TEXT_NODE&&(o+=i.textContent),i=i.nextSibling;if("x-shader/x-fragment"==a.type)n=r(t,o,"fragment");else{if("x-shader/x-vertex"!=a.type)return alert("getShaderFromDOM: unknown shader type, returning null."),null;n=r(t,o,"vertex")}return n}function r(t,e,r){var a;if("fragment"==r)a=t.createShader(t.FRAGMENT_SHADER);else{if("vertex"!=r)return alert("getShaderFromString: unknown shader type, returning null."),null;a=t.createShader(t.VERTEX_SHADER)}return t.shaderSource(a,e),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?a:(alert("getShaderFromString: could not compile "+r+" shader: "+t.getShaderInfoLog(a)),null)}function a(t,e,r){var a=t.createProgram();return t.attachShader(a,e),t.attachShader(a,r),t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||console.log("getProgram: unable to link the shader program "+t.getProgramInfoLog(a)),a}function o(t,e,r){return e>t?t=e:t>r&&(t=r),t}function i(t,e,r){return r>1&&(r=1),t+r*(e-t)}function n(t,e){var r=mat3.create();return r[0]=Math.cos(e)+t[0]*t[0]*(1-Math.cos(e)),r[1]=t[0]*t[1]*(1-Math.cos(e))-t[2]*Math.sin(e),r[2]=t[0]*t[2]*(1-Math.cos(e))+t[1]*Math.sin(e),r[3]=t[1]*t[0]*(1-Math.cos(e))+t[2]*Math.sin(e),r[4]=Math.cos(e)+t[1]*t[1]*(1-Math.cos(e)),r[5]=t[1]*t[2]*(1-Math.cos(e))-t[0]*Math.sin(e),r[6]=t[2]*t[0]*(1-Math.cos(e))-t[1]*Math.sin(e),r[7]=t[2]*t[1]*(1-Math.cos(e))+t[0]*Math.sin(e),r[8]=Math.cos(e)+t[2]*t[2]*(1-Math.cos(e)),r}return t.Program=function(t){this.gl=t,this.object=null},t.Program.prototype.programFromDOM=function(t,r){var o=e(this.gl,r),i=e(this.gl,t);this.object=a(this.gl,i,o)},t.Program.prototype.programFromString=function(t,e){var o=r(this.gl,t,"vertex"),i=r(this.gl,e,"fragment");this.object=a(this.gl,o,i)},t.Program.prototype.use=function(){this.gl.useProgram(this.object)},t.Program.prototype.isInUse=function(){var t=0;return this.object==t?!0:!1},t.Program.prototype.stopUsing=function(){this.isInUse()&&this.gl.useProgram(null)},t.Program.prototype.attribute=function(t){var e=this.gl.getAttribLocation(this.object,t);return-1==e?(console.log("Program.attribute: shader attribute "+t+" not found."),null):e},t.Program.prototype.uniform=function(t){var e=this.gl.getUniformLocation(this.object,t);return-1==e?(console.log("Program.uniform: shader uniform "+t+" not found."),null):e},t.Program.prototype.setUniform=function(t,e,r){switch(r.type){case"float":this.gl.uniform1f(this.uniform(t),e);break;case"vec3":this.gl.uniform3fv(this.uniform(t),e);break;case"vec4":this.gl.uniform4fv(this.uniform(t),e);break;case"mat3":this.gl.uniformMatrix3fv(this.uniform(t),e);break;case"mat4":this.gl.uniformMatrix4fv(this.uniform(t),!1,e);break;case"int":this.gl.uniform1i(this.uniform(t),e);break;default:console.log("Program.setUniform: unknown type "+r.type)}},t.BufferObject=function(t,e){this.gl=t,this.target=e,this.object=this.gl.createBuffer()},t.BufferObject.prototype.dataStore=function(t,e){this.bind(),this.gl.bufferData(this.target,t,e),this.unbind()},t.BufferObject.prototype.bind=function(){this.gl.bindBuffer(this.target,this.object)},t.BufferObject.prototype.unbind=function(){this.gl.bindBuffer(this.target,null)},t.Mesh=function(t){this.gl=t,this.vbo=null,this.numVertices=0,this.contains={vertex:!1,barycentric:!1,normal:!1,curvature:!1,orientation:!1}},t.Mesh.prototype.object=function(){return this.vbo},t.Mesh.prototype.build=function(t){var e=(t.vertex.length,[]);if(void 0!==t.vertex){e=t.vertex.slice(),this.numVertices=e.length/3,this.contains.vertex=!0;for(var r=new Array(e.length),a=0;a<3*this.numVertices;a+=9)r[a]=1,r[a+1]=0,r[a+2]=0,r[a+3]=0,r[a+4]=1,r[a+5]=0,r[a+6]=0,r[a+7]=0,r[a+8]=1;e=e.concat(r),this.contains.barycentric=!0}else alert("morphoviewer.Mesh.build error: no vertices supplied!");void 0!==t.normal&&(e=e.concat(t.normal),this.contains.normal=!0),void 0!==t.curvature&&(e=e.concat(t.curvature),this.contains.curvature=!0),void 0!==t.orientation&&(e=e.concat(t.orientation),this.contains.orientation=!0),this.vbo=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Mesh.prototype.has=function(t){return this.contains[t]},t.Mesh.prototype.vertices=function(){return this.numVertices},t.Mesh.prototype.bind=function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo)},t.Mesh.prototype.unbind=function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Camera=function(t,e,r,a){this.position=vec3.fromValues(0,0,2),this.targetPosition=vec3.fromValues(0,0,2),this.targetRadius=2,this.radius=10,this.polar=Math.PI/2,this.azimuth=0,this.viewTransform=mat4.create(),this.sensitivity=.1*this.radius,this.verticalFOV=t,this.aspectRatio=e,this.nearPlane=r,this.farPlane=a,this.viewPerspective=!1,this.zoomFactor=1,this.targetZoomFactor=1},t.Camera.prototype.setFOV=function(t){this.verticalFOV=t,this.verticalFOV<=0&&(this.verticalFOV=Math.abs(this.verticalFOV))},t.Camera.prototype.matrix=function(){return mat4.multiply(mat4.create(),this.perspective(),this.view())},t.Camera.prototype.viewAsOrtho=function(){this.viewPerspective=!1},t.Camera.prototype.viewAsPerspective=function(){this.viewPerspective=!0},t.Camera.prototype.perspective=function(){var t;return t=this.viewPerspective?mat4.perspective(mat4.create(),this.verticalFOV,this.aspectRatio,this.nearPlane,this.farPlane):mat4.ortho(mat4.create(),-i(this.nearPlane,this.farPlane,.01*this.aspectRatio*this.zoomFactor),i(this.nearPlane,this.farPlane,.01*this.aspectRatio*this.zoomFactor),-i(this.nearPlane,this.farPlane,.01*this.zoomFactor),i(this.nearPlane,this.farPlane,.01*this.zoomFactor),this.nearPlane,this.farPlane)},t.Camera.prototype.view=function(){return this.viewTransform},t.Camera.prototype.distanceFromOrigin=function(){return this.radius},t.Camera.prototype.setFOV=function(t){if(0>t)throw"Camera.setFOV: negative vertical field of view";this.verticalFOV=t},t.Camera.prototype.setAspectRatio=function(t){if(0>t)throw"Camera.setAspectRatio: negative aspect ratio";this.aspectRatio=t},t.Camera.prototype.setNearPlane=function(t){if(t>this.farPlane)throw"Camera.setNearPlane: near plane is farther than the far plane";this.nearPlane=t},t.Camera.prototype.setFarPlane=function(t){if(t<this.nearPlane)throw"Camera.setFarPlane: far plane is nearer than the near plane";this.farPlane=t},t.Camera.prototype.dolly=function(t){this.targetRadius+=this.sensitivity*t,this.targetRadius<0&&(this.targetRadius=.001)},t.Camera.prototype.orbit=function(t,e){this.polar-=e,this.polar=o(this.polar,.01,Math.PI),this.azimuth-=t},t.Camera.prototype.update=function(t){this.targetZoomFactor=.07*this.targetRadius,this.zoomFactor=i(this.zoomFactor,this.targetZoomFactor,20*t),this.radius=i(this.radius,this.targetRadius,20*t),this.sensitivity=.1*this.radius;var e=vec3.fromValues(Math.sin(this.polar)*Math.sin(this.azimuth),Math.cos(this.polar),Math.sin(this.polar)*Math.cos(this.azimuth));this.targetPosition=vec3.scale(vec3.create(),e,this.radius),vec3.lerp(this.position,this.position,this.targetPosition,20*t),mat4.lookAt(this.viewTransform,this.position,vec3.create(0,0,0),this.up())},t.Camera.prototype.setBestPositionForModel=function(t){var e=Math.max(Math.abs(t.max.y),Math.abs(t.min.y)),r=Math.max(Math.abs(t.max.x),Math.abs(t.min.x)),a=Math.max(e,r);this.targetRadius=1.1*a/Math.tan(.5*this.verticalFOV)},t.Camera.prototype.rotation=function(){return mat3.multiply(mat3.create(),n([0,0,1],this.azimuth),n([1,0,0],.5*Math.PI-this.polar))},t.Camera.prototype.forward=function(){var t=vec3.normalize(vec3.create(),this.position);return vec3.fromValues(-t[0],-t[1],-t[2])},t.Camera.prototype.right=function(){var t=this.radius*Math.sin(this.polar)*Math.cos(this.azimuth),e=-this.radius*Math.sin(this.polar)*Math.sin(this.azimuth);return vec3.normalize(vec3.create(),vec3.fromValues(t,0,e))},t.Camera.prototype.up=function(){return vec3.cross(vec3.create(),this.right(),this.forward())},t.Camera.prototype.positionLeft=function(){this.polar=Math.PI/2,this.azimuth=Math.PI/2},t.Camera.prototype.positionRight=function(){this.polar=Math.PI/2,this.azimuth=3*Math.PI/2},t.Camera.prototype.positionTop=function(){this.polar=.001,this.azimuth=0},t.Camera.prototype.positionBottom=function(){this.polar=Math.PI,this.azimuth=0},t.Camera.prototype.positionFront=function(){this.polar=Math.PI/2,this.azimuth=0},t.Camera.prototype.positionBack=function(){this.polar=Math.PI/2,this.azimuth=Math.PI},t.color={camera:mat4.create(),model:mat4.create(),colorMode:1,enableAttributes:function(t,e){t.enableVertexAttribArray(e.attribute("vert")),t.enableVertexAttribArray(e.attribute("curvature")),t.enableVertexAttribArray(e.attribute("orientation"))},setAttributes:function(t,e,r,a){t.vertexAttribPointer(e.attribute("vert"),3,t.FLOAT,!1,0,0),a.has("curvature")&&a.has("orientation")&&(t.vertexAttribPointer(e.attribute("curvature"),1,t.FLOAT,t.FALSE,0,36*r),t.vertexAttribPointer(e.attribute("orientation"),1,t.FLOAT,t.FALSE,0,40*r))},setUniforms:function(t){t.setUniform("camera",this.camera,{type:"mat4"}),t.setUniform("model",this.model,{type:"mat4"}),t.setUniform("colorMode",this.colorMode,{type:"int"})},vertex:"precision mediump float;\nattribute vec3 vert;\nattribute float curvature;\nattribute float orientation;\nuniform mat4 model;\nuniform mat4 camera;\nuniform int colorMode;\nvarying vec4 fragColor;\nvec4 yellowToRed( float scalar );\nvec4 longRainbow( float scalar );\nvec4 shortRainbow( float scalar );\nvoid main() {\n	if ( colorMode == 1 ) {	//dirichlet normal energy\n       float scalar = ( exp(1.3*curvature) - 1.0 ) / ( exp(1.3) - 1.0 );\n       \n       \n		fragColor = yellowToRed( scalar );\n	} else if ( colorMode == 2 ) {	//orientation map\n		fragColor = longRainbow( orientation );\n	}\n	gl_Position = camera * model * vec4( vert, 1.0 );\n}\nvec4 yellowToRed( float scalar ) {\nvec4 color = vec4( 0.0, 0.0, 0.0, 1.0 );\ncolor.r = 1.0;\ncolor.g = 1.0 - scalar;\nreturn color;\n}\nvec4 longRainbow( float scalarInitial ) {\nvec3 color = vec3( 0.0, 0.0, 0.0 );\n float scalar = scalarInitial*0.8889 ;\nif ( scalar >= 0.0 && scalar < 0.1666 ) {\n	color.g = scalar * 6.0;\n	color.b = 1.0;\n} else if ( scalar >= 0.1666 && scalar < 0.3333 ) {\n	color.g = 1.0;\n	color.b = 1.0 - 6.0 * (scalar - 0.1666);\n} else if ( scalar >= 0.3333 && scalar < 0.5000 ) {\n	color.r = 6.0 * (scalar - 0.3333);\n	color.g = 1.0;\n} else if ( scalar >= 0.5000 && scalar < 0.6666 ) {\n	color.r = 1.0;\n	color.g = 1.0 - 6.0 * (scalar - 0.5000);\n} else if ( scalar >= 0.6666 && scalar < 0.8333 ) {\n   color.b = 6.0*(scalar - 0.6666);\n   color.r = 1.0;\n} else if ( scalar >= 0.8333 && scalar <= 1.0 ) {\n   color.b = 1.0;\n   color.r = 1.0 - 6.0 * (scalar - 0.8333);\n}\nreturn vec4( color, 1.0 );\n}\nvec4 shortRainbow( float scalar ) {	//scalar must be normalized!\nvec3 color = vec3( 0.0, 0.0, 0.0 );\nif ( scalar >= 0.0 && scalar < 0.25 ) {\n	color.g = scalar * 4.0;	//green varies linearly between [0,1]\n	color.b = 1.0;			//blue is maxed out\n} else if ( scalar >= 0.25 && scalar < 0.35 ) {\n	color.g = 1.0;			//green is maxed out\n	color.b = 1.0 - 10.0 * ( scalar - 0.25 );	//blue varies between [1,0]\n} else if ( scalar >= 0.35 && scalar < 0.75 ) {\n	color.r = ( scalar - 0.35 ) * 2.5;	//red varies between [0,1]\n	color.g = 1.0;					//green is maxed out\n} else if ( scalar >= 0.75 && scalar <= 1.0 ) {\n	color.r = 1.0;	//red is maxed out\n	color.g = 1.0 - 4.0 * ( scalar - 0.75 );	//green varies between [1,0]\n}\nreturn vec4( color, 1.0 );\n}\n",fragment:"precision mediump float;\nvarying vec4 fragColor;\nvoid main() {\n	gl_FragColor = fragColor;\n}\n"},t.wireframe={camera:mat4.create(),model:mat4.create(),surfaceColor:vec3.fromValues(.6,.6,.6),enableAttributes:function(t,e){t.enableVertexAttribArray(e.attribute("vert")),t.enableVertexAttribArray(e.attribute("barycentric"))},setAttributes:function(t,e,r){t.vertexAttribPointer(e.attribute("vert"),3,t.FLOAT,!1,0,0),t.vertexAttribPointer(e.attribute("barycentric"),3,t.FLOAT,!1,0,12*r)},setUniforms:function(t){t.setUniform("camera",this.camera,{type:"mat4"}),t.setUniform("model",this.model,{type:"mat4"}),t.setUniform("surfaceColor",this.surfaceColor,{type:"vec3"})},vertex:"attribute vec3 vert;\nattribute vec3 barycentric;\nuniform mat4 camera;\nuniform mat4 model;\nvarying mediump vec3 barycentricPos;\nvoid main( void ) {\n	barycentricPos = barycentric;\n	gl_Position = camera * model * vec4( vert, 1.0 );\n}",fragment:"uniform mediump vec3 surfaceColor;\nvarying mediump vec3 barycentricPos;\nvoid main( void ) {\n	if ( any( lessThan( barycentricPos, vec3( 0.02 ) ) ) ) {\n		gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n	} else {\n		gl_FragColor = vec4( surfaceColor, 1.0 );\n	}\n}"},t.hemisphere={camera:mat4.create(),model:mat4.create(),normalMatrix:mat4.create(),skyColor:vec3.fromValues(.83,.819,.819),groundColor:vec3.fromValues(.181,.161,.095),polar:0,azimuth:0,enableAttributes:function(t,e){t.enableVertexAttribArray(e.attribute("vert")),t.enableVertexAttribArray(e.attribute("norm"))},setAttributes:function(t,e,r){t.vertexAttribPointer(e.attribute("vert"),3,t.FLOAT,!1,0,0),t.vertexAttribPointer(e.attribute("norm"),3,t.FLOAT,!1,0,24*r)},setUniforms:function(t){var e=vec3.fromValues(Math.sin(this.polar)*Math.sin(this.azimuth),Math.cos(this.polar),Math.sin(this.polar)*Math.cos(this.azimuth));t.setUniform("lightPosition",e,{type:"vec3"}),t.setUniform("skyColor",this.skyColor,{type:"vec3"}),t.setUniform("groundColor",this.groundColor,{type:"vec3"});var r=mat4.create();mat4.invert(r,this.model),mat4.transpose(r,r),t.setUniform("normalMatrix",r,{type:"mat4"}),t.setUniform("camera",this.camera,{type:"mat4"}),t.setUniform("model",this.model,{type:"mat4"})},vertex:"precision mediump float;\nattribute vec3 vert;\nattribute vec3 norm;\nuniform mat4 camera;\nuniform mat4 model;\nuniform mat4 normalMatrix;\nuniform vec3 lightPosition;\nuniform vec3 skyColor;\nuniform vec3 groundColor;\nvarying vec3 fragColor;\nvoid main() {\n	vec3 fragNormal = vec3( normalMatrix * vec4( norm, 0.0 ) );\n	vec3 position = vec3( model * vec4( vert, 1.0 ) );\n	vec3 lightVector = normalize( lightPosition - normalize( position ) );\n	float theta = dot( fragNormal, lightVector );\n	float a = theta * 0.5 + 0.5;\n	fragColor = mix( groundColor, skyColor, a );\n	gl_Position = camera * model * vec4( vert, 1.0 );\n}",fragment:"precision mediump float;\nvarying vec3 fragColor;\nvoid main() {\n	gl_FragColor = vec4(fragColor, 1.0 );\n}"},t.flatShader={camera:mat4.create(),model:mat4.create(),surfaceColor:vec3.fromValues(.8,.8,.8),enableAttributes:function(t,e){t.enableVertexAttribArray(e.attribute("vert"))},setAttributes:function(t,e){t.vertexAttribPointer(e.attribute("vert"),3,t.FLOAT,!1,0,0)},setUniforms:function(t){t.setUniform("camera",this.camera,{type:"mat4"}),t.setUniform("model",this.model,{type:"mat4"}),t.setUniform("surfaceColor",this.surfaceColor,{type:"vec3"})},vertex:"attribute vec3 vert;\nuniform mat4 camera;\nuniform mat4 model;\nvoid main( void ) {\n	gl_Position = camera * model * vec4( vert, 1.0 );\n}",fragment:"uniform mediump vec3 surfaceColor;\nvoid main( void ) {\n	gl_FragColor = vec4( surfaceColor, 1.0 );\n}"},t}(morphoviewer||{});
var morphoviewer=function(t){function e(t,e,r){var a=[];"xy"===r?a.push(e*Math.cos(0),e*Math.sin(0),0):"xz"===r?a.push(e*Math.cos(0),0,e*Math.sin(0)):"yz"===r&&a.push(0,e*Math.sin(0),e*Math.cos(0));for(var i=2*Math.PI/t,o=0;i<2*Math.PI;i+=2*Math.PI/t,o++){var n=e*Math.cos(i),s=e*Math.sin(i);"xy"===r?(a.push(n,s,0),a.push(n,s,0)):"xz"===r?(a.push(n,0,s),a.push(n,0,s)):"yz"===r&&(a.push(0,s,n),a.push(0,s,n))}return a.push(a[0],a[1],a[2]),a}return t.Trackball=function(t){this.gl=t,this.numPoints=0,this.vboxy=null,this.vboxz=null,this.vboyz=null,this.radius=1,this.setRadius(1.4)},t.Trackball.prototype.setRadius=function(t){this.radius=t;var r=e(100,t,"xy"),a=e(100,t,"xz"),i=e(100,t,"yz");this.numPoints=r.length/3,this.vboxy=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboxy),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(r),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.vboxz=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboxz),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(a),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.vboyz=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboyz),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(i),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Trackball.prototype.drawXYCircle=function(e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboxy),t.flatShader.setAttributes(this.gl,e),this.gl.drawArrays(this.gl.LINES,0,this.numPoints),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Trackball.prototype.drawXZCircle=function(e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboxz),t.flatShader.setAttributes(this.gl,e),this.gl.drawArrays(this.gl.LINES,0,this.numPoints),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Trackball.prototype.drawYZCircle=function(e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboyz),t.flatShader.setAttributes(this.gl,e),this.gl.drawArrays(this.gl.LINES,0,this.numPoints),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Trackball.prototype.draw=function(e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboxy),t.flatShader.setAttributes(this.gl,e),this.gl.drawArrays(this.gl.LINES,0,this.numPoints),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboxz),t.flatShader.setAttributes(this.gl,e),this.gl.drawArrays(this.gl.LINES,0,this.numPoints),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboyz),t.flatShader.setAttributes(this.gl,e),this.gl.drawArrays(this.gl.LINES,0,this.numPoints),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Trackball.prototype.getRadius=function(){return this.radius},t}((morphoviewer=function(t){function e(t){var e;e=void 0==t?"glcanvas":t;var a=document.getElementById(e),i=r(a);return i?(i.clearColor(.1,.16,.16,1),i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)):alert("morphoviewer.initialize: Unable to initialize WebGL. Your browser may not support it."),[i,a]}function r(t){var e=null;try{e=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(t){}return e}function a(e){var r=new t.Program(e);r.programFromString(t.wireframe.vertex,t.wireframe.fragment);var a=new t.Program(e);a.programFromString(t.color.vertex,t.color.fragment);var i=new t.Program(e);i.programFromString(t.hemisphere.vertex,t.hemisphere.fragment);var o=new t.Program(e);return o.programFromString(t.flatShader.vertex,t.flatShader.fragment),t.flatShader.enableAttributes(e,o),t.flatShader.setAttributes(e,o),[r,a,i,o]}function i(t,e,r){return r>1&&(r=1),vec3.add(vec3.create(),t,vec3.scale(vec3.create(),vec3.subtract(vec3.create(),e,t),r))}function o(e,r,a){e.bind(),t.wireframe.enableAttributes(r,a),t.wireframe.setAttributes(r,a,e.vertices()),e.unbind()}function n(e){e.mesh.bind(),t.color.enableAttributes(e.gl,e.currentProgram),t.color.setAttributes(e.gl,e.currentProgram,e.mesh.vertices(),e.mesh),e.mesh.unbind(),e.renderFunctor=function(){e.mesh.bind(),t.color.setAttributes(e.gl,e.currentProgram,e.mesh.vertices(),e.mesh),t.color.camera=e.camera.matrix(),t.color.model=e.modelView,t.color.setUniforms(e.currentProgram),e.gl.drawArrays(e.gl.TRIANGLES,0,e.mesh.vertices()),e.mesh.unbind()}}var s={};return s.Viewer=function(r){var o=this,n=e(r);this.gl=n[0],this.canvas=n[1],this.showTrackball=!0,this.timer=null,this.endTime=null,this.fps=40,this.mesh=new t.Mesh(this.gl),this.mesh.build({vertex:[],normal:[],curvature:[],orientation:[]}),this.meshCache={vertex:[],normal:[],curvature:[],orientation:[]},this.cameraCache=mat4.create(),this.modelView=mat4.create(),this.opcAreaLimit=.3,this.totalModelArea=1,this.renderFunctor=function(){},this.position=vec3.fromValues(0,0,0),this.targetPosition=vec3.fromValues(0,0,0);var s=this.canvas.clientWidth/this.canvas.clientHeight;this.camera=new t.Camera(60*Math.PI/180,s,.01,1e3),this.mouse={x:0,y:0,prevX:0,prevY:0,dx:0,dy:0},this.leftMouseButtonDown=!1;var l=function(t){o.mouse.x=t.pageX,o.mouse.y=t.pageY,o.mouse.dx=o.mouse.x-o.mouse.prevX,o.mouse.dy=o.mouse.y-o.mouse.prevY,o.mouse.prevX=o.mouse.x,o.mouse.prevY=o.mouse.y},c=function(t){var e=window.event||t;e.preventDefault(),e.stopImmediatePropagation();var r=e.detail?-120*e.detail:e.wheelDelta;o.camera.dolly(-.0025*r)};this.canvas.onmousedown=function(t){switch(!t.which&&t.button&&(1&t.button?t.which=1:4&t.button?t.which=2:2&t.button&&(t.which=3)),o.mouse.prevX=t.pageX,o.mouse.prevY=t.pageY,t.which){case 1:o.leftMouseButtonDown=!0,o.canvas.onmousemove=function(t){l(t),o.camera.orbit(.004*o.mouse.dx,.004*o.mouse.dy)};break;case 3:o.canvas.onmousemove=function(t){l(t);var e=vec3.scale(vec3.create(),o.camera.up(),-o.mouse.dy*o.camera.distanceFromOrigin()*.001),r=vec3.scale(vec3.create(),o.camera.right(),o.mouse.dx*o.camera.distanceFromOrigin()*.001);vec3.add(o.targetPosition,o.targetPosition,e),vec3.add(o.targetPosition,o.targetPosition,r)}}},this.canvas.onmouseup=function(t){switch(!t.which&&t.button&&(1&t.button?t.which=1:4&t.button?t.which=2:2&t.button&&(t.which=3)),t.which){case 1:o.leftMouseButtonDown=!1}o.canvas.onmousemove=function(t){return!1}},this.canvas.oncontextmenu=function(t){t.preventDefault()},this.canvas.addEventListener?(this.canvas.addEventListener("mousewheel",c,!1),this.canvas.addEventListener("DOMMouseScroll",c,!1)):this.canvas.addEventListener("onmousewheel",c),this.timer=new Date,this.trackball=new t.Trackball(this.gl);var h=[-1,1,0,1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0];this.showPlane=!1,this.planeObject=new t.BufferObject(this.gl,this.gl.ARRAY_BUFFER),this.planeObject.dataStore(new Float32Array(h),this.gl.STATIC_DRAW),this.planeRotationMatrix=mat4.create(),this.planeTranslationMatrix=mat4.create(),this.planeScalingMatrix=mat4.create(),this.plane=new t.Plane(vec3.fromValues(0,0,0),vec3.fromValues(1,0,0),vec3.fromValues(0,1,0));setInterval(function(){o.gl.clear(o.gl.COLOR_BUFFER_BIT|o.gl.DEPTH_BUFFER_BIT),o.endTime=new Date;var e=o.endTime-o.timer;if(e/=1e3,o.position=i(o.position,o.targetPosition,.5*(1-e)),o.modelView=mat4.create(),mat4.translate(o.modelView,o.modelView,o.position),o.camera.update(e),o.renderFunctor(),o.showTrackball&&(o.currentProgram.stopUsing(),o.lineProgram.use(),t.flatShader.camera=o.camera.matrix(),t.flatShader.model=mat4.create(),t.flatShader.surfaceColor=vec3.fromValues(.7,.7,.7),o.leftMouseButtonDown?(t.flatShader.surfaceColor=vec3.fromValues(.38,.38,1),t.flatShader.setUniforms(o.lineProgram),o.trackball.drawXYCircle(o.lineProgram),t.flatShader.surfaceColor=vec3.fromValues(.38,1,.38),t.flatShader.setUniforms(o.lineProgram),o.trackball.drawXZCircle(o.lineProgram),t.flatShader.surfaceColor=vec3.fromValues(1,.38,.38),t.flatShader.setUniforms(o.lineProgram),o.trackball.drawYZCircle(o.lineProgram)):(t.flatShader.setUniforms(o.lineProgram),o.trackball.draw(o.lineProgram)),o.lineProgram.stopUsing(),o.currentProgram.use()),o.showPlane){o.currentProgram.stopUsing(),o.planeProgram.use(),o.planeObject.bind(),t.flatShader.camera=o.camera.matrix();var r=mat4.multiply(mat4.create(),o.planeRotationMatrix,o.planeScalingMatrix);mat4.multiply(r,o.planeTranslationMatrix,r),t.flatShader.model=r,t.flatShader.surfaceColor=vec3.fromValues(.45,.45,.7),t.flatShader.setUniforms(o.planeProgram),t.flatShader.setAttributes(o.gl,o.planeProgram),o.gl.drawArrays(o.gl.TRIANGLES,0,6),o.planeObject.unbind(),o.planeProgram.stopUsing(),o.currentProgram.use()}o.timer=new Date},1e3/this.fps,this.gl,this.renderFunctor,this.lineProgram,this.currentProgram,this.trackball,this.camera,this.timer);var u=a(this.gl);this.wireframeProgram=u[0],this.colorProgram=u[1],this.lineProgram=u[3],this.planeProgram=this.lineProgram,this.hemisphereProgram=u[2],this.currentProgram=this.hemisphereProgram,this.viewHemispherical()},s.Viewer.prototype.loadData=function(e){var r=this,a=t.io.getFileType(e);if("stl"===a){var i=(V=t.parseSTL(e)).v,o=V.vn,n=t.surfaceVariation(i,o),s=t.surfaceOrientation(o);t.centerPointCloud(i,"unwrapped"),r.meshCache={vertex:[],normal:[],index:[],orientation:[],curvature:[],wrappedVertex:[],wrappedNormal:[],adjacencyList:[]},r.meshCache.vertex=i,r.meshCache.normal=o,r.meshCache.orientation=s,r.meshCache.curvature=n,r.mesh=new t.Mesh(r.gl),r.mesh.build({vertex:i,normal:o,curvature:n,orientation:s});C=t.getAabbFromUnwrapped(i);r.planeScalingMatrix=mat4.fromScaling(mat4.create(),vec3.fromValues(.7*C.width,.7*C.height,1)),r.trackball.setRadius(C.length/2.3),r.camera.setBestPositionForModel(C)}else if("ply"===a){for(var i=[],l=(V=t.parsePLY(e)).vertex,c=l.x,h=l.y,u=l.z,m=V.vertex.x.length,f=0;f<m;f++)i.push([c[f],h[f],u[f]]);var p=[],v=V.face.vertex_indices;m=v.length;for(f=0;f<m;f++)p.push(v[f]);var g=t.adjacencyList(i,p),o=[];if(void 0!==l.nx)for(var d=l.nx,b=l.ny,w=l.nz,f=0;f<m;f++)o.push([d[f],b[f],w[f]]);else o=t.vertexNormals(i,p,g);s=[];if(void 0!==l.orientation)for(var y=l.orientation,f=0;f<m;f++)s.push(y[f]);n=[];if(void 0!==V.face.curvature)for(var P=V.face.curvature,f=0;f<P.length;f++)n.push(P[f],P[f],P[f]);t.centerPointCloud(i);var A=t.unwrapVectorArray(i,p),F=t.unwrapVectorArray(o,p);r.meshCache={vertex:[],normal:[],index:[],orientation:[],curvature:[],wrappedVertex:[],wrappedNormal:[],adjacencyList:[]},r.meshCache.vertex=A,r.meshCache.normal=F,r.meshCache.index=p,r.meshCache.wrappedVertex=i,r.meshCache.wrappedNormal=o,r.meshCache.adjacencyList=g,void 0!==l.orientation?r.meshCache.orientation=t.unwrapArray(s,p):r.meshCache.orientation=t.surfaceOrientation(F),void 0!==V.face.curvature?r.meshCache.curvature=n:r.meshCache.curvature=t.surfaceVariation(A,F),r.mesh=new t.Mesh(r.gl),r.mesh.build({vertex:A,normal:F,curvature:r.meshCache.curvature,orientation:r.meshCache.orientation});C=t.getAabb(i);r.planeScalingMatrix=mat4.fromScaling(mat4.create(),vec3.fromValues(.7*C.width,.7*C.height,1)),r.trackball.setRadius(C.length/2.3),r.camera.setBestPositionForModel(C)}else{if("csv"!==a)return void alert("morphoviewer.Viewer.view: unrecognized file format");var V=t.parseCSV(e,","),i=V.points;t.centerPointCloud(i);var p=t.triangulate(i),g=t.adjacencyList(i,p),o=t.vertexNormals(i,p,g),A=t.unwrapVectorArray(i,p),F=t.unwrapVectorArray(o,p),n=t.surfaceVariation(A,F),s=t.surfaceOrientation(F);r.meshCache={vertex:[],normal:[],index:[],orientation:[],curvature:[],wrappedVertex:[],wrappedNormal:[],adjacencyList:[]},r.meshCache.vertex=A,r.meshCache.normal=F,r.meshCache.index=p,r.meshCache.orientation=s,r.meshCache.curvature=n,r.meshCache.wrappedVertex=i,r.meshCache.wrappedNormal=o,r.meshCache.adjacencyList=g,r.mesh=new t.Mesh(r.gl),r.mesh.build({vertex:A,normal:F,curvature:n,orientation:s});var C=t.getAabb(i);r.trackball.setRadius(C.length/2.3),r.camera.setBestPositionForModel(C),r.planeScalingMatrix=mat4.fromScaling(mat4.create(),vec3.fromValues(.7*C.width,.7*C.height,1))}this.cameraCache=this.camera.rotation(),r.totalModelArea=t.modelArea(r.meshCache.wrappedVertex,r.meshCache.index)},s.Viewer.prototype.view=function(e){var r=this;t.io.loadFile(e,function(t){r.loadData(t)})},s.Viewer.prototype.viewWireframe=function(){this.currentProgram=this.wireframeProgram,this.currentProgram.use(),o(this.mesh,this.gl,this.currentProgram),this.renderFunctor=function(){this.mesh.bind(),t.wireframe.setAttributes(this.gl,this.currentProgram,this.mesh.vertices()),t.wireframe.camera=this.camera.matrix(),t.wireframe.model=this.modelView,t.wireframe.setUniforms(this.currentProgram),this.gl.drawArrays(this.gl.TRIANGLES,0,this.mesh.vertices()),this.mesh.unbind()}},s.Viewer.prototype.viewSurfaceOrientation=function(){this.mesh.has("orientation")&&(this.currentProgram.object!=this.colorProgram.object&&(this.currentProgram=this.colorProgram,this.currentProgram.use(),n(this)),t.color.colorMode=2)},s.Viewer.prototype.viewSurfaceCurvature=function(){this.mesh.has("curvature")&&(this.currentProgram.object!=this.colorProgram.object&&(this.currentProgram=this.colorProgram,this.currentProgram.use(),n(this)),t.color.colorMode=1)},s.Viewer.prototype.viewHemispherical=function(){this.currentProgram=this.hemisphereProgram,this.currentProgram.use(),this.mesh.bind(),t.hemisphere.enableAttributes(this.gl,this.currentProgram),t.hemisphere.setAttributes(this.gl,this.currentProgram,this.mesh.vertices()),this.mesh.unbind();var e=this;this.renderFunctor=function(){e.mesh.bind(),t.hemisphere.setAttributes(e.gl,e.currentProgram,e.mesh.vertices()),t.hemisphere.camera=e.camera.matrix(),t.hemisphere.model=e.modelView,t.hemisphere.setUniforms(this.currentProgram),e.gl.drawArrays(e.gl.TRIANGLES,0,e.mesh.vertices()),e.mesh.unbind()}},s.Viewer.prototype.viewOrtho=function(){this.camera.viewAsOrtho()},s.Viewer.prototype.viewPerspective=function(){this.camera.viewAsPerspective()},s.Viewer.prototype.viewLeft=function(){this.targetPosition=vec3.fromValues(0,0,0),this.camera.positionLeft()},s.Viewer.prototype.viewRight=function(){this.targetPosition=vec3.fromValues(0,0,0),this.camera.positionRight()},s.Viewer.prototype.viewTop=function(){this.targetPosition=vec3.fromValues(0,0,0),this.camera.positionTop()},s.Viewer.prototype.viewBottom=function(){this.targetPosition=vec3.fromValues(0,0,0),this.camera.positionBottom()},s.Viewer.prototype.viewFront=function(){this.targetPosition=vec3.fromValues(0,0,0),this.camera.positionFront()},s.Viewer.prototype.viewBack=function(){this.targetPosition=vec3.fromValues(0,0,0),this.camera.positionBack()},s.Viewer.prototype.showTrackingball=function(){this.showTrackball=!0},s.Viewer.prototype.hideTrackingball=function(){this.showTrackball=!1},s.color={black:vec3.fromValues(0,0,0),white:vec3.fromValues(1,1,1),lightgray:vec3.fromValues(.91,.91,.91),lightgrey:vec3.fromValues(.91,.91,.91),darkgray:vec3.fromValues(.41,.41,.41),darkgrey:vec3.fromValues(.41,.41,.41)},s.Viewer.prototype.setBackgroundColor=function(t){this.gl.clearColor(t[0],t[1],t[2],1)},s.Viewer.prototype.setFOV=function(t){this.camera.setFOV(Math.PI*t/180)},s.Viewer.prototype.setLightPolarAngle=function(e){t.hemisphere.polar=e},s.Viewer.prototype.setLightAzimuthalAngle=function(e){t.hemisphere.azimuth=e},s.Viewer.prototype.calculateOrientation=function(){this.meshCache.orientation=t.surfaceOrientationAboutCamera(this.meshCache.normal,this.camera.rotation()),this.mesh=new t.Mesh(this.gl),this.mesh.build(this.meshCache),this.cameraCache=this.camera.rotation()},s.Viewer.prototype.setPatchCutoff=function(t){t>=0&&t<100?this.opcAreaLimit=t:console.log("Viewer.setAreaLimit: invalid percentage "+t)},s.Viewer.prototype.opc=function(){if(0===this.meshCache.wrappedVertex.length)return alert("The file format (STL) does not support orientation patch count calculations. Consider converting the file into something else!"),0;for(var e=this.cameraCache,r=this.meshCache.wrappedNormal,a=[],i=0;i<r.length;i++){var o=e[0]*r[i][0]+e[1]*r[i][1]+e[2]*r[i][2],n=e[3]*r[i][0]+e[4]*r[i][1]+e[3]*r[i][2],s=vec2.normalize(vec2.create(),vec2.fromValues(o,n)),l=t.angleRangeClamp(Math.atan2(s[1],s[0])),c=Math.floor(l/(2*Math.PI/8));c/=7,a.push(c)}return count=t.opc(this.meshCache.wrappedVertex,this.meshCache.adjacencyList,a,this.opcAreaLimit,this.totalModelArea)},s.Viewer.prototype.showOpcSelectionPlane=function(){this.showPlane=!0},s.Viewer.prototype.hideOpcSelectionPlane=function(){this.showPlane=!1},s.Viewer.prototype.setOpcSelectionPlane=function(){this.planeRotationMatrix=mat4.invert(mat4.create(),t.rotationMatrix4(vec3.fromValues(0,0,-1),this.camera.forward())),this.plane=new t.Plane(vec3.transformMat4(vec3.create(),vec3.fromValues(0,0,0),this.planeRotationMatrix),vec3.transformMat4(vec3.create(),vec3.fromValues(1,0,0),this.planeRotationMatrix),vec3.transformMat4(vec3.create(),vec3.fromValues(0,1,0),this.planeRotationMatrix))},s.Viewer.prototype.translateOpcSelectionPlane=function(t){var e=this.plane.getNormal();vec3.normalize(e,e),vec3.scale(e,e,.9*t),mat4.multiply(this.planeTranslationMatrix,this.planeTranslationMatrix,mat4.fromTranslation(mat4.create(),e))},s.Viewer.prototype.flipOpcSelectionPlane=function(){this.plane.flip()},s.Viewer.prototype.modelArea=function(){return this.totalModelArea},s.io={},s.io.loadFile=t.io.loadFile,s.io.getFileType=t.io.getFileType,s.io.loadPLY=t.io.loadPLY,s.io.loadOBJ=t.io.loadOBJ,s.io.loadCSV=t.io.loadCSV,s}(morphoviewer=function(t){function e(t){for(var e=0,r=0,a=0,i=0;i<t.length;i++)e+=t[i][0],r+=t[i][1],a+=t[i][2];return e/=t.length,r/=t.length,a/=t.length,[e,r,a]}function r(t){for(var r=e(t),a=0;a<t.length;a++)t[a][0]-=r[0],t[a][1]-=r[1],t[a][2]-=r[2]}function i(t){for(var e=0,r=0,a=0,i=0;i<t.length;i+=3)e+=t[i],r+=t[i+1],a+=t[i+2];e/=t.length,r/=t.length,a/=t.length;for(i=0;i<t.length;i+=3)t[i]-=e,t[i+1]-=r,t[i+2]-=a}function o(t,e){for(var r=new Array(t.length),a=0;a<e.length;a++){var i=vec3.fromValues(t[e[a][1]][0]-t[e[a][0]][0],t[e[a][1]][1]-t[e[a][0]][1],t[e[a][1]][2]-t[e[a][0]][2]),o=vec3.fromValues(t[e[a][2]][0]-t[e[a][0]][0],t[e[a][2]][1]-t[e[a][0]][1],t[e[a][2]][2]-t[e[a][0]][2]),n=vec3.cross(vec3.create(),i,o);r[e[a][0]]=[n[0],n[1],n[2]],r[e[a][1]]=[n[0],n[1],n[2]],r[e[a][2]]=[n[0],n[1],n[2]]}return r}function n(t){return t>1e3&&(t=1e3),t}return t.centerPointCloud=function(t,e){void 0===e&&(e="wrapped"),"wrapped"===e?r(t):"unwrapped"===e&&i(t)},t.unwrapVectorArray=function(t,e){for(var r=[],a=0;a<e.length;a++)r.push(t[e[a][0]][0],t[e[a][0]][1],t[e[a][0]][2]),r.push(t[e[a][1]][0],t[e[a][1]][1],t[e[a][1]][2]),r.push(t[e[a][2]][0],t[e[a][2]][1],t[e[a][2]][2]);return r},t.unwrapArray=function(t,e){for(var r=[],a=0;a<e.length;a++)r.push(t[e[a][0]],t[e[a][1]],t[e[a][2]]);return r},t.getAabb=function(t){for(var e=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,s=0;s<t.length;s++)t[s][0]<e&&(e=t[s][0]),t[s][0]>r&&(r=t[s][0]),t[s][1]<a&&(a=t[s][1]),t[s][1]>i&&(i=t[s][1]),t[s][2]<o&&(o=t[s][2]),t[s][2]>n&&(n=t[s][2]);var l=(r-e)*(r-e);return l+=(i-a)*(i-a),l+=(n-o)*(n-o),{width:r-e,height:i-a,min:{x:e,y:a,z:o},max:{x:r,y:i,z:n},center:{x:e+r/2,y:a+i/2,z:o+n/2},length:Math.sqrt(l)}},t.getAabbFromUnwrapped=function(t){for(var e=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,s=0;s<t.length;s+=3)t[s]<e&&(e=t[s]),t[s]>r&&(r=t[s]),t[s+1]<a&&(a=t[s+1]),t[s+1]>i&&(i=t[s+1]),t[s+2]<o&&(o=t[s+2]),t[s+2]>n&&(n=t[s+2]);var l=(r-e)*(r-e);return l+=(i-a)*(i-a),l+=(n-o)*(n-o),{min:{x:e,y:a,z:o},max:{x:r,y:i,z:n},center:{x:e+r/2,y:a+i/2,z:o+n/2},length:Math.sqrt(l)}},t.triangulate=function(t){for(var e=Delaunay.triangulate(t),r=[],a=0;a<e.length;a+=3)r.push([e[a],e[a+1],e[a+2]]);return r},t.faceNormals=function(t,e){for(var r=new Array(t.length),a=0;a<e.length;a++){var i=vec3.fromValues(t[e[a][1]][0]-t[e[a][0]][0],t[e[a][1]][1]-t[e[a][0]][1],t[e[a][1]][2]-t[e[a][0]][2]),o=vec3.fromValues(t[e[a][2]][0]-t[e[a][0]][0],t[e[a][2]][1]-t[e[a][0]][1],t[e[a][2]][2]-t[e[a][0]][2]),n=vec3.cross(vec3.create(),i,o);vec3.normalize(n,n),r[e[a][0]]=[n[0],n[1],n[2]],r[e[a][1]]=[n[0],n[1],n[2]],r[e[a][2]]=[n[0],n[1],n[2]]}return r},t.adjacencyList=function(t,e){for(var r=new Array(t.length),a=0;a<t.length;a++)r[a]=[];for(a=0;a<e.length;a++)r[e[a][0]].push(e[a][1],e[a][2]),r[e[a][1]].push(e[a][0],e[a][2]),r[e[a][2]].push(e[a][0],e[a][1]);return r},t.vertexNormals=function(t,e,r){for(var a=o(t,e),i=new Array(t.length),n=0;n<t.length;n++){for(var s=vec3.fromValues(0,0,0),l=0;l<r[n].length;l++)vec3.add(s,s,vec3.fromValues(a[r[n][l]][0],a[r[n][l]][1],a[r[n][l]][2]));vec3.normalize(s,s),i[n]=new Array(3),i[n][0]=s[0],i[n][1]=s[1],i[n][2]=s[2]}return i},t.surfaceVariation=function(t,e){for(var r=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,i=[],o=0;o<t.length;o+=9){var s=vec3.fromValues(t[o+3]-t[o],t[o+4]-t[o+1],t[o+5]-t[o+2]),l=vec3.fromValues(t[o+6]-t[o],t[o+7]-t[o+1],t[o+8]-t[o+2]),c=mat2.create();c[0]=vec3.dot(s,s),c[1]=vec3.dot(s,l),c[2]=vec3.dot(s,l),c[3]=vec3.dot(l,l);var h=vec3.fromValues(e[o+3]-e[o],e[o+4]-e[o+1],e[o+5]-e[o+2]),u=vec3.fromValues(e[o+6]-e[o],e[o+7]-e[o+1],e[o+8]-e[o+2]),m=mat2.create();m[0]=vec3.dot(h,h),m[1]=vec3.dot(h,u),m[2]=vec3.dot(h,u),m[3]=vec3.dot(u,u);var f=mat2.create();mat2.invert(c,c),mat2.multiply(f,c,m);var p=f[0]+f[3];p=n(p),i.push(p),i.push(p),i.push(p),p>r?r=p:p<a&&(a=p)}for(o=0;o<i.length;o++)i[o]/=r;return i},t.surfaceOrientation=function(e){for(var r=[],a=0;a<e.length;a+=3){var i=vec2.normalize(vec2.create(),vec2.fromValues(e[a],e[a+1])),o=t.angleRangeClamp(Math.atan2(i[1],i[0])),n=Math.floor(o/(2*Math.PI/8));n/=7,r.push(n)}return r},t.surfaceOrientationAboutCamera=function(e,r){for(var a=[],i=0;i<e.length;i+=3){var o=r[0]*e[i]+r[1]*e[i+1]+r[2]*e[i+2],n=r[3]*e[i]+r[4]*e[i+1]+r[3]*e[i+2],s=vec2.normalize(vec2.create(),vec2.fromValues(o,n)),l=t.angleRangeClamp(Math.atan2(s[1],s[0])),c=Math.floor(l/(2*Math.PI/8));c/=7,a.push(c)}return a},t.modelArea=function(t,e){for(var r=0,a=0;a<e.length;a++){var i=[t[e[a][0]][0]-t[e[a][1]][0],t[e[a][0]][1]-t[e[a][1]][1],t[e[a][0]][2]-t[e[a][1]][2]],o=[t[e[a][0]][0]-t[e[a][2]][0],t[e[a][0]][1]-t[e[a][2]][1],t[e[a][0]][2]-t[e[a][2]][2]],n=[i[1]*o[2]-i[2]*o[1],i[2]*o[0]-i[0]*o[2],i[0]*o[1]-i[1]*o[0]];r+=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])}return r},t.opc=function(t,e,r,i,o){for(var n=[],s=0;s<t.length;s++)n.push(!1);var l=[],c=0;l.push(0);do{s=l.pop();if(!n[s]){var h=function(t,e,r,i){var o=[],s=0;o.push(i);do{var c=o.pop();a=null,b=null,n[c]=!0;for(var h=0;h<e[c].length;h++){var u=e[c][h];if(!n[u])if(r[u]===r[c]){if(b=a,a=[t[h][0]-t[c][0],t[h][1]-t[c][2],t[h][1]-t[c][2]],a&&b){var m=[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];s+=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2])}o.push(u)}else l.push(u)}}while(0!=o.length);return s}(t,e,r,s);(h/=o)>i&&(c+=1)}}while(0!=l.length);return c},t.angleRangeClamp=function(t){return t>2*Math.PI?t-2*Math.PI:t<0?t+2*Math.PI:t},t}((morphoviewer=function(t){function e(t,e){var a,i,o,n;if(!(a=document.getElementById(e)))return alert("getShaderFromDOM: no such shader: "+e),null;for(i="",o=a.firstChild;o;)o.nodeType==o.TEXT_NODE&&(i+=o.textContent),o=o.nextSibling;if("x-shader/x-fragment"==a.type)n=r(t,i,"fragment");else{if("x-shader/x-vertex"!=a.type)return alert("getShaderFromDOM: unknown shader type, returning null."),null;n=r(t,i,"vertex")}return n}function r(t,e,r){var a;if("fragment"==r)a=t.createShader(t.FRAGMENT_SHADER);else{if("vertex"!=r)return alert("getShaderFromString: unknown shader type, returning null."),null;a=t.createShader(t.VERTEX_SHADER)}return t.shaderSource(a,e),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?a:(alert("getShaderFromString: could not compile "+r+" shader: "+t.getShaderInfoLog(a)),null)}function a(t,e,r){var a=t.createProgram();return t.attachShader(a,e),t.attachShader(a,r),t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||console.log("getProgram: unable to link the shader program "+t.getProgramInfoLog(a)),a}function i(t,e,r){return t<e?t=e:t>r&&(t=r),t}function o(t,e,r){return r>1&&(r=1),t+r*(e-t)}function n(t,e){var r=mat3.create();return r[0]=Math.cos(e)+t[0]*t[0]*(1-Math.cos(e)),r[1]=t[0]*t[1]*(1-Math.cos(e))-t[2]*Math.sin(e),r[2]=t[0]*t[2]*(1-Math.cos(e))+t[1]*Math.sin(e),r[3]=t[1]*t[0]*(1-Math.cos(e))+t[2]*Math.sin(e),r[4]=Math.cos(e)+t[1]*t[1]*(1-Math.cos(e)),r[5]=t[1]*t[2]*(1-Math.cos(e))-t[0]*Math.sin(e),r[6]=t[2]*t[0]*(1-Math.cos(e))-t[1]*Math.sin(e),r[7]=t[2]*t[1]*(1-Math.cos(e))+t[0]*Math.sin(e),r[8]=Math.cos(e)+t[2]*t[2]*(1-Math.cos(e)),r}return t.Program=function(t){this.gl=t,this.object=null},t.Program.prototype.programFromDOM=function(t,r){var i=e(this.gl,r),o=e(this.gl,t);this.object=a(this.gl,o,i)},t.Program.prototype.programFromString=function(t,e){var i=r(this.gl,t,"vertex"),o=r(this.gl,e,"fragment");this.object=a(this.gl,i,o)},t.Program.prototype.use=function(){this.gl.useProgram(this.object)},t.Program.prototype.isInUse=function(){return 0==this.object},t.Program.prototype.stopUsing=function(){this.isInUse()&&this.gl.useProgram(null)},t.Program.prototype.attribute=function(t){var e=this.gl.getAttribLocation(this.object,t);return-1==e?(console.log("Program.attribute: shader attribute "+t+" not found."),null):e},t.Program.prototype.uniform=function(t){var e=this.gl.getUniformLocation(this.object,t);return-1==e?(console.log("Program.uniform: shader uniform "+t+" not found."),null):e},t.Program.prototype.setUniform=function(t,e,r){switch(r.type){case"float":this.gl.uniform1f(this.uniform(t),e);break;case"vec3":this.gl.uniform3fv(this.uniform(t),e);break;case"vec4":this.gl.uniform4fv(this.uniform(t),e);break;case"mat3":this.gl.uniformMatrix3fv(this.uniform(t),e);break;case"mat4":this.gl.uniformMatrix4fv(this.uniform(t),!1,e);break;case"int":this.gl.uniform1i(this.uniform(t),e);break;default:console.log("Program.setUniform: unknown type "+r.type)}},t.BufferObject=function(t,e){this.gl=t,this.target=e,this.object=this.gl.createBuffer()},t.BufferObject.prototype.dataStore=function(t,e){this.bind(),this.gl.bufferData(this.target,t,e),this.unbind()},t.BufferObject.prototype.bind=function(){this.gl.bindBuffer(this.target,this.object)},t.BufferObject.prototype.unbind=function(){this.gl.bindBuffer(this.target,null)},t.Mesh=function(t){this.gl=t,this.vbo=null,this.numVertices=0,this.contains={vertex:!1,barycentric:!1,normal:!1,curvature:!1,orientation:!1}},t.Mesh.prototype.object=function(){return this.vbo},t.Mesh.prototype.build=function(t){t.vertex.length;var e=[];if(void 0!==t.vertex){e=t.vertex.slice(),this.numVertices=e.length/3,this.contains.vertex=!0;for(var r=new Array(e.length),a=0;a<3*this.numVertices;a+=9)r[a]=1,r[a+1]=0,r[a+2]=0,r[a+3]=0,r[a+4]=1,r[a+5]=0,r[a+6]=0,r[a+7]=0,r[a+8]=1;e=e.concat(r),this.contains.barycentric=!0}else alert("morphoviewer.Mesh.build error: no vertices supplied!");void 0!==t.normal&&(e=e.concat(t.normal),this.contains.normal=!0),void 0!==t.curvature&&(e=e.concat(t.curvature),this.contains.curvature=!0),void 0!==t.orientation&&(e=e.concat(t.orientation),this.contains.orientation=!0),this.vbo=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Mesh.prototype.has=function(t){return this.contains[t]},t.Mesh.prototype.vertices=function(){return this.numVertices},t.Mesh.prototype.bind=function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo)},t.Mesh.prototype.unbind=function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},t.Camera=function(t,e,r,a){this.position=vec3.fromValues(0,0,2),this.targetPosition=vec3.fromValues(0,0,2),this.targetRadius=2,this.radius=10,this.polar=Math.PI/2,this.azimuth=0,this.viewTransform=mat4.create(),this.sensitivity=.1*this.radius,this.verticalFOV=t,this.aspectRatio=e,this.nearPlane=r,this.farPlane=a,this.viewPerspective=!1,this.zoomFactor=1,this.targetZoomFactor=1},t.Camera.prototype.setFOV=function(t){this.verticalFOV=t,this.verticalFOV<=0&&(this.verticalFOV=Math.abs(this.verticalFOV))},t.Camera.prototype.matrix=function(){return mat4.multiply(mat4.create(),this.perspective(),this.view())},t.Camera.prototype.viewAsOrtho=function(){this.viewPerspective=!1},t.Camera.prototype.viewAsPerspective=function(){this.viewPerspective=!0},t.Camera.prototype.perspective=function(){return this.viewPerspective?mat4.perspective(mat4.create(),this.verticalFOV,this.aspectRatio,this.nearPlane,this.farPlane):mat4.ortho(mat4.create(),-o(this.nearPlane,this.farPlane,.01*this.aspectRatio*this.zoomFactor),o(this.nearPlane,this.farPlane,.01*this.aspectRatio*this.zoomFactor),-o(this.nearPlane,this.farPlane,.01*this.zoomFactor),o(this.nearPlane,this.farPlane,.01*this.zoomFactor),this.nearPlane,this.farPlane)},t.Camera.prototype.view=function(){return this.viewTransform},t.Camera.prototype.distanceFromOrigin=function(){return this.radius},t.Camera.prototype.setFOV=function(t){if(t<0)throw"Camera.setFOV: negative vertical field of view";this.verticalFOV=t},t.Camera.prototype.setAspectRatio=function(t){if(t<0)throw"Camera.setAspectRatio: negative aspect ratio";this.aspectRatio=t},t.Camera.prototype.setNearPlane=function(t){if(t>this.farPlane)throw"Camera.setNearPlane: near plane is farther than the far plane";this.nearPlane=t},t.Camera.prototype.setFarPlane=function(t){if(t<this.nearPlane)throw"Camera.setFarPlane: far plane is nearer than the near plane";this.farPlane=t},t.Camera.prototype.dolly=function(t){this.targetRadius+=this.sensitivity*t,this.targetRadius<0&&(this.targetRadius=.001)},t.Camera.prototype.orbit=function(t,e){this.polar-=e,this.polar=i(this.polar,.01,Math.PI),this.azimuth-=t},t.Camera.prototype.update=function(t){this.targetZoomFactor=.07*this.targetRadius,this.zoomFactor=o(this.zoomFactor,this.targetZoomFactor,20*t),this.radius=o(this.radius,this.targetRadius,20*t),this.sensitivity=.1*this.radius;var e=vec3.fromValues(Math.sin(this.polar)*Math.sin(this.azimuth),Math.cos(this.polar),Math.sin(this.polar)*Math.cos(this.azimuth));this.targetPosition=vec3.scale(vec3.create(),e,this.radius),vec3.lerp(this.position,this.position,this.targetPosition,20*t),mat4.lookAt(this.viewTransform,this.position,vec3.create(0,0,0),this.up())},t.Camera.prototype.setBestPositionForModel=function(t){var e=Math.max(Math.abs(t.max.y),Math.abs(t.min.y)),r=Math.max(Math.abs(t.max.x),Math.abs(t.min.x)),a=Math.max(e,r);this.targetRadius=1.1*a/Math.tan(.5*this.verticalFOV)},t.Camera.prototype.rotation=function(){return mat3.multiply(mat3.create(),n([0,0,1],this.azimuth),n([1,0,0],.5*Math.PI-this.polar))},t.Camera.prototype.forward=function(){var t=vec3.normalize(vec3.create(),this.position);return vec3.fromValues(-t[0],-t[1],-t[2])},t.Camera.prototype.right=function(){var t=this.radius*Math.sin(this.polar)*Math.cos(this.azimuth),e=-this.radius*Math.sin(this.polar)*Math.sin(this.azimuth);return vec3.normalize(vec3.create(),vec3.fromValues(t,0,e))},t.Camera.prototype.up=function(){return vec3.cross(vec3.create(),this.right(),this.forward())},t.Camera.prototype.positionLeft=function(){this.polar=Math.PI/2,this.azimuth=Math.PI/2},t.Camera.prototype.positionRight=function(){this.polar=Math.PI/2,this.azimuth=3*Math.PI/2},t.Camera.prototype.positionTop=function(){this.polar=.001,this.azimuth=0},t.Camera.prototype.positionBottom=function(){this.polar=Math.PI,this.azimuth=0},t.Camera.prototype.positionFront=function(){this.polar=Math.PI/2,this.azimuth=0},t.Camera.prototype.positionBack=function(){this.polar=Math.PI/2,this.azimuth=Math.PI},t.color={camera:mat4.create(),model:mat4.create(),colorMode:1,enableAttributes:function(t,e){t.enableVertexAttribArray(e.attribute("vert")),t.enableVertexAttribArray(e.attribute("curvature")),t.enableVertexAttribArray(e.attribute("orientation"))},setAttributes:function(t,e,r,a){t.vertexAttribPointer(e.attribute("vert"),3,t.FLOAT,!1,0,0),a.has("curvature")&&a.has("orientation")&&(t.vertexAttribPointer(e.attribute("curvature"),1,t.FLOAT,t.FALSE,0,36*r),t.vertexAttribPointer(e.attribute("orientation"),1,t.FLOAT,t.FALSE,0,40*r))},setUniforms:function(t){t.setUniform("camera",this.camera,{type:"mat4"}),t.setUniform("model",this.model,{type:"mat4"}),t.setUniform("colorMode",this.colorMode,{type:"int"})},vertex:"precision mediump float;\nattribute vec3 vert;\nattribute float curvature;\nattribute float orientation;\nuniform mat4 model;\nuniform mat4 camera;\nuniform int colorMode;\nvarying vec4 fragColor;\nvec4 yellowToRed( float scalar );\nvec4 longRainbow( float scalar );\nvec4 shortRainbow( float scalar );\nvoid main() {\n\tif ( colorMode == 1 ) {\t//dirichlet normal energy\n       float scalar = ( exp(1.3*curvature) - 1.0 ) / ( exp(1.3) - 1.0 );\n       \n       \n\t\tfragColor = yellowToRed( scalar );\n\t} else if ( colorMode == 2 ) {\t//orientation map\n\t\tfragColor = longRainbow( orientation );\n\t}\n\tgl_Position = camera * model * vec4( vert, 1.0 );\n}\nvec4 yellowToRed( float scalar ) {\nvec4 color = vec4( 0.0, 0.0, 0.0, 1.0 );\ncolor.r = 1.0;\ncolor.g = 1.0 - scalar;\nreturn color;\n}\nvec4 longRainbow( float scalar ) {\nscalar = scalar/2; \nvec3 color = vec3( 0.0, 0.0, 0.0 );\nif ( scalar >= 0.0 && scalar < 0.1666 ) {\n\tcolor.g = scalar * 6.0;\n\tcolor.b = 1.0;\n} else if ( scalar >= 0.1666 && scalar < 0.3333 ) {\n\tcolor.g = 1.0;\n\tcolor.b = 1.0 - 6.0 * (scalar - 0.1666);\n} else if ( scalar >= 0.3333 && scalar < 0.5000 ) {\n\tcolor.r = 6.0 * (scalar - 0.3333);\n\tcolor.g = 1.0;\n} else if ( scalar >= 0.5000 && scalar < 0.6666 ) {\n\tcolor.r = 1.0;\n\tcolor.g = 1.0 - 6.0 * (scalar - 0.5000);\n} else if ( scalar >= 0.6666 && scalar < 0.8333 ) {\n   color.b = 6.0*(scalar - 0.6666);\n   color.r = 1.0;\n} else if ( scalar >= 0.8333 && scalar <= 1.0 ) {\n   color.b = 1.0;\n   color.r = 1.0 - 6.0 * (scalar - 0.8333);\n}\nreturn vec4( 0.0, 0.0, 0.0, 1.0 );\n}\nvec4 shortRainbow( float scalar ) {\t//scalar must be normalized!\nvec3 color = vec3( 0.0, 0.0, 0.0 );\nif ( scalar >= 0.0 && scalar < 0.25 ) {\n\tcolor.g = scalar * 4.0;\t//green varies linearly between [0,1]\n\tcolor.b = 1.0;\t\t\t//blue is maxed out\n} else if ( scalar >= 0.25 && scalar < 0.35 ) {\n\tcolor.g = 1.0;\t\t\t//green is maxed out\n\tcolor.b = 1.0 - 10.0 * ( scalar - 0.25 );\t//blue varies between [1,0]\n} else if ( scalar >= 0.35 && scalar < 0.75 ) {\n\tcolor.r = ( scalar - 0.35 ) * 2.5;\t//red varies between [0,1]\n\tcolor.g = 1.0;\t\t\t\t\t//green is maxed out\n} else if ( scalar >= 0.75 && scalar <= 1.0 ) {\n\tcolor.r = 1.0;\t//red is maxed out\n\tcolor.g = 1.0 - 4.0 * ( scalar - 0.75 );\t//green varies between [1,0]\n}\nreturn vec4( color, 1.0 );\n}\n",fragment:"precision mediump float;\nvarying vec4 fragColor;\nvoid main() {\n\tgl_FragColor = fragColor;\n}\n"},t.wireframe={camera:mat4.create(),model:mat4.create(),surfaceColor:vec3.fromValues(.6,.6,.6),enableAttributes:function(t,e){t.enableVertexAttribArray(e.attribute("vert")),t.enableVertexAttribArray(e.attribute("barycentric"))},setAttributes:function(t,e,r){t.vertexAttribPointer(e.attribute("vert"),3,t.FLOAT,!1,0,0),t.vertexAttribPointer(e.attribute("barycentric"),3,t.FLOAT,!1,0,12*r)},setUniforms:function(t){t.setUniform("camera",this.camera,{type:"mat4"}),t.setUniform("model",this.model,{type:"mat4"}),t.setUniform("surfaceColor",this.surfaceColor,{type:"vec3"})},vertex:"attribute vec3 vert;\nattribute vec3 barycentric;\nuniform mat4 camera;\nuniform mat4 model;\nvarying mediump vec3 barycentricPos;\nvoid main( void ) {\n\tbarycentricPos = barycentric;\n\tgl_Position = camera * model * vec4( vert, 1.0 );\n}",fragment:"uniform mediump vec3 surfaceColor;\nvarying mediump vec3 barycentricPos;\nvoid main( void ) {\n\tif ( any( lessThan( barycentricPos, vec3( 0.02 ) ) ) ) {\n\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t} else {\n\t\tgl_FragColor = vec4( surfaceColor, 1.0 );\n\t}\n}"},t.hemisphere={camera:mat4.create(),model:mat4.create(),normalMatrix:mat4.create(),skyColor:vec3.fromValues(.83,.819,.819),groundColor:vec3.fromValues(.181,.161,.095),polar:0,azimuth:0,enableAttributes:function(t,e){t.enableVertexAttribArray(e.attribute("vert")),t.enableVertexAttribArray(e.attribute("norm"))},setAttributes:function(t,e,r){t.vertexAttribPointer(e.attribute("vert"),3,t.FLOAT,!1,0,0),t.vertexAttribPointer(e.attribute("norm"),3,t.FLOAT,!1,0,24*r)},setUniforms:function(t){var e=vec3.fromValues(Math.sin(this.polar)*Math.sin(this.azimuth),Math.cos(this.polar),Math.sin(this.polar)*Math.cos(this.azimuth));t.setUniform("lightPosition",e,{type:"vec3"}),t.setUniform("skyColor",this.skyColor,{type:"vec3"}),t.setUniform("groundColor",this.groundColor,{type:"vec3"});var r=mat4.create();mat4.invert(r,this.model),mat4.transpose(r,r),t.setUniform("normalMatrix",r,{type:"mat4"}),t.setUniform("camera",this.camera,{type:"mat4"}),t.setUniform("model",this.model,{type:"mat4"})},vertex:"precision mediump float;\nattribute vec3 vert;\nattribute vec3 norm;\nuniform mat4 camera;\nuniform mat4 model;\nuniform mat4 normalMatrix;\nuniform vec3 lightPosition;\nuniform vec3 skyColor;\nuniform vec3 groundColor;\nvarying vec3 fragColor;\nvoid main() {\n\tvec3 fragNormal = vec3( normalMatrix * vec4( norm, 0.0 ) );\n\tvec3 position = vec3( model * vec4( vert, 1.0 ) );\n\tvec3 lightVector = normalize( lightPosition - normalize( position ) );\n\tfloat theta = dot( fragNormal, lightVector );\n\tfloat a = theta * 0.5 + 0.5;\n\tfragColor = mix( groundColor, skyColor, a );\n\tgl_Position = camera * model * vec4( vert, 1.0 );\n}",fragment:"precision mediump float;\nvarying vec3 fragColor;\nvoid main() {\n\tgl_FragColor = vec4(fragColor, 1.0 );\n}"},t.flatShader={camera:mat4.create(),model:mat4.create(),surfaceColor:vec3.fromValues(.8,.8,.8),enableAttributes:function(t,e){t.enableVertexAttribArray(e.attribute("vert"))},setAttributes:function(t,e){t.vertexAttribPointer(e.attribute("vert"),3,t.FLOAT,!1,0,0)},setUniforms:function(t){t.setUniform("camera",this.camera,{type:"mat4"}),t.setUniform("model",this.model,{type:"mat4"}),t.setUniform("surfaceColor",this.surfaceColor,{type:"vec3"})},vertex:"attribute vec3 vert;\nuniform mat4 camera;\nuniform mat4 model;\nvoid main( void ) {\n\tgl_Position = camera * model * vec4( vert, 1.0 );\n}",fragment:"uniform mediump vec3 surfaceColor;\nvoid main( void ) {\n\tgl_FragColor = vec4( surfaceColor, 1.0 );\n}"},t}((morphoviewer=function(t){return t.rotationMatrix4=function(t,e){var r=vec3.cross(vec3.create(),t,e),a=r[0],i=r[1],o=r[2],n=vec3.dot(t,e),s=1/(1+n),l=new glMatrix.ARRAY_TYPE(16);return l[0]=n+s*a*a,l[1]=s*a*i-o,l[2]=s*a*o+i,l[3]=0,l[4]=s*a*i+o,l[5]=n+s*i*i,l[6]=s*i*o-a,l[7]=0,l[8]=s*a*o-i,l[9]=s*i*o+a,l[10]=n+s*o*o,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},t.Plane=function(t,e,r){this.point=t,this.planeVec1=vec3.subtract(vec3.create(),e,t),this.planeVec2=vec3.subtract(vec3.create(),r,t),this.normal=vec3.normalize(vec3.create(),vec3.cross(vec3.create(),this.planeVec1,this.planeVec2))},t.Plane.prototype.eval=function(t){mat3.determinant(mat3.fromRows(mat3.create(),t,this.planeVec1,this.planeVec2))},t.Plane.prototype.flip=function(){vec3.subtract(this.planeVec1,vec3.fromValues(0,0,0),this.planeVec1),this.normal=vec3.normalize(vec3.create(),vec3.cross(vec3.create(),this.planeVec1,this.planeVec2))},t.Plane.prototype.getNormal=function(){return vec3.clone(this.normal)},t}((morphoviewer=function(t){function e(t,e){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(t){e(t.target.response)},r.send()}function r(t,e,r){void 0===r&&(r=!1),void 0===e&&(e=0),arguments.callee.bytes=t.length,arguments.callee.buffer=t,arguments.callee.view=jDataView(t,e,t.length-e,r)}function a(t,e){for(var r=0;r<t.length;r++){var a=t[r];if(e.append(a),"end_header"===a)return!0}return!1}function o(){for(var t=new b;;){var e=r.readLine().split(" "),i=e[0];if("ply"!==i&&"comment"!==i&&a(e,t))break}return t}function n(){for(var t=o(),e={},r=[],a="";;){var i=t.get();if("format"===i)a=l(t);else if("element"===i)r.push(c(t,e,a));else if("end_header"===i)break}return[r,e,a]}function s(t){for(var e=0;e<t.length;e++)t[e].parseElement()}function l(t){var e=t.get(),r="";return"ascii"===e?r="ascii":"binary_little_endian"===e?r="little":"binary_big_endian"===e&&(r="big"),t.get(),r}function c(t,e,r){var a=t.get();e[a]={};for(var i=t.get(),o=new P(parseInt(i));"property"===t.peek();)o.append(h(t,e[a],r));return o}function h(t,e,r){t.get();var a;if("list"===t.peek()){t.get();var i=t.get(),o=t.get(),n=t.get();e[n]=[],"ascii"===r?a=new C(e[n],i,o):"little"!==r&&"big"!==r||(a=new V(e[n],i,o))}else{var s=t.get(),l=t.get();e[l]=[],"ascii"===r?a=new F(e[l],s):"little"!==r&&"big"!==r||(a=new A(e[l],s))}return a}function u(){for(var t={v:[],f:[]};r.tell()<r.end();){var e=r.readLine().split(" "),a=t.v,i=t.f;"v"==e[0]&&a.push([parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])]);var o=!1,n=t.vn;if("vn"==e[0]&&(o||(t.vn=[],n=t.vn,o=!0),n.push([parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])])),"f"==e[0]){for(var s=[],l=parseInt(e[1])-1,c=2;c<e.length;c+=2){var h=parseInt(e[c])-1,u=parseInt(e[c+1])-1;s.push(l,h,u)}i.push(s)}}return t}function m(t){f(t)}function f(t){for(r.readLine();"facet"===r.peekToken();)p(t);var e=r.peekToken();"endsolid"!==e&&console.log("parseSTLSolid: expected endsolid but got "+e)}function p(t){var e=r.readLine().trim().split(/\s+/),a=t.vn;a.push(parseFloat(e[2])),a.push(parseFloat(e[3])),a.push(parseFloat(e[4])),a.push(parseFloat(e[2])),a.push(parseFloat(e[3])),a.push(parseFloat(e[4])),a.push(parseFloat(e[2])),a.push(parseFloat(e[3])),a.push(parseFloat(e[4])),v(t),r.readLine()}function v(t){var e=t.v;for(r.readLine(),i=0;i<3;i++){var a=r.readLine().trim().split(/\s+/);e.push(parseFloat(a[1])),e.push(parseFloat(a[2])),e.push(parseFloat(a[3]))}r.readLine()}function g(t){var e=t.v,a=t.vn;r.seek(80);for(var i=r.getUint32(),o=0;o<i;o++){var n=r.getFloat32(),s=r.getFloat32(),l=r.getFloat32();a.push(n,s,l),a.push(n,s,l),a.push(n,s,l);for(var c=0;c<3;c++)e.push(r.getFloat32(),r.getFloat32(),r.getFloat32());r.getUint16()}}function d(t){for(var e={points:[]},a=e.points;r.tell()<r.end();){var i=r.readLine().split(t);a.push([parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])])}return e}t.io={},t.io.loadFile=function(t,e){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(t){e(t.target.response)},r.send()},t.io.getFileType=function(t){r(t);var e=r.readLine().trim().split(/\s+/);if("solid"===e[0])return"stl";r.seek(80),r.isLittleEndian(!0);var a=r.getUint32();if(r.isLittleEndian(!1),r.seek(0),r.size()==84+50*a)return"stl";if("ply"===e[0])return"ply";var i=r.readLine(),o=r.readLine(),n=r.readLine(),s=i.trim().split(","),l=o.trim().split(","),c=n.trim().split(",");return s.length==l.length&&l.length==c.length&&3==c.length?"csv":"unrecognized"},r.size=function(){return r.bytes},r.isLittleEndian=function(t){var e=r.view.tell(),a=r.buffer.length;r.view=jDataView(r.buffer,e,a-e,t)},r.seek=function(t){r.view.seek(t)},r.tell=function(){return r.view.tell()},r.end=function(){return r.buffer.length},r.getChar=function(){return r.view.getChar()},r.getInt8=function(){return r.view.getInt8()},r.getUint8=function(){return r.view.getUint8()},r.getInt16=function(){return r.view.getInt16()},r.getUint16=function(){return r.view.getUint16()},r.getInt32=function(){return r.view.getInt32()},r.getUint32=function(){return r.view.getUint32()},r.getFloat32=function(){return r.view.getFloat32()},r.getFloat64=function(){return r.view.getFloat64()},r.readLine=function(){for(var t="",e=r.getChar();"\n"!=e;)for(t=t.concat(e),e=r.getChar();"\t"==e||""==e;)e=r.getChar();return t},r.peekChar=function(){var t=r.view.tell(),e=r.view.getChar();return r.view.seek(t),e},r.readToken=function(){if(r.view.tell()>=r.buffer.length)throw console.log("BufferView.readToken: position: "+r.view.tell()+", length: "+r.buffer.length),"BufferView.readToken: current position out of file bounds";for(var t,e=[];;){if("\n"!=(t=r.peekChar())&&" "!=t)break;r.getChar()}for(;;){if("\n"==(t=r.peekChar())||" "==t)break;e.push(r.getChar())}return e.join("")},r.peekToken=function(){var t=r.view.tell(),e=r.readToken();return r.view.seek(t),e};var b=function(){this.tokenStream=[],this.index=0,this.end=0};b.prototype.append=function(t){this.tokenStream.push(t),this.end++},b.prototype.get=function(){var t=this.tokenStream[this.index];return++this.index>=this.end&&(this.index=this.end),t},b.prototype.peek=function(t){return void 0===t&&(t=0),this.index+t==this.end?this.tokenStream[this.end]:this.tokenStream[this.index+t]};var w={char:r.getChar,uchar:r.getUint8,short:r.getInt16,ushort:r.getUint16,int:r.getInt32,uint:r.getUint32,float:r.getFloat32,double:r.getFloat64},y={char:parseInt,uchar:parseInt,short:parseInt,ushort:parseInt,int:parseInt,uint:parseInt,float:parseFloat,double:parseFloat},P=function(t){this.count=t,this.propertyParsers=[]};P.prototype.parseElement=function(){for(var t=0;t<this.count;t++)for(var e=0;e<this.propertyParsers.length;e++)this.propertyParsers[e].parse()},P.prototype.append=function(t){this.propertyParsers.push(t)};var A=function(t,e){this.target=t,this.getter=w[e]};A.prototype.parse=function(){this.target.push(this.getter())};var F=function(t,e){this.target=t,this.parser=y[e]};F.prototype.parse=function(){var t=r.readToken();this.target.push(this.parser(t))};var V=function(t,e,r){this.target=t,this.numeratorGetter=w[e],this.listGetter=w[r]};V.prototype.parse=function(){for(var t=this.numeratorGetter(),e=[],r=0;r<t;r++)e.push(this.listGetter());this.target.push(e)};var C=function(t,e,r){this.target=t,this.numeratorParser=y[e],this.listParser=y[r]};return C.prototype.parse=function(){for(var t=r.readToken(),e=this.numeratorParser(t),a=[],i=0;i<e;i++)t=r.readToken(),a.push(this.listParser(t));this.target.push(a)},t.parsePLY=function(t){r(t);var e=n(),a=e[0],i=e[1],o=e[2];if("ascii"!=o){var l=!1;"little"===o&&(l=!0),r.isLittleEndian(l)}return s(a),i},t.io.loadPLY=function(r,a){e(r,function(e){var r=new Uint8Array(e),i=t.parsePLY(r);void 0!==a&&a(i)})},t.parseOBJ=function(t){return r(t),u()},t.io.loadOBJ=function(r,a){e(r,function(e){var r=new Uint8Array(e),i=t.parseOBJ(r);void 0!==a&&a(i)})},t.parseSTL=function(t){r(t,0,!0);var e={v:[],vn:[]};return"solid"===r.peekToken()?m(e):g(e),e},t.io.loadSTL=function(r,a){e(r,function(e){var r=new Uint8Array(e),i=t.parseSTL(r);void 0!==a&&a(i)})},t.parseCSV=function(t,e){return void 0===e&&(e=","),r(t),d(e)},t.io.loadCSV=function(r,a,i){void 0!==i&&(i=",");e(r,function(e){var r=new Uint8Array(e),o=t.parseCSV(r,i);void 0!==a&&a(o)})},t.io.load=function(t,e,r){},t}(morphoviewer||{}))||{}))||{}))||{})))||{});
>>>>>>> e9b2c9cbbb188c743e6f00278f4711893681646b
